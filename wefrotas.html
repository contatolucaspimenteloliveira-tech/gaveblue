<!doctype html>
<html lang="pt-BR" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GAVEBLUE - WEFROTAS - COVRE E CIA LTDA</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        .tab-active {
            border-bottom: 2px solid #3b82f6;
            color: #3b82f6;
            background-color: #eff6ff;
        }
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
        .status-aberta { background-color: #dcfce7; color: #166534; }
        .status-andamento { background-color: #fef3c7; color: #92400e; }
        .status-fechada { background-color: #fee2e2; color: #991b1b; }
        
        /* Transi√ß√µes suaves */
        .tab-content {
            transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out;
        }
        .tab-content.hidden {
            opacity: 0;
            transform: translateY(10px);
        }
        .tab-content:not(.hidden) {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* Modal com blur */
        #modal-overlay {
            backdrop-filter: blur(8px);
            transition: all 0.3s ease-in-out;
        }
        #modal-overlay.hidden {
            opacity: 0;
            visibility: hidden;
        }
        #modal-overlay:not(.hidden) {
            opacity: 1;
            visibility: visible;
        }
        
        #modal-overlay > div {
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
            transform: scale(0.95) translateY(-20px);
        }
        #modal-overlay:not(.hidden) > div {
            transform: scale(1) translateY(0);
        }
        
        /* Hover effects suaves */
        .hover-lift {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .hover-lift:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        /* Bot√µes com transi√ß√µes */
        button, .cursor-pointer {
            transition: all 0.2s ease-in-out;
        }
        
        /* Toast animations */
        .toast-enter {
            transform: translateX(100%);
            opacity: 0;
        }
        .toast-show {
            transform: translateX(0);
            opacity: 1;
        }
        .toast-exit {
            transform: translateX(100%);
            opacity: 0;
        }

        /* Estilos melhorados para campos de data */
        .date-input-container {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .date-input {
            width: 100%;
            padding: 12px 16px;
            padding-right: 48px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            color: #374151;
            background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%);
            transition: all 0.3s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .date-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1), 0 4px 12px rgba(0, 0, 0, 0.15);
            background: #ffffff;
            transform: translateY(-1px);
        }

        .date-input:hover {
            border-color: #9ca3af;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
        }

        .date-input-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #6b7280;
            pointer-events: none;
            transition: color 0.3s ease;
        }

        .date-input:focus + .date-input-icon {
            color: #3b82f6;
        }

        /* Estilo para o calend√°rio nativo */
        .date-input::-webkit-calendar-picker-indicator {
            opacity: 0;
            position: absolute;
            right: 0;
            width: 48px;
            height: 100%;
            cursor: pointer;
        }

        .date-input::-webkit-datetime-edit {
            padding: 0;
        }

        .date-input::-webkit-datetime-edit-fields-wrapper {
            padding: 0;
        }

        .date-input::-webkit-datetime-edit-text {
            color: #6b7280;
            padding: 0 2px;
        }

        .date-input::-webkit-datetime-edit-month-field,
        .date-input::-webkit-datetime-edit-day-field,
        .date-input::-webkit-datetime-edit-year-field {
            padding: 2px 4px;
            border-radius: 4px;
            background: transparent;
            color: #374151;
            font-weight: 500;
        }

        .date-input::-webkit-datetime-edit-month-field:focus,
        .date-input::-webkit-datetime-edit-day-field:focus,
        .date-input::-webkit-datetime-edit-year-field:focus {
            background: #eff6ff;
            color: #1d4ed8;
            outline: none;
        }

        /* Placeholder personalizado para campos de data vazios */
        .date-input:invalid {
            color: #9ca3af;
        }

        .date-input:invalid::-webkit-datetime-edit {
            color: transparent;
        }

        .date-input:invalid::before {
            content: attr(placeholder);
            color: #9ca3af;
            font-weight: 400;
        }

        .date-input:focus:invalid::before {
            display: none;
        }

        /* Anima√ß√£o suave para mudan√ßas */
        .date-input-container {
            transition: all 0.3s ease;
        }

        /* Estilo especial para campos obrigat√≥rios */
        .date-input.required {
            border-left: 4px solid #f59e0b;
        }

        .date-input.required:focus {
            border-left-color: #3b82f6;
        }

        /* Estilo para campos com erro */
        .date-input.error {
            border-color: #ef4444;
            background: linear-gradient(135deg, #fef2f2 0%, #ffffff 100%);
        }

        .date-input.error:focus {
            border-color: #ef4444;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1), 0 4px 12px rgba(239, 68, 68, 0.15);
        }

        /* Estilo para campos desabilitados */
        .date-input:disabled {
            background: #f3f4f6;
            color: #9ca3af;
            cursor: not-allowed;
            border-color: #e5e7eb;
        }

        .date-input:disabled + .date-input-icon {
            color: #d1d5db;
        }

        /* Responsividade para mobile */
        @media (max-width: 640px) {
            .date-input {
                padding: 14px 16px;
                padding-right: 48px;
                font-size: 16px; /* Evita zoom no iOS */
            }
        }

        /* Estilo para labels dos campos de data */
        .date-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
            transition: color 0.3s ease;
        }

        .date-label.required::after {
            content: " *";
            color: #ef4444;
            font-weight: 700;
        }

        /* Container com foco para melhor UX */
        .date-input-container:focus-within .date-label {
            color: #3b82f6;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full bg-gray-50 font-sans">
  <div class="min-h-full"><!-- Header -->
   <header class="bg-white shadow-sm border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
     <div class="flex justify-between items-center py-4">
      <div>
       <h1 id="system-title" class="text-2xl font-bold text-blue-900">gaveblue - wefrotas</h1>
       <p id="company-name" class="text-lg text-blue-700 font-semibold">Sistema Integrado de Gest√£o de Frotas</p>
      </div><!-- Toast Container no Header -->
      <div id="header-toast-container" class="flex-1 max-w-md mx-4"></div>
     </div>
    </div>
   </header><!-- Navigation Tabs -->
   <nav class="bg-white border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
     <div class="flex space-x-1 overflow-x-auto"><button onclick="showTab('vehicles')" id="tab-vehicles" class="tab-active py-3 px-4 text-sm font-medium whitespace-nowrap rounded-t-lg">
       <svg class="w-4 h-4 inline mr-2" fill="currentColor" viewbox="0 0 24 24"><path d="M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11C5.84 5 5.28 5.42 5.08 6.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99zM6.5 16c-.83 0-1.5-.67-1.5-1.5S5.67 13 6.5 13s1.5.67 1.5 1.5S7.33 16 6.5 16zm11 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zM5 11l1.5-4.5h11L19 11H5z" />
       </svg> VE√çCULOS </button> <button onclick="showTab('drivers')" id="tab-drivers" class="py-3 px-4 text-sm font-medium text-gray-500 hover:text-gray-700 whitespace-nowrap rounded-t-lg">
       <svg class="w-4 h-4 inline mr-2" fill="currentColor" viewbox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
       </svg> MOTORISTAS </button> <button onclick="showTab('orders')" id="tab-orders" class="py-3 px-4 text-sm font-medium text-gray-500 hover:text-gray-700 whitespace-nowrap rounded-t-lg">
       <svg class="w-4 h-4 inline mr-2" fill="currentColor" viewbox="0 0 24 24"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z" />
       </svg> OS </button> <button onclick="showTab('lancamentos')" id="tab-lancamentos" class="py-3 px-4 text-sm font-medium text-gray-500 hover:text-gray-700 whitespace-nowrap rounded-t-lg">
       <svg class="w-4 h-4 inline mr-2" fill="currentColor" viewbox="0 0 24 24"><path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z" />
       </svg> LAN√áAMENTOS </button> <button onclick="showTab('contas')" id="tab-contas" class="py-3 px-4 text-sm font-medium text-gray-500 hover:text-gray-700 whitespace-nowrap rounded-t-lg relative">
       <svg class="w-4 h-4 inline mr-2" fill="currentColor" viewbox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.41 16.09V20h-2.67v-1.93c-1.71-.36-3.16-1.46-3.27-3.4h1.96c.1 1.05.82 1.87 2.65 1.87 1.96 0 2.4-.98 2.4-1.59 0-.83-.44-1.61-2.67-2.14-2.48-.6-4.18-1.62-4.18-3.67 0-1.72 1.39-2.84 3.11-3.21V4h2.67v1.95c1.86.45 2.79 1.86 2.85 3.39H14.3c-.05-1.11-.64-1.87-2.22-1.87-1.5 0-2.4.68-2.4 1.64 0 .84.65 1.39 2.67 1.91s4.18 1.39 4.18 3.91c-.01 1.83-1.38 2.83-3.12 3.16z" />
       </svg> CONTAS A PAGAR <!-- Selo NOVO --> <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-full shadow-lg animate-pulse"> NOVO </span> </button> <button onclick="showTab('cadastros')" id="tab-cadastros" class="py-3 px-4 text-sm font-medium text-gray-500 hover:text-gray-700 whitespace-nowrap rounded-t-lg">
       <svg class="w-4 h-4 inline mr-2" fill="currentColor" viewbox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
       </svg> CADASTROS </button>
     </div>
    </div>
   </nav><!-- Main Content -->
   <main class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8"><!-- Contas a Pagar Tab -->
    <div id="contas-content" class="tab-content hidden">
     <div class="bg-white rounded-lg shadow p-6 mb-6"><!-- Cabe√ßalho com controles -->
      <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
       <h3 class="text-lg font-semibold text-gray-900 flex items-center">
        <svg class="w-5 h-5 mr-2 text-green-600" fill="currentColor" viewbox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.41 16.09V20h-2.67v-1.93c-1.71-.36-3.16-1.46-3.27-3.4h1.96c.1 1.05.82 1.87 2.65 1.87 1.96 0 2.4-.98 2.4-1.59 0-.83-.44-1.61-2.67-2.14-2.48-.6-4.18-1.62-4.18-3.67 0-1.72 1.39-2.84 3.11-3.21V4h2.67v1.95c1.86.45 2.79 1.86 2.85 3.39H14.3c-.05-1.11-.64-1.87-2.22-1.87-1.5 0-2.4.68-2.4 1.64 0 .84.65 1.39 2.67 1.91s4.18 1.39 4.18 3.91c-.01 1.83-1.38 2.83-3.12 3.16z" />
        </svg> Contas a Pagar</h3><!-- Controles de filtro -->
       <div class="flex flex-wrap items-center gap-3"><select id="contas-filter-status" onchange="updateContasList()" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"> <option value="">Todos os Status</option> <option value="Pendente">Pendentes</option> <option value="Vencida">Vencidas</option> <option value="Paga">Pagas</option> </select> <select id="contas-filter-periodo" onchange="updateContasList()" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"> <option value="">Todos os Per√≠odos</option> <option value="hoje">Vence Hoje</option> <option value="semana">Pr√≥ximos 7 Dias</option> <option value="mes">Pr√≥ximos 30 Dias</option> <option value="vencidas">Vencidas</option> </select> <button onclick="exportContasReport()" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 flex items-center">
         <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
         </svg> Exportar </button>
       </div>
      </div><!-- Resumo das contas -->
      <div id="contas-summary" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6"><!-- Ser√° preenchido dinamicamente -->
      </div><!-- Info de sele√ß√£o -->
      <div id="contas-selection-info" class="hidden bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4">
       <div class="flex justify-between items-center">
        <p class="text-blue-800 text-sm"><span id="contas-selection-count">0 contas selecionadas</span> - <span id="contas-selection-total">R$ 0,00</span></p><button id="pay-selected-btn" onclick="paySelectedContas()" disabled class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center">
         <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
         </svg> Pagar Selecionadas </button>
       </div>
      </div><!-- Lista de contas -->
      <div id="contas-list" class="space-y-4">
       <div class="text-center py-8 text-gray-500">
        Nenhuma conta encontrada
       </div>
      </div>
     </div>
    </div><!-- Cadastros Tab -->
    <div id="cadastros-content" class="tab-content hidden">
     <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-8 mb-6">
      <div class="text-center mb-10">
       <h3 class="text-3xl font-bold text-gray-900 mb-3">Central de Cadastros</h3>
       <p class="text-gray-600 text-lg">Escolha o que deseja cadastrar no sistema</p>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"><!-- Cadastro de Ve√≠culos -->
       <div onclick="showCadastroForm('vehicle')" class="group cursor-pointer bg-white border-2 border-gray-200 rounded-2xl p-8 hover:border-green-400 hover:shadow-xl transition-all duration-300 transform hover:-translate-y-2">
        <div class="text-center">
         <div class="mb-6 p-4 bg-green-50 rounded-full w-20 h-20 mx-auto flex items-center justify-center group-hover:bg-green-100 transition-colors duration-300">
          <svg class="w-10 h-10 text-green-600 group-hover:text-green-700" fill="currentColor" viewbox="0 0 24 24"><path d="M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11C5.84 5 5.28 5.42 5.08 6.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99zM6.5 16c-.83 0-1.5-.67-1.5-1.5S5.67 13 6.5 13s1.5.67 1.5 1.5S7.33 16 6.5 16zm11 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zM5 11l1.5-4.5h11L19 11H5z" />
          </svg>
         </div>
         <h4 class="text-xl font-bold text-gray-900 mb-3 group-hover:text-green-700 transition-colors duration-300">VE√çCULO</h4>
         <p class="text-gray-600 group-hover:text-gray-700 transition-colors duration-300">Adicionar novo ve√≠culo √† frota</p>
         <div class="mt-4 inline-flex items-center text-green-600 font-medium group-hover:text-green-700"><span class="mr-2">Cadastrar</span>
          <svg class="w-4 h-4 transform group-hover:translate-x-1 transition-transform duration-300" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
         </div>
        </div>
       </div><!-- Cadastro de Motoristas -->
       <div onclick="showCadastroForm('driver')" class="group cursor-pointer bg-white border-2 border-gray-200 rounded-2xl p-8 hover:border-purple-400 hover:shadow-xl transition-all duration-300 transform hover:-translate-y-2">
        <div class="text-center">
         <div class="mb-6 p-4 bg-purple-50 rounded-full w-20 h-20 mx-auto flex items-center justify-center group-hover:bg-purple-100 transition-colors duration-300">
          <svg class="w-10 h-10 text-purple-600 group-hover:text-purple-700" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
          </svg>
         </div>
         <h4 class="text-xl font-bold text-gray-900 mb-3 group-hover:text-purple-700 transition-colors duration-300">MOTORISTA</h4>
         <p class="text-gray-600 group-hover:text-gray-700 transition-colors duration-300">Cadastrar novo motorista</p>
         <div class="mt-4 inline-flex items-center text-purple-600 font-medium group-hover:text-purple-700"><span class="mr-2">Cadastrar</span>
          <svg class="w-4 h-4 transform group-hover:translate-x-1 transition-transform duration-300" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
         </div>
        </div>
       </div><!-- Cadastro de Fornecedores (Unificado) -->
       <div onclick="showCadastroForm('supplier')" class="group cursor-pointer bg-white border-2 border-gray-200 rounded-2xl p-8 hover:border-indigo-400 hover:shadow-xl transition-all duration-300 transform hover:-translate-y-2">
        <div class="text-center">
         <div class="mb-6 p-4 bg-indigo-50 rounded-full w-20 h-20 mx-auto flex items-center justify-center group-hover:bg-indigo-100 transition-colors duration-300">
          <svg class="w-10 h-10 text-indigo-600 group-hover:text-indigo-700" fill="currentColor" viewbox="0 0 24 24"><path d="M20 6h-2.18c.11-.31.18-.65.18-1a2.996 2.996 0 0 0-5.5-1.65l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1z" />
          </svg>
         </div>
         <h4 class="text-xl font-bold text-gray-900 mb-3 group-hover:text-indigo-700 transition-colors duration-300">FORNECEDOR</h4>
         <p class="text-gray-600 group-hover:text-gray-700 transition-colors duration-300">Cadastrar postos, oficinas, autope√ßas e outros fornecedores</p>
         <div class="mt-4 inline-flex items-center text-indigo-600 font-medium group-hover:text-indigo-700"><span class="mr-2">Cadastrar</span>
          <svg class="w-4 h-4 transform group-hover:translate-x-1 transition-transform duration-300" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
         </div>
        </div>
       </div>
      </div>
     </div><!-- Lista de Fornecedores Cadastrados -->
     <div class="bg-white rounded-lg shadow p-6">
      <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
       <svg class="w-5 h-5 mr-2 text-indigo-600" fill="currentColor" viewbox="0 0 24 24"><path d="M20 6h-2.18c.11-.31.18-.65.18-1a2.996 2.996 0 0 0-5.5-1.65l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1z" />
       </svg> Fornecedores Cadastrados</h3>
      <div id="suppliers-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
       <div class="text-center py-8 text-gray-500">
        Nenhum fornecedor cadastrado
       </div>
      </div>
     </div>
    </div><!-- Orders Tab -->
    <div id="orders-content" class="tab-content hidden">
     <div class="bg-white rounded-lg shadow p-6"><!-- Cabe√ßalho com controles -->
      <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
       <h3 class="text-lg font-semibold text-gray-900">Ordens de Servi√ßo</h3><!-- Controles de a√ß√£o -->
       <div class="flex flex-wrap items-center gap-3"><!-- Bot√£o Nova OS --> <button onclick="showCadastroForm('order')" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 flex items-center">
         <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
         </svg> Nova OS </button> <!-- Bot√£o Editar --> <button id="edit-order-btn" onclick="editSelectedOrder()" disabled class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center">
         <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
         </svg> Editar </button> <!-- Bot√£o Excluir --> <button id="delete-orders-btn" onclick="deleteSelectedOrders()" disabled class="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center">
         <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
         </svg> Excluir </button> <!-- Bot√£o Exportar --> <button id="export-order-btn" onclick="exportSelectedOrder()" disabled class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center">
         <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
         </svg> Exportar </button> <!-- Filtros --> <select id="order-filter" onchange="updateOrdersList()" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"> <option value="">Todos os Status</option> <option value="Aberta">Abertas</option> <option value="Em andamento">Em Andamento</option> <option value="Fechada">Fechadas</option> </select>
        <div class="date-input-container"><input type="date" id="order-date-start" onchange="updateOrdersList()" placeholder="Data inicial" class="date-input text-sm">
         <svg class="date-input-icon w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
         </svg>
        </div>
        <div class="date-input-container"><input type="date" id="order-date-end" onchange="updateOrdersList()" placeholder="Data final" class="date-input text-sm">
         <svg class="date-input-icon w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
         </svg>
        </div><select id="order-sort" onchange="updateOrdersList()" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"> <option value="newest">Mais Recentes</option> <option value="oldest">Mais Antigas</option> <option value="number">Por N√∫mero</option> </select>
       </div>
      </div><!-- Info de sele√ß√£o -->
      <div id="selection-info" class="hidden bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4">
       <p class="text-blue-800 text-sm"><span id="selection-count">0 OS selecionadas</span></p>
      </div>
      <div id="orders-list" class="space-y-4">
       <div class="text-center py-8 text-gray-500">
        Nenhuma ordem de servi√ßo cadastrada
       </div>
      </div>
     </div>
    </div><!-- Vehicles Tab -->
    <div id="vehicles-content" class="tab-content">
     <div class="bg-white rounded-lg shadow p-6">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">Ve√≠culos Cadastrados</h3>
      <div id="vehicles-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
       <div class="text-center py-8 text-gray-500">
        Nenhum ve√≠culo cadastrado
       </div>
      </div>
     </div>
    </div><!-- Drivers Tab -->
    <div id="drivers-content" class="tab-content hidden">
     <div class="bg-white rounded-lg shadow p-6">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">Motoristas Cadastrados</h3>
      <div id="drivers-list" class="space-y-4">
       <div class="text-center py-8 text-gray-500">
        Nenhum motorista cadastrado
       </div>
      </div>
     </div>
    </div><!-- Lan√ßamentos Tab -->
    <div id="lancamentos-content" class="tab-content hidden">
     <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-8 mb-6">
      <div class="text-center mb-10">
       <h3 class="text-3xl font-bold text-gray-900 mb-3">Central de Lan√ßamentos</h3>
       <p class="text-gray-600 text-lg">Registre despesas e abastecimentos</p>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto"><!-- Bot√£o Despesas -->
       <div onclick="showLancamentoPopup('despesas')" class="group cursor-pointer bg-white border-2 border-gray-200 rounded-2xl p-8 hover:border-red-400 hover:shadow-xl transition-all duration-300 transform hover:-translate-y-2">
        <div class="text-center">
         <div class="mb-6 p-4 bg-red-50 rounded-full w-20 h-20 mx-auto flex items-center justify-center group-hover:bg-red-100 transition-colors duration-300">
          <svg class="w-10 h-10 text-red-600 group-hover:text-red-700" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v2a2 2 0 002 2z" />
          </svg>
         </div>
         <h4 class="text-xl font-bold text-gray-900 mb-3 group-hover:text-red-700 transition-colors duration-300">DESPESAS</h4>
         <p class="text-gray-600 group-hover:text-gray-700 transition-colors duration-300">Registrar ped√°gios, manuten√ß√µes, multas e outras despesas</p>
         <div class="mt-4 inline-flex items-center text-red-600 font-medium group-hover:text-red-700"><span class="mr-2">Registrar</span>
          <svg class="w-4 h-4 transform group-hover:translate-x-1 transition-transform duration-300" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
         </div>
        </div>
       </div><!-- Bot√£o Abastecimentos -->
       <div onclick="showLancamentoPopup('abastecimentos')" class="group cursor-pointer bg-white border-2 border-gray-200 rounded-2xl p-8 hover:border-blue-400 hover:shadow-xl transition-all duration-300 transform hover:-translate-y-2">
        <div class="text-center">
         <div class="mb-6 p-4 bg-blue-50 rounded-full w-20 h-20 mx-auto flex items-center justify-center group-hover:bg-blue-100 transition-colors duration-300">
          <svg class="w-10 h-10 text-blue-600 group-hover:text-blue-700" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
          </svg>
         </div>
         <h4 class="text-xl font-bold text-gray-900 mb-3 group-hover:text-blue-700 transition-colors duration-300">ABASTECIMENTOS</h4>
         <p class="text-gray-600 group-hover:text-gray-700 transition-colors duration-300">Registrar abastecimentos de combust√≠vel da frota</p>
         <div class="mt-4 inline-flex items-center text-blue-600 font-medium group-hover:text-blue-700"><span class="mr-2">Registrar</span>
          <svg class="w-4 h-4 transform group-hover:translate-x-1 transition-transform duration-300" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
         </div>
        </div>
       </div>
      </div>
     </div><!-- Lista de Todos os Lan√ßamentos -->
     <div class="bg-white rounded-lg shadow p-6">
      <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
       <svg class="w-5 h-5 mr-2 text-gray-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
       </svg> Todos os Lan√ßamentos</h3>
      <div id="all-lancamentos-list" class="space-y-4">
       <div class="text-center py-8 text-gray-500">
        Nenhum lan√ßamento registrado
       </div>
      </div>
     </div>
    </div><!-- Expenses Tab (mantendo para compatibilidade) -->
    <div id="expenses-content" class="tab-content hidden"><!-- Formul√°rios de Lan√ßamento -->
     <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6"><!-- Formul√°rio de Abastecimento -->
      <div class="bg-white rounded-lg shadow p-6">
       <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
        <svg class="w-5 h-5 mr-2 text-orange-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
        </svg> Registrar Abastecimento</h3>
       <form id="fueling-form" class="space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
         <div><label for="fueling-vehicle" class="block text-sm font-medium text-gray-700 mb-1">Ve√≠culo</label> <select id="fueling-vehicle" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500" required> <option value="">Selecione um ve√≠culo</option> </select>
         </div>
         <div><label for="fueling-order" class="block text-sm font-medium text-gray-700 mb-1">Ordem de Servi√ßo</label> <select id="fueling-order" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500" required> <option value="">Selecione uma OS</option> </select>
         </div>
         <div><label for="fueling-station" class="block text-sm font-medium text-gray-700 mb-1">Posto</label> <select id="fueling-station" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500" required> <option value="">Selecione um posto</option> </select>
         </div>
         <div><label for="fueling-data" class="block text-sm font-medium text-gray-700 mb-1">Data</label> <input type="date" id="fueling-data" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500" required>
         </div>
         <div><label for="fueling-km" class="block text-sm font-medium text-gray-700 mb-1">KM Atual</label> <input type="number" id="fueling-km" placeholder="50000" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500" required>
         </div>
         <div><label for="fueling-litros" class="block text-sm font-medium text-gray-700 mb-1">Litros</label> <input type="number" step="0.01" id="fueling-litros" placeholder="45.5" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500" required>
         </div>
        </div>
        <div><label for="fueling-valor" class="block text-sm font-medium text-gray-700 mb-1">Valor Total (R$)</label> <input type="number" step="0.01" id="fueling-valor" placeholder="250.00" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500" required>
        </div><button type="submit" id="fueling-submit" class="w-full bg-orange-600 text-white px-6 py-2 rounded-md hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-orange-500"> Registrar Abastecimento </button>
       </form>
      </div><!-- Formul√°rio de Outras Despesas -->
      <div class="bg-white rounded-lg shadow p-6">
       <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
        <svg class="w-5 h-5 mr-2 text-red-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1" />
        </svg> Registrar Outras Despesas</h3>
       <form id="expense-form" class="space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
         <div><label for="expense-order" class="block text-sm font-medium text-gray-700 mb-1">Ordem de Servi√ßo</label> <select id="expense-order" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500" required> <option value="">Selecione uma OS</option> </select>
         </div>
         <div><label for="expense-tipo" class="block text-sm font-medium text-gray-700 mb-1">Tipo</label> <select id="expense-tipo" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500" required> <option value="">Selecione o tipo</option> <option value="Ped√°gio">Ped√°gio</option> <option value="Manuten√ß√£o">Manuten√ß√£o</option> <option value="Pe√ßas">Pe√ßas</option> <option value="Multa">Multa</option> <option value="Seguro">Seguro</option> <option value="Outros">Outros</option> </select>
         </div>
         <div><label for="expense-data" class="block text-sm font-medium text-gray-700 mb-1">Data</label> <input type="date" id="expense-data" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500" required>
         </div>
         <div><label for="expense-valor" class="block text-sm font-medium text-gray-700 mb-1">Valor (R$)</label> <input type="number" step="0.01" id="expense-valor" placeholder="100.00" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500" required>
         </div>
        </div>
        <div><label for="expense-descricao" class="block text-sm font-medium text-gray-700 mb-1">Descri√ß√£o</label> <input type="text" id="expense-descricao" placeholder="Descri√ß√£o da despesa" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500" required>
        </div><button type="submit" id="expense-submit" class="w-full bg-red-600 text-white px-6 py-2 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500"> Registrar Despesa </button>
       </form>
      </div>
     </div><!-- Lista de Todas as Despesas -->
     <div class="bg-white rounded-lg shadow p-6">
      <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
       <svg class="w-5 h-5 mr-2 text-gray-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
       </svg> Todas as Despesas</h3>
      <div id="all-expenses-list" class="space-y-4">
       <div class="text-center py-8 text-gray-500">
        Nenhuma despesa registrada
       </div>
      </div>
     </div>
    </div>
   </main>
  </div><!-- Modal Overlay Global -->
  <div id="modal-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
   <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
    <div class="flex justify-between items-center p-6 border-b">
     <h3 id="modal-title" class="text-xl font-semibold text-gray-900"></h3><button onclick="closeModal()" class="text-gray-500 hover:text-gray-700 text-2xl"> ‚úï </button>
    </div>
    <div id="modal-content" class="p-6"><!-- Conte√∫do ser√° inserido aqui dinamicamente -->
    </div>
   </div>
  </div>
  <script>
        // Global variables
        let allData = [];
        let isInitialized = false;

        // Default config for Element SDK
        const defaultConfig = {
            system_title: "gaveblue - wefrotas",
            company_name: "Sistema Integrado de Gest√£o de Frotas"
        };

        // Data handler for Data SDK
        const dataHandler = {
            onDataChanged(data) {
                console.log('üìä Dados atualizados:', data.length, 'registros');
                allData = data;
                updateUI();
                updateSelects();
            }
        };

        // Initialize application
        async function initializeApp() {
            try {
                console.log('üöÄ Iniciando aplica√ß√£o...');

                // Set today's date as default
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('fueling-data').value = today;
                document.getElementById('expense-data').value = today;

                // Initialize Data SDK
                if (window.dataSdk) {
                    console.log('üìä Inicializando Data SDK...');
                    const dataResult = await window.dataSdk.init(dataHandler);
                    if (dataResult.isOk) {
                        console.log('‚úÖ Data SDK inicializado com sucesso');
                    } else {
                        console.error('‚ùå Erro no Data SDK:', dataResult.error);
                    }
                }

                // Initialize Element SDK
                if (window.elementSdk) {
                    console.log('üé® Inicializando Element SDK...');
                    window.elementSdk.init({
                        defaultConfig,
                        onConfigChange: async (config) => {
                            const titleElement = document.getElementById('system-title');
                            const companyElement = document.getElementById('company-name');
                            if (titleElement) titleElement.textContent = config.system_title || defaultConfig.system_title;
                            if (companyElement) companyElement.textContent = config.company_name || defaultConfig.company_name;
                        },
                        mapToCapabilities: (config) => ({
                            recolorables: [],
                            borderables: [],
                            fontEditable: undefined,
                            fontSizeable: undefined
                        }),
                        mapToEditPanelValues: (config) => new Map([
                            ["system_title", config.system_title || defaultConfig.system_title],
                            ["company_name", config.company_name || defaultConfig.company_name]
                        ])
                    });
                    console.log('‚úÖ Element SDK inicializado');
                }

                // Setup event listeners
                setupEventListeners();
                
                // Initial UI update
                updateUI();
                
                isInitialized = true;
                console.log('üéâ Aplica√ß√£o inicializada com sucesso!');

            } catch (error) {
                console.error('üí• Erro na inicializa√ß√£o:', error);
                showToast('Erro ao inicializar o sistema', 'error');
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            console.log('üîó Configurando event listeners...');

            // Filter listener
            document.getElementById('order-filter').addEventListener('change', updateOrdersList);

            // Form listeners
            document.getElementById('expense-form').addEventListener('submit', handleExpenseSubmit);
            document.getElementById('fueling-form').addEventListener('submit', handleFuelingSubmit);

            console.log('‚úÖ Event listeners configurados');
        }

        // Show lancamento popup
        function showLancamentoPopup(type) {
            console.log('üí∞ Mostrando popup de lan√ßamento:', type);
            
            if (type === 'despesas') {
                showCadastroForm('expense');
            } else if (type === 'abastecimentos') {
                showCadastroForm('fueling');
            } else if (type === 'fornecedores') {
                showCadastroForm('supplier');
            }
        }

        // Show cadastro form in modal
        function showCadastroForm(type) {
            console.log('üìù Mostrando formul√°rio:', type);
            
            // Ensure modal elements exist
            let overlay = document.getElementById('modal-overlay');
            if (!overlay) {
                console.error('Modal overlay n√£o encontrado');
                return;
            }
            
            const title = document.getElementById('modal-title');
            const content = document.getElementById('modal-content');
            
            if (!title || !content) {
                console.error('Elementos do modal n√£o encontrados');
                return;
            }
            
            // Define form configurations
            const formConfigs = {
                order: {
                    title: 'Nova Ordem de Servi√ßo',
                    html: `
                        <form id="dynamic-order-form" class="space-y-6">
                            <!-- Informa√ß√µes B√°sicas -->
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                    <svg class="w-5 h-5 mr-2 text-blue-600" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
                                    </svg>
                                    Informa√ß√µes da Ordem de Servi√ßo
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    <div>
                                        <label for="dynamic-order-descricao" class="block text-sm font-medium text-gray-700 mb-1">Descri√ß√£o *</label>
                                        <input type="text" id="dynamic-order-descricao" placeholder="Ex: Opera√ß√£o Outubro 2025" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                    </div>

                                    <div>
                                        <label for="dynamic-order-data-abertura" class="date-label required">Data de Abertura</label>
                                        <div class="date-input-container">
                                            <input type="date" id="dynamic-order-data-abertura" class="date-input required" placeholder="Selecione a data de abertura" required>
                                            <svg class="date-input-icon w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                            </svg>
                                        </div>
                                    </div>
                                    <div>
                                        <label for="dynamic-order-previsao-termino" class="date-label">Previs√£o de T√©rmino</label>
                                        <div class="date-input-container">
                                            <input type="date" id="dynamic-order-previsao-termino" class="date-input" placeholder="Selecione a previs√£o de t√©rmino">
                                            <svg class="date-input-icon w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                            </svg>
                                        </div>
                                    </div>
                                    <div>
                                        <label for="dynamic-order-prioridade" class="block text-sm font-medium text-gray-700 mb-1">Prioridade</label>
                                        <select id="dynamic-order-prioridade" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="Normal">Normal</option>
                                            <option value="Alta">Alta</option>
                                            <option value="Urgente">Urgente</option>
                                            <option value="Baixa">Baixa</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="dynamic-order-responsavel" class="block text-sm font-medium text-gray-700 mb-1">Respons√°vel</label>
                                        <input type="text" id="dynamic-order-responsavel" placeholder="Nome do respons√°vel" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                </div>
                            </div>

                            <!-- Observa√ß√µes -->
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                    <svg class="w-5 h-5 mr-2 text-purple-600" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                                    </svg>
                                    Observa√ß√µes e Detalhes
                                </h4>
                                <div>
                                    <label for="dynamic-order-observacoes" class="block text-sm font-medium text-gray-700 mb-1">Observa√ß√µes</label>
                                    <textarea id="dynamic-order-observacoes" rows="3" placeholder="Observa√ß√µes e detalhes da ordem de servi√ßo..." class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                                </div>
                            </div>

                            <!-- Bot√£o de Submit -->
                            <div class="flex justify-end pt-4">
                                <button type="submit" id="dynamic-order-submit" class="bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 flex items-center">
                                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                                    </svg>
                                    Criar Ordem de Servi√ßo
                                </button>
                            </div>
                        </form>
                    `
                },
                vehicle: {
                    title: 'Cadastrar Novo Ve√≠culo',
                    html: `
                        <form id="dynamic-vehicle-form" class="space-y-6">
                            <!-- Informa√ß√µes B√°sicas -->
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                    <svg class="w-5 h-5 mr-2 text-blue-600" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                                    </svg>
                                    Informa√ß√µes B√°sicas
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    <div>
                                        <label for="dynamic-vehicle-codigo" class="block text-sm font-medium text-gray-700 mb-1">C√≥digo da Frota *</label>
                                        <input type="text" id="dynamic-vehicle-codigo" placeholder="001" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                    </div>
                                    <div>
                                        <label for="dynamic-vehicle-placa" class="block text-sm font-medium text-gray-700 mb-1">Placa *</label>
                                        <input type="text" id="dynamic-vehicle-placa" placeholder="ABC-1234" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                    </div>
                                    <div>
                                        <label for="dynamic-vehicle-marca" class="block text-sm font-medium text-gray-700 mb-1">Marca *</label>
                                        <input type="text" id="dynamic-vehicle-marca" placeholder="Toyota" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                    </div>
                                    <div>
                                        <label for="dynamic-vehicle-modelo" class="block text-sm font-medium text-gray-700 mb-1">Modelo *</label>
                                        <input type="text" id="dynamic-vehicle-modelo" placeholder="Corolla" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                    </div>
                                    <div>
                                        <label for="dynamic-vehicle-ano" class="block text-sm font-medium text-gray-700 mb-1">Ano Fabrica√ß√£o</label>
                                        <input type="number" id="dynamic-vehicle-ano" placeholder="2020" min="1900" max="2030" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label for="dynamic-vehicle-ano-modelo" class="block text-sm font-medium text-gray-700 mb-1">Ano Modelo</label>
                                        <input type="number" id="dynamic-vehicle-ano-modelo" placeholder="2021" min="1900" max="2030" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label for="dynamic-vehicle-cor" class="block text-sm font-medium text-gray-700 mb-1">Cor</label>
                                        <input type="text" id="dynamic-vehicle-cor" placeholder="Branco" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                </div>
                            </div>

                            <!-- Documenta√ß√£o -->
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                    <svg class="w-5 h-5 mr-2 text-green-600" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
                                    </svg>
                                    Documenta√ß√£o
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    <div>
                                        <label for="dynamic-vehicle-chassi" class="block text-sm font-medium text-gray-700 mb-1">Chassi</label>
                                        <input type="text" id="dynamic-vehicle-chassi" placeholder="9BWZZZ377VT004251" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label for="dynamic-vehicle-renavam" class="block text-sm font-medium text-gray-700 mb-1">RENAVAM</label>
                                        <input type="text" id="dynamic-vehicle-renavam" placeholder="12345678901" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                </div>
                            </div>

                            <!-- Informa√ß√µes T√©cnicas -->
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                    <svg class="w-5 h-5 mr-2 text-orange-600" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                                    </svg>
                                    Informa√ß√µes T√©cnicas
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <label for="dynamic-vehicle-odometro" class="block text-sm font-medium text-gray-700 mb-1">Od√¥metro Atual (km) *</label>
                                        <input type="number" id="dynamic-vehicle-odometro" placeholder="50000" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                    </div>
                                    <div>
                                        <label for="dynamic-vehicle-combustivel" class="block text-sm font-medium text-gray-700 mb-1">Combust√≠vel</label>
                                        <select id="dynamic-vehicle-combustivel" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="">Selecione</option>
                                            <option value="Gasolina">Gasolina</option>
                                            <option value="Etanol">Etanol</option>
                                            <option value="Flex">Flex</option>
                                            <option value="Diesel">Diesel</option>
                                            <option value="GNV">GNV</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="dynamic-vehicle-categoria" class="block text-sm font-medium text-gray-700 mb-1">Categoria</label>
                                        <select id="dynamic-vehicle-categoria" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="">Selecione</option>
                                            <option value="Carro">Carro</option>
                                            <option value="Caminh√£o">Caminh√£o</option>
                                            <option value="Van">Van</option>
                                            <option value="Moto">Moto</option>
                                            <option value="√înibus">√înibus</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Observa√ß√µes -->
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                    <svg class="w-5 h-5 mr-2 text-purple-600" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                                    </svg>
                                    Observa√ß√µes Adicionais
                                </h4>
                                <div>
                                    <label for="dynamic-vehicle-observacoes" class="block text-sm font-medium text-gray-700 mb-1">Observa√ß√µes</label>
                                    <textarea id="dynamic-vehicle-observacoes" rows="3" placeholder="Informa√ß√µes adicionais sobre o ve√≠culo..." class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                                </div>
                            </div>

                            <!-- Bot√£o de Submit -->
                            <div class="flex justify-end pt-4">
                                <button type="submit" id="dynamic-vehicle-submit" class="bg-green-600 text-white px-8 py-3 rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 flex items-center">
                                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                                    </svg>
                                    Cadastrar Ve√≠culo
                                </button>
                            </div>
                        </form>
                    `
                },
                driver: {
                    title: 'Cadastrar Novo Motorista',
                    html: `
                        <form id="dynamic-driver-form" class="space-y-6">
                            <!-- Informa√ß√µes Pessoais -->
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                    <svg class="w-5 h-5 mr-2 text-purple-600" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                                    </svg>
                                    Informa√ß√µes Pessoais
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    <div>
                                        <label for="dynamic-driver-nome" class="block text-sm font-medium text-gray-700 mb-1">Nome Completo *</label>
                                        <input type="text" id="dynamic-driver-nome" placeholder="Jo√£o Silva Santos" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                                    </div>
                                    <div>
                                        <label for="dynamic-driver-cpf" class="block text-sm font-medium text-gray-700 mb-1">CPF *</label>
                                        <input type="text" id="dynamic-driver-cpf" placeholder="123.456.789-00" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                                    </div>
                                    <div>
                                        <label for="dynamic-driver-rg" class="block text-sm font-medium text-gray-700 mb-1">RG</label>
                                        <input type="text" id="dynamic-driver-rg" placeholder="12.345.678-9" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                                    </div>
                                    <div>
                                        <label for="dynamic-driver-nascimento" class="date-label">Data de Nascimento</label>
                                        <div class="date-input-container">
                                            <input type="date" id="dynamic-driver-nascimento" class="date-input" placeholder="Selecione a data de nascimento">
                                            <svg class="date-input-icon w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                            </svg>
                                        </div>
                                    </div>
                                    <div>
                                        <label for="dynamic-driver-telefone" class="block text-sm font-medium text-gray-700 mb-1">Telefone *</label>
                                        <input type="tel" id="dynamic-driver-telefone" placeholder="(11) 99999-9999" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                                    </div>
                                    <div>
                                        <label for="dynamic-driver-email" class="block text-sm font-medium text-gray-700 mb-1">E-mail</label>
                                        <input type="email" id="dynamic-driver-email" placeholder="joao@email.com" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                                    </div>
                                </div>
                            </div>

                            <!-- Endere√ßo -->
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                    <svg class="w-5 h-5 mr-2 text-blue-600" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                                    </svg>
                                    Endere√ßo
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                    <div class="lg:col-span-2">
                                        <label for="dynamic-driver-endereco" class="block text-sm font-medium text-gray-700 mb-1">Logradouro</label>
                                        <input type="text" id="dynamic-driver-endereco" placeholder="Rua das Flores, 123" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                                    </div>
                                    <div>
                                        <label for="dynamic-driver-bairro" class="block text-sm font-medium text-gray-700 mb-1">Bairro</label>
                                        <input type="text" id="dynamic-driver-bairro" placeholder="Centro" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                                    </div>
                                    <div>
                                        <label for="dynamic-driver-cep" class="block text-sm font-medium text-gray-700 mb-1">CEP</label>
                                        <input type="text" id="dynamic-driver-cep" placeholder="12345-678" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                                    </div>
                                    <div>
                                        <label for="dynamic-driver-cidade" class="block text-sm font-medium text-gray-700 mb-1">Cidade</label>
                                        <input type="text" id="dynamic-driver-cidade" placeholder="S√£o Paulo" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                                    </div>
                                    <div>
                                        <label for="dynamic-driver-estado" class="block text-sm font-medium text-gray-700 mb-1">Estado</label>
                                        <select id="dynamic-driver-estado" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                                            <option value="">Selecione</option>
                                            <option value="AC">Acre</option>
                                            <option value="AL">Alagoas</option>
                                            <option value="AP">Amap√°</option>
                                            <option value="AM">Amazonas</option>
                                            <option value="BA">Bahia</option>
                                            <option value="CE">Cear√°</option>
                                            <option value="DF">Distrito Federal</option>
                                            <option value="ES">Esp√≠rito Santo</option>
                                            <option value="GO">Goi√°s</option>
                                            <option value="MA">Maranh√£o</option>
                                            <option value="MT">Mato Grosso</option>
                                            <option value="MS">Mato Grosso do Sul</option>
                                            <option value="MG">Minas Gerais</option>
                                            <option value="PA">Par√°</option>
                                            <option value="PB">Para√≠ba</option>
                                            <option value="PR">Paran√°</option>
                                            <option value="PE">Pernambuco</option>
                                            <option value="PI">Piau√≠</option>
                                            <option value="RJ">Rio de Janeiro</option>
                                            <option value="RN">Rio Grande do Norte</option>
                                            <option value="RS">Rio Grande do Sul</option>
                                            <option value="RO">Rond√¥nia</option>
                                            <option value="RR">Roraima</option>
                                            <option value="SC">Santa Catarina</option>
                                            <option value="SP">S√£o Paulo</option>
                                            <option value="SE">Sergipe</option>
                                            <option value="TO">Tocantins</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Habilita√ß√£o -->
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                    <svg class="w-5 h-5 mr-2 text-green-600" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
                                    </svg>
                                    Habilita√ß√£o
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                    <div>
                                        <label for="dynamic-driver-cnh" class="block text-sm font-medium text-gray-700 mb-1">N√∫mero da CNH *</label>
                                        <input type="text" id="dynamic-driver-cnh" placeholder="12345678901" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                                    </div>
                                    <div>
                                        <label for="dynamic-driver-categoria" class="block text-sm font-medium text-gray-700 mb-1">Categoria *</label>
                                        <select id="dynamic-driver-categoria" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                                            <option value="">Selecione</option>
                                            <option value="A">A - Motocicleta</option>
                                            <option value="B">B - Autom√≥vel</option>
                                            <option value="C">C - Caminh√£o</option>
                                            <option value="D">D - √înibus</option>
                                            <option value="E">E - Carreta</option>
                                            <option value="AB">AB - A + B</option>
                                            <option value="AC">AC - A + C</option>
                                            <option value="AD">AD - A + D</option>
                                            <option value="AE">AE - A + E</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="dynamic-driver-vencimento" class="date-label required">Vencimento CNH</label>
                                        <div class="date-input-container">
                                            <input type="date" id="dynamic-driver-vencimento" class="date-input required" placeholder="Selecione o vencimento" required>
                                            <svg class="date-input-icon w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                            </svg>
                                        </div>
                                    </div>
                                    <div>
                                        <label for="dynamic-driver-primeira" class="date-label">Primeira Habilita√ß√£o</label>
                                        <div class="date-input-container">
                                            <input type="date" id="dynamic-driver-primeira" class="date-input" placeholder="Selecione a primeira habilita√ß√£o">
                                            <svg class="date-input-icon w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                            </svg>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Informa√ß√µes Profissionais -->
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                    <svg class="w-5 h-5 mr-2 text-orange-600" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M20 6h-2.18c.11-.31.18-.65.18-1a2.996 2.996 0 0 0-5.5-1.65l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1z"/>
                                    </svg>
                                    Informa√ß√µes Profissionais
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    <div>
                                        <label for="dynamic-driver-vehicle" class="block text-sm font-medium text-gray-700 mb-1">Ve√≠culo Principal</label>
                                        <select id="dynamic-driver-vehicle" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                                            <option value="">Selecione um ve√≠culo</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="dynamic-driver-admissao" class="date-label">Data de Admiss√£o</label>
                                        <div class="date-input-container">
                                            <input type="date" id="dynamic-driver-admissao" class="date-input" placeholder="Selecione a data de admiss√£o">
                                            <svg class="date-input-icon w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                            </svg>
                                        </div>
                                    </div>
                                    <div>
                                        <label for="dynamic-driver-status" class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                                        <select id="dynamic-driver-status" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                                            <option value="Ativo">Ativo</option>
                                            <option value="Inativo">Inativo</option>
                                            <option value="F√©rias">F√©rias</option>
                                            <option value="Afastado">Afastado</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Observa√ß√µes -->
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                    <svg class="w-5 h-5 mr-2 text-gray-600" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                                    </svg>
                                    Observa√ß√µes Adicionais
                                </h4>
                                <div>
                                    <label for="dynamic-driver-observacoes" class="block text-sm font-medium text-gray-700 mb-1">Observa√ß√µes</label>
                                    <textarea id="dynamic-driver-observacoes" rows="3" placeholder="Informa√ß√µes adicionais sobre o motorista..." class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500"></textarea>
                                </div>
                            </div>

                            <!-- Bot√£o de Submit -->
                            <div class="flex justify-end pt-4">
                                <button type="submit" id="dynamic-driver-submit" class="bg-purple-600 text-white px-8 py-3 rounded-lg hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 flex items-center">
                                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                                    </svg>
                                    Cadastrar Motorista
                                </button>
                            </div>
                        </form>
                    `
                },
                station: {
                    title: 'Cadastrar Novo Posto',
                    html: `
                        <form id="dynamic-station-form" class="space-y-6">
                            <!-- Informa√ß√µes B√°sicas -->
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                    <svg class="w-5 h-5 mr-2 text-orange-600" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M19.77 7.23l.01-.01-3.72-3.72L15 4.56l2.11 2.11c-.94.36-1.61 1.26-1.61 2.33 0 1.38 1.12 2.5 2.5 2.5.84 0 1.58-.41 2.03-1.03L22 12.44V20c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2h7.5l1.5-1.5L15 4.56 13.5 6H4v14h16v-7.56l-2.23-2.21zM18 9c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1z"/>
                                    </svg>
                                    Informa√ß√µes B√°sicas
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    <div>
                                        <label for="dynamic-station-nome" class="block text-sm font-medium text-gray-700 mb-1">Nome do Posto *</label>
                                        <input type="text" id="dynamic-station-nome" placeholder="Posto Shell Centro" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500" required>
                                    </div>
                                    <div>
                                        <label for="dynamic-station-razao" class="block text-sm font-medium text-gray-700 mb-1">Raz√£o Social</label>
                                        <input type="text" id="dynamic-station-razao" placeholder="Shell Brasil Ltda" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500">
                                    </div>
                                    <div>
                                        <label for="dynamic-station-cnpj" class="block text-sm font-medium text-gray-700 mb-1">CNPJ *</label>
                                        <input type="text" id="dynamic-station-cnpj" placeholder="12.345.678/0001-90" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500" required>
                                    </div>
                                    <div>
                                        <label for="dynamic-station-inscricao" class="block text-sm font-medium text-gray-700 mb-1">Inscri√ß√£o Estadual</label>
                                        <input type="text" id="dynamic-station-inscricao" placeholder="123.456.789.012" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500">
                                    </div>
                                    <div>
                                        <label for="dynamic-station-bandeira" class="block text-sm font-medium text-gray-700 mb-1">Bandeira</label>
                                        <select id="dynamic-station-bandeira" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500">
                                            <option value="">Selecione</option>
                                            <option value="Shell">Shell</option>
                                            <option value="Petrobras">Petrobras</option>
                                            <option value="Ipiranga">Ipiranga</option>
                                            <option value="Ra√≠zen">Ra√≠zen</option>
                                            <option value="Ale">Ale</option>
                                            <option value="Texaco">Texaco</option>
                                            <option value="Posto Branco">Posto Branco</option>
                                            <option value="Outros">Outros</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="dynamic-station-codigo" class="block text-sm font-medium text-gray-700 mb-1">C√≥digo ANP</label>
                                        <input type="text" id="dynamic-station-codigo" placeholder="12345" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500">
                                    </div>
                                </div>
                            </div>

                            <!-- Endere√ßo -->
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                    <svg class="w-5 h-5 mr-2 text-blue-600" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                                    </svg>
                                    Endere√ßo
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                    <div class="lg:col-span-2">
                                        <label for="dynamic-station-endereco" class="block text-sm font-medium text-gray-700 mb-1">Logradouro *</label>
                                        <input type="text" id="dynamic-station-endereco" placeholder="Av. Paulista, 1000" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500" required>
                                    </div>
                                    <div>
                                        <label for="dynamic-station-numero" class="block text-sm font-medium text-gray-700 mb-1">N√∫mero</label>
                                        <input type="text" id="dynamic-station-numero" placeholder="1000" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500">
                                    </div>
                                    <div>
                                        <label for="dynamic-station-complemento" class="block text-sm font-medium text-gray-700 mb-1">Complemento</label>
                                        <input type="text" id="dynamic-station-complemento" placeholder="Esquina" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500">
                                    </div>
                                    <div>
                                        <label for="dynamic-station-bairro" class="block text-sm font-medium text-gray-700 mb-1">Bairro *</label>
                                        <input type="text" id="dynamic-station-bairro" placeholder="Bela Vista" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500" required>
                                    </div>
                                    <div>
                                        <label for="dynamic-station-cep" class="block text-sm font-medium text-gray-700 mb-1">CEP *</label>
                                        <input type="text" id="dynamic-station-cep" placeholder="01310-100" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500" required>
                                    </div>
                                    <div>
                                        <label for="dynamic-station-cidade" class="block text-sm font-medium text-gray-700 mb-1">Cidade *</label>
                                        <input type="text" id="dynamic-station-cidade" placeholder="S√£o Paulo" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500" required>
                                    </div>
                                    <div>
                                        <label for="dynamic-station-estado" class="block text-sm font-medium text-gray-700 mb-1">Estado *</label>
                                        <select id="dynamic-station-estado" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500" required>
                                            <option value="">Selecione</option>
                                            <option value="AC">Acre</option>
                                            <option value="AL">Alagoas</option>
                                            <option value="AP">Amap√°</option>
                                            <option value="AM">Amazonas</option>
                                            <option value="BA">Bahia</option>
                                            <option value="CE">Cear√°</option>
                                            <option value="DF">Distrito Federal</option>
                                            <option value="ES">Esp√≠rito Santo</option>
                                            <option value="GO">Goi√°s</option>
                                            <option value="MA">Maranh√£o</option>
                                            <option value="MT">Mato Grosso</option>
                                            <option value="MS">Mato Grosso do Sul</option>
                                            <option value="MG">Minas Gerais</option>
                                            <option value="PA">Par√°</option>
                                            <option value="PB">Para√≠ba</option>
                                            <option value="PR">Paran√°</option>
                                            <option value="PE">Pernambuco</option>
                                            <option value="PI">Piau√≠</option>
                                            <option value="RJ">Rio de Janeiro</option>
                                            <option value="RN">Rio Grande do Norte</option>
                                            <option value="RS">Rio Grande do Sul</option>
                                            <option value="RO">Rond√¥nia</option>
                                            <option value="RR">Roraima</option>
                                            <option value="SC">Santa Catarina</option>
                                            <option value="SP">S√£o Paulo</option>
                                            <option value="SE">Sergipe</option>
                                            <option value="TO">Tocantins</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Contato -->
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                    <svg class="w-5 h-5 mr-2 text-green-600" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                                    </svg>
                                    Informa√ß√µes de Contato
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    <div>
                                        <label for="dynamic-station-telefone" class="block text-sm font-medium text-gray-700 mb-1">Telefone</label>
                                        <input type="tel" id="dynamic-station-telefone" placeholder="(11) 3333-4444" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500">
                                    </div>
                                    <div>
                                        <label for="dynamic-station-celular" class="block text-sm font-medium text-gray-700 mb-1">Celular</label>
                                        <input type="tel" id="dynamic-station-celular" placeholder="(11) 99999-8888" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500">
                                    </div>
                                    <div>
                                        <label for="dynamic-station-email" class="block text-sm font-medium text-gray-700 mb-1">E-mail</label>
                                        <input type="email" id="dynamic-station-email" placeholder="contato@posto.com.br" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500">
                                    </div>
                                    <div>
                                        <label for="dynamic-station-responsavel" class="block text-sm font-medium text-gray-700 mb-1">Respons√°vel</label>
                                        <input type="text" id="dynamic-station-responsavel" placeholder="Jo√£o Silva" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500">
                                    </div>
                                    <div>
                                        <label for="dynamic-station-cargo" class="block text-sm font-medium text-gray-700 mb-1">Cargo</label>
                                        <input type="text" id="dynamic-station-cargo" placeholder="Gerente" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500">
                                    </div>
                                </div>
                            </div>

                            <!-- Informa√ß√µes Comerciais -->
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                    <svg class="w-5 h-5 mr-2 text-purple-600" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                                    </svg>
                                    Informa√ß√µes Comerciais
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                    <div>
                                        <label for="dynamic-station-horario" class="block text-sm font-medium text-gray-700 mb-1">Hor√°rio de Funcionamento</label>
                                        <input type="text" id="dynamic-station-horario" placeholder="24h ou 06:00 √†s 22:00" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500">
                                    </div>
                                    <div>
                                        <label for="dynamic-station-convenio" class="block text-sm font-medium text-gray-700 mb-1">Conv√™nio</label>
                                        <select id="dynamic-station-convenio" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500">
                                            <option value="">Selecione</option>
                                            <option value="Sim">Sim</option>
                                            <option value="N√£o">N√£o</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="dynamic-station-desconto" class="block text-sm font-medium text-gray-700 mb-1">Desconto (%)</label>
                                        <input type="number" step="0.01" id="dynamic-station-desconto" placeholder="5.00" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500">
                                    </div>
                                    <div>
                                        <label for="dynamic-station-status" class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                                        <select id="dynamic-station-status" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500">
                                            <option value="Ativo">Ativo</option>
                                            <option value="Inativo">Inativo</option>
                                            <option value="Suspenso">Suspenso</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Observa√ß√µes -->
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                    <svg class="w-5 h-5 mr-2 text-gray-600" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                                    </svg>
                                    Observa√ß√µes Adicionais
                                </h4>
                                <div>
                                    <label for="dynamic-station-observacoes" class="block text-sm font-medium text-gray-700 mb-1">Observa√ß√µes</label>
                                    <textarea id="dynamic-station-observacoes" rows="3" placeholder="Informa√ß√µes adicionais sobre o posto..." class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"></textarea>
                                </div>
                            </div>

                            <!-- Bot√£o de Submit -->
                            <div class="flex justify-end pt-4">
                                <button type="submit" id="dynamic-station-submit" class="bg-orange-600 text-white px-8 py-3 rounded-lg hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-orange-500 flex items-center">
                                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                                    </svg>
                                    Cadastrar Posto
                                </button>
                            </div>
                        </form>
                    `
                },
                fueling: {
                    title: 'Registrar Abastecimento',
                    html: `
                        <form id="dynamic-fueling-form" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <div>
                                <label for="dynamic-fueling-vehicle" class="block text-sm font-medium text-gray-700 mb-1">Ve√≠culo</label>
                                <select id="dynamic-fueling-vehicle" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500" required>
                                    <option value="">Selecione um ve√≠culo</option>
                                </select>
                            </div>
                            <div>
                                <label for="dynamic-fueling-order" class="block text-sm font-medium text-gray-700 mb-1">Ordem de Servi√ßo</label>
                                <select id="dynamic-fueling-order" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500" required>
                                    <option value="">Selecione uma OS</option>
                                </select>
                            </div>
                            <div>
                                <label for="dynamic-fueling-station" class="block text-sm font-medium text-gray-700 mb-1">Posto</label>
                                <select id="dynamic-fueling-station" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500" required>
                                    <option value="">Selecione um posto</option>
                                </select>
                            </div>
                            <div>
                                <label for="dynamic-fueling-data" class="date-label required">Data</label>
                                <div class="date-input-container">
                                    <input type="date" id="dynamic-fueling-data" class="date-input required" placeholder="Selecione a data" required>
                                    <svg class="date-input-icon w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                    </svg>
                                </div>
                            </div>
                            <div>
                                <label for="dynamic-fueling-km" class="block text-sm font-medium text-gray-700 mb-1">KM Atual</label>
                                <input type="number" id="dynamic-fueling-km" placeholder="50000" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500" required>
                            </div>
                            <div>
                                <label for="dynamic-fueling-litros" class="block text-sm font-medium text-gray-700 mb-1">Litros</label>
                                <input type="number" step="0.01" id="dynamic-fueling-litros" placeholder="45.5" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500" required>
                            </div>
                            <div>
                                <label for="dynamic-fueling-valor" class="block text-sm font-medium text-gray-700 mb-1">Valor Total (R$)</label>
                                <input type="number" step="0.01" id="dynamic-fueling-valor" placeholder="250.00" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500" required>
                            </div>
                            <div>
                                <label for="dynamic-fueling-vencimento" class="date-label required">Data de Vencimento</label>
                                <div class="date-input-container">
                                    <input type="date" id="dynamic-fueling-vencimento" class="date-input required" placeholder="Selecione o vencimento" required>
                                    <svg class="date-input-icon w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </div>
                            </div>
                            <div class="md:col-span-2 lg:col-span-3">
                                <button type="submit" id="dynamic-fueling-submit" class="bg-orange-600 text-white px-6 py-2 rounded-md hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-orange-500">
                                    Registrar Abastecimento
                                </button>
                            </div>
                        </form>
                    `
                },
                expense: {
                    title: 'Registrar Outras Despesas',
                    html: `
                        <form id="dynamic-expense-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="dynamic-expense-order" class="block text-sm font-medium text-gray-700 mb-1">Ordem de Servi√ßo</label>
                                <select id="dynamic-expense-order" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500" required>
                                    <option value="">Selecione uma OS</option>
                                </select>
                            </div>
                            <div>
                                <label for="dynamic-expense-tipo" class="block text-sm font-medium text-gray-700 mb-1">Tipo</label>
                                <select id="dynamic-expense-tipo" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500" required>
                                    <option value="">Selecione o tipo</option>
                                    <option value="Ped√°gio">Ped√°gio</option>
                                    <option value="Manuten√ß√£o">Manuten√ß√£o</option>
                                    <option value="Pe√ßas">Pe√ßas</option>
                                    <option value="Multa">Multa</option>
                                    <option value="Seguro">Seguro</option>
                                    <option value="Outros">Outros</option>
                                </select>
                            </div>
                            <div>
                                <label for="dynamic-expense-supplier" class="block text-sm font-medium text-gray-700 mb-1">Fornecedor</label>
                                <select id="dynamic-expense-supplier" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500">
                                    <option value="">Selecione um fornecedor (opcional)</option>
                                </select>
                            </div>
                            <div>
                                <label for="dynamic-expense-data" class="date-label required">Data</label>
                                <div class="date-input-container">
                                    <input type="date" id="dynamic-expense-data" class="date-input required" placeholder="Selecione a data" required>
                                    <svg class="date-input-icon w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                    </svg>
                                </div>
                            </div>
                            <div>
                                <label for="dynamic-expense-valor" class="block text-sm font-medium text-gray-700 mb-1">Valor (R$)</label>
                                <input type="number" step="0.01" id="dynamic-expense-valor" placeholder="100.00" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500" required>
                            </div>
                            <div>
                                <label for="dynamic-expense-vencimento" class="date-label required">Data de Vencimento</label>
                                <div class="date-input-container">
                                    <input type="date" id="dynamic-expense-vencimento" class="date-input required" placeholder="Selecione o vencimento" required>
                                    <svg class="date-input-icon w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </div>
                            </div>
                            <div class="md:col-span-2">
                                <label for="dynamic-expense-descricao" class="block text-sm font-medium text-gray-700 mb-1">Descri√ß√£o</label>
                                <input type="text" id="dynamic-expense-descricao" placeholder="Descri√ß√£o da despesa" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500" required>
                            </div>
                            <div class="md:col-span-2">
                                <button type="submit" id="dynamic-expense-submit" class="bg-red-600 text-white px-6 py-2 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500">
                                    Registrar Despesa
                                </button>
                            </div>
                        </form>
                    `
                },
                supplier: {
                    title: 'Cadastrar Novo Fornecedor',
                    html: `
                        <form id="dynamic-supplier-form" class="space-y-6">
                            <!-- Informa√ß√µes B√°sicas -->
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                    <svg class="w-5 h-5 mr-2 text-indigo-600" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M20 6h-2.18c.11-.31.18-.65.18-1a2.996 2.996 0 0 0-5.5-1.65l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1z"/>
                                    </svg>
                                    Informa√ß√µes B√°sicas
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    <div>
                                        <label for="dynamic-supplier-nome" class="block text-sm font-medium text-gray-700 mb-1">Nome do Fornecedor *</label>
                                        <input type="text" id="dynamic-supplier-nome" placeholder="Oficina Silva Ltda" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                                    </div>
                                    <div>
                                        <label for="dynamic-supplier-razao" class="block text-sm font-medium text-gray-700 mb-1">Raz√£o Social</label>
                                        <input type="text" id="dynamic-supplier-razao" placeholder="Silva Servi√ßos Automotivos Ltda" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    </div>
                                    <div>
                                        <label for="dynamic-supplier-cnpj" class="block text-sm font-medium text-gray-700 mb-1">CNPJ/CPF *</label>
                                        <input type="text" id="dynamic-supplier-cnpj" placeholder="12.345.678/0001-90" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                                    </div>
                                    <div>
                                        <label for="dynamic-supplier-categoria" class="block text-sm font-medium text-gray-700 mb-1">Categoria</label>
                                        <select id="dynamic-supplier-categoria" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                            <option value="">Selecione</option>
                                            <option value="Posto de Combust√≠vel">Posto de Combust√≠vel</option>
                                            <option value="Oficina Mec√¢nica">Oficina Mec√¢nica</option>
                                            <option value="Autope√ßas">Autope√ßas</option>
                                            <option value="Borracharia">Borracharia</option>
                                            <option value="Funilaria">Funilaria</option>
                                            <option value="El√©trica Automotiva">El√©trica Automotiva</option>
                                            <option value="Seguradora">Seguradora</option>
                                            <option value="Despachante">Despachante</option>
                                            <option value="Lavagem">Lavagem</option>
                                            <option value="Outros">Outros</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="dynamic-supplier-especialidade" class="block text-sm font-medium text-gray-700 mb-1">Especialidade</label>
                                        <input type="text" id="dynamic-supplier-especialidade" placeholder="Manuten√ß√£o preventiva" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    </div>
                                </div>
                            </div>

                            <!-- Endere√ßo -->
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                    <svg class="w-5 h-5 mr-2 text-blue-600" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                                    </svg>
                                    Endere√ßo
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                    <div class="lg:col-span-2">
                                        <label for="dynamic-supplier-endereco" class="block text-sm font-medium text-gray-700 mb-1">Logradouro</label>
                                        <input type="text" id="dynamic-supplier-endereco" placeholder="Rua das Oficinas, 123" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    </div>
                                    <div>
                                        <label for="dynamic-supplier-numero" class="block text-sm font-medium text-gray-700 mb-1">N√∫mero</label>
                                        <input type="text" id="dynamic-supplier-numero" placeholder="123" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    </div>
                                    <div>
                                        <label for="dynamic-supplier-complemento" class="block text-sm font-medium text-gray-700 mb-1">Complemento</label>
                                        <input type="text" id="dynamic-supplier-complemento" placeholder="Galp√£o A" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    </div>
                                    <div>
                                        <label for="dynamic-supplier-bairro" class="block text-sm font-medium text-gray-700 mb-1">Bairro</label>
                                        <input type="text" id="dynamic-supplier-bairro" placeholder="Industrial" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    </div>
                                    <div>
                                        <label for="dynamic-supplier-cep" class="block text-sm font-medium text-gray-700 mb-1">CEP</label>
                                        <input type="text" id="dynamic-supplier-cep" placeholder="12345-678" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    </div>
                                    <div>
                                        <label for="dynamic-supplier-cidade" class="block text-sm font-medium text-gray-700 mb-1">Cidade</label>
                                        <input type="text" id="dynamic-supplier-cidade" placeholder="S√£o Paulo" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    </div>
                                    <div>
                                        <label for="dynamic-supplier-estado" class="block text-sm font-medium text-gray-700 mb-1">Estado</label>
                                        <select id="dynamic-supplier-estado" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                            <option value="">Selecione</option>
                                            <option value="AC">Acre</option>
                                            <option value="AL">Alagoas</option>
                                            <option value="AP">Amap√°</option>
                                            <option value="AM">Amazonas</option>
                                            <option value="BA">Bahia</option>
                                            <option value="CE">Cear√°</option>
                                            <option value="DF">Distrito Federal</option>
                                            <option value="ES">Esp√≠rito Santo</option>
                                            <option value="GO">Goi√°s</option>
                                            <option value="MA">Maranh√£o</option>
                                            <option value="MT">Mato Grosso</option>
                                            <option value="MS">Mato Grosso do Sul</option>
                                            <option value="MG">Minas Gerais</option>
                                            <option value="PA">Par√°</option>
                                            <option value="PB">Para√≠ba</option>
                                            <option value="PR">Paran√°</option>
                                            <option value="PE">Pernambuco</option>
                                            <option value="PI">Piau√≠</option>
                                            <option value="RJ">Rio de Janeiro</option>
                                            <option value="RN">Rio Grande do Norte</option>
                                            <option value="RS">Rio Grande do Sul</option>
                                            <option value="RO">Rond√¥nia</option>
                                            <option value="RR">Roraima</option>
                                            <option value="SC">Santa Catarina</option>
                                            <option value="SP">S√£o Paulo</option>
                                            <option value="SE">Sergipe</option>
                                            <option value="TO">Tocantins</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Contato -->
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                    <svg class="w-5 h-5 mr-2 text-green-600" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                                    </svg>
                                    Informa√ß√µes de Contato
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    <div>
                                        <label for="dynamic-supplier-telefone" class="block text-sm font-medium text-gray-700 mb-1">Telefone</label>
                                        <input type="tel" id="dynamic-supplier-telefone" placeholder="(11) 3333-4444" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    </div>
                                    <div>
                                        <label for="dynamic-supplier-celular" class="block text-sm font-medium text-gray-700 mb-1">Celular</label>
                                        <input type="tel" id="dynamic-supplier-celular" placeholder="(11) 99999-8888" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    </div>
                                    <div>
                                        <label for="dynamic-supplier-email" class="block text-sm font-medium text-gray-700 mb-1">E-mail</label>
                                        <input type="email" id="dynamic-supplier-email" placeholder="contato@oficina.com.br" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    </div>
                                    <div>
                                        <label for="dynamic-supplier-responsavel" class="block text-sm font-medium text-gray-700 mb-1">Respons√°vel</label>
                                        <input type="text" id="dynamic-supplier-responsavel" placeholder="Jo√£o Silva" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    </div>
                                    <div>
                                        <label for="dynamic-supplier-cargo" class="block text-sm font-medium text-gray-700 mb-1">Cargo</label>
                                        <input type="text" id="dynamic-supplier-cargo" placeholder="Gerente" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    </div>
                                </div>
                            </div>

                            <!-- Informa√ß√µes Comerciais -->
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                    <svg class="w-5 h-5 mr-2 text-purple-600" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                                    </svg>
                                    Informa√ß√µes Comerciais
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                    <div>
                                        <label for="dynamic-supplier-horario" class="block text-sm font-medium text-gray-700 mb-1">Hor√°rio de Funcionamento</label>
                                        <input type="text" id="dynamic-supplier-horario" placeholder="08:00 √†s 18:00" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    </div>
                                    <div>
                                        <label for="dynamic-supplier-prazo" class="block text-sm font-medium text-gray-700 mb-1">Prazo de Pagamento</label>
                                        <input type="text" id="dynamic-supplier-prazo" placeholder="30 dias" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    </div>
                                    <div>
                                        <label for="dynamic-supplier-desconto" class="block text-sm font-medium text-gray-700 mb-1">Desconto (%)</label>
                                        <input type="number" step="0.01" id="dynamic-supplier-desconto" placeholder="5.00" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    </div>
                                    <div>
                                        <label for="dynamic-supplier-status" class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                                        <select id="dynamic-supplier-status" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                            <option value="Ativo">Ativo</option>
                                            <option value="Inativo">Inativo</option>
                                            <option value="Suspenso">Suspenso</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Observa√ß√µes -->
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                    <svg class="w-5 h-5 mr-2 text-gray-600" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                                    </svg>
                                    Observa√ß√µes Adicionais
                                </h4>
                                <div>
                                    <label for="dynamic-supplier-observacoes" class="block text-sm font-medium text-gray-700 mb-1">Observa√ß√µes</label>
                                    <textarea id="dynamic-supplier-observacoes" rows="3" placeholder="Informa√ß√µes adicionais sobre o fornecedor..." class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
                                </div>
                            </div>

                            <!-- Bot√£o de Submit -->
                            <div class="flex justify-end pt-4">
                                <button type="submit" id="dynamic-supplier-submit" class="bg-indigo-600 text-white px-8 py-3 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 flex items-center">
                                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                                    </svg>
                                    Cadastrar Fornecedor
                                </button>
                            </div>
                        </form>
                    `
                },

            };

            const config = formConfigs[type];
            if (!config) return;

            // Set title and content
            title.textContent = config.title;
            content.innerHTML = config.html;

            // Show modal
            overlay.classList.remove('hidden');

            // Setup form listener
            const form = content.querySelector('form');
            if (form) {
                form.addEventListener('submit', (e) => handleDynamicFormSubmit(e, type));
            }

            // Update selects for forms that need them
            updateDynamicSelects(type);

            // Set today's date for date fields
            const dateFields = content.querySelectorAll('input[type="date"]');
            const today = new Date().toISOString().split('T')[0];
            const nextMonth = new Date();
            nextMonth.setMonth(nextMonth.getMonth() + 1);
            const nextMonthStr = nextMonth.toISOString().split('T')[0];
            
            dateFields.forEach(field => {
                if (field.id === 'dynamic-order-data-abertura') {
                    field.value = today; // Data de abertura sempre hoje
                } else if (field.id === 'dynamic-fueling-vencimento' || field.id === 'dynamic-expense-vencimento') {
                    field.value = nextMonthStr; // Data de vencimento padr√£o: pr√≥ximo m√™s
                } else if (!field.value) {
                    field.value = today; // Outros campos s√≥ se estiverem vazios
                }
            });
        }

        // Close modal
        function closeModal() {
            const overlay = document.getElementById('modal-overlay');
            overlay.classList.add('hidden');
        }

        // Update dynamic selects
        function updateDynamicSelects(type) {
            const vehicles = allData.filter(item => item.type === 'vehicle');
            const orders = allData.filter(item => item.type === 'order' && item.status !== 'Fechada');
            const stations = allData.filter(item => item.type === 'station');
            const suppliers = allData.filter(item => item.type === 'supplier');

            // Update vehicle selects
            if (['driver', 'fueling'].includes(type)) {
                const selectId = type === 'driver' ? 'dynamic-driver-vehicle' : 'dynamic-fueling-vehicle';
                const select = document.getElementById(selectId);
                if (select) {
                    select.innerHTML = '<option value="">Selecione um ve√≠culo</option>';
                    vehicles.forEach(vehicle => {
                        const option = document.createElement('option');
                        option.value = vehicle.id;
                        option.textContent = `${vehicle.codigo} - ${vehicle.placa} - ${vehicle.marca} ${vehicle.modelo}`;
                        select.appendChild(option);
                    });
                }
            }

            // Update order selects
            if (['fueling', 'expense'].includes(type)) {
                const selectId = type === 'fueling' ? 'dynamic-fueling-order' : 'dynamic-expense-order';
                const select = document.getElementById(selectId);
                if (select) {
                    select.innerHTML = '<option value="">Selecione uma OS</option>';
                    orders.forEach(order => {
                        const option = document.createElement('option');
                        option.value = order.id;
                        option.textContent = `OS ${order.numero_os} - ${order.descricao}`;
                        select.appendChild(option);
                    });
                }
            }

            // Update station select (now using suppliers with "Posto de Combust√≠vel" category)
            if (type === 'fueling') {
                const select = document.getElementById('dynamic-fueling-station');
                if (select) {
                    select.innerHTML = '<option value="">Selecione um posto</option>';
                    // Filter suppliers that are gas stations
                    const gasStations = suppliers.filter(s => s.categoria === 'Posto de Combust√≠vel');
                    gasStations.forEach(station => {
                        const option = document.createElement('option');
                        option.value = station.id;
                        option.textContent = station.nome_fornecedor;
                        select.appendChild(option);
                    });
                }
            }

            // Update supplier select
            if (type === 'expense') {
                const select = document.getElementById('dynamic-expense-supplier');
                if (select) {
                    select.innerHTML = '<option value="">Selecione um fornecedor (opcional)</option>';
                    suppliers.forEach(supplier => {
                        const option = document.createElement('option');
                        option.value = supplier.id;
                        option.textContent = supplier.nome_fornecedor;
                        select.appendChild(option);
                    });
                }
            }
        }

        // Handle dynamic form submission
        async function handleDynamicFormSubmit(e, type) {
            e.preventDefault();
            
            const handlers = {
                order: handleDynamicOrderSubmit,
                vehicle: handleDynamicVehicleSubmit,
                driver: handleDynamicDriverSubmit,
                station: handleDynamicStationSubmit,
                fueling: handleDynamicFuelingSubmit,
                expense: handleDynamicExpenseSubmit,
                supplier: handleDynamicSupplierSubmit
            };

            const handler = handlers[type];
            if (handler) {
                await handler(e);
            }
        }

        // Dynamic form handlers
        async function handleDynamicOrderSubmit(e) {
            e.preventDefault();
            console.log('üìã Criando ordem de servi√ßo...');

            const orders = allData.filter(item => item.type === 'order');
            if (orders.length >= 999) {
                showToast('Limite m√°ximo de 999 ordens atingido', 'error');
                return;
            }

            const submitBtn = document.getElementById('dynamic-order-submit');
            submitBtn.classList.add('loading');
            submitBtn.innerHTML = '<svg class="w-4 h-4 mr-2 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>Criando...';

            try {
                // Encontrar o pr√≥ximo n√∫mero dispon√≠vel
                const existingNumbers = orders.map(o => parseInt(o.numero_os) || 0);
                const nextNumber = Math.max(0, ...existingNumbers) + 1;
                const numeroFormatado = String(nextNumber).padStart(4, '0');
                
                const dataAbertura = document.getElementById('dynamic-order-data-abertura').value;
                const previsaoTermino = document.getElementById('dynamic-order-previsao-termino').value;
                
                const orderData = {
                    id: generateId(),
                    type: 'order',
                    numero_os: numeroFormatado,
                    descricao: document.getElementById('dynamic-order-descricao').value,
                    data_abertura: dataAbertura ? new Date(dataAbertura + 'T00:00:00').toISOString() : new Date().toISOString(),
                    previsao_termino: previsaoTermino ? new Date(previsaoTermino + 'T00:00:00').toISOString() : '',
                    data_fechamento: '',
                    status: 'Aberta',
                    prioridade: document.getElementById('dynamic-order-prioridade').value || 'Normal',
                    responsavel: document.getElementById('dynamic-order-responsavel').value || '',
                    observacoes: document.getElementById('dynamic-order-observacoes').value || '',
                    created_at: new Date().toISOString()
                };

                console.log('üìù Dados da OS:', orderData);

                if (window.dataSdk) {
                    const result = await window.dataSdk.create(orderData);
                    
                    if (result.isOk) {
                        document.getElementById('dynamic-order-form').reset();
                        // Reset data de abertura para hoje
                        document.getElementById('dynamic-order-data-abertura').value = new Date().toISOString().split('T')[0];
                        // Reset prioridade para Normal
                        document.getElementById('dynamic-order-prioridade').value = 'Normal';
                        showToast('Ordem de servi√ßo criada com sucesso!', 'success');
                        closeModal();
                        console.log('‚úÖ OS criada com sucesso');
                    } else {
                        showToast('Erro ao criar ordem de servi√ßo', 'error');
                        console.error('‚ùå Erro ao criar OS:', result.error);
                    }
                }
            } catch (error) {
                console.error('üí• Erro inesperado:', error);
                showToast('Erro inesperado ao criar ordem de servi√ßo', 'error');
            } finally {
                submitBtn.classList.remove('loading');
                submitBtn.innerHTML = '<svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>Criar Ordem de Servi√ßo';
            }
        }

        async function handleDynamicExpenseSubmit(e) {
            e.preventDefault();
            console.log('üí∞ Registrando despesa...');

            const expenses = allData.filter(item => item.type === 'expense');
            if (expenses.length >= 999) {
                showToast('Limite m√°ximo de 999 despesas atingido', 'error');
                return;
            }

            const submitBtn = document.getElementById('dynamic-expense-submit');
            submitBtn.classList.add('loading');
            submitBtn.textContent = 'Registrando...';

            try {
                const expenseData = {
                    id: generateId(),
                    type: 'expense',
                    order_id: document.getElementById('dynamic-expense-order').value,
                    tipo_despesa: document.getElementById('dynamic-expense-tipo').value,
                    supplier_id: document.getElementById('dynamic-expense-supplier').value || '',
                    descricao: document.getElementById('dynamic-expense-descricao').value,
                    valor_total: parseFloat(document.getElementById('dynamic-expense-valor').value),
                    data: document.getElementById('dynamic-expense-data').value,
                    data_vencimento: document.getElementById('dynamic-expense-vencimento').value,
                    conta_status: 'Pendente',
                    created_at: new Date().toISOString()
                };

                if (window.dataSdk) {
                    const result = await window.dataSdk.create(expenseData);
                    
                    if (result.isOk) {
                        document.getElementById('dynamic-expense-form').reset();
                        document.getElementById('dynamic-expense-data').value = new Date().toISOString().split('T')[0];
                        showToast('Despesa registrada com sucesso!', 'success');
                        closeModal();
                    } else {
                        showToast('Erro ao registrar despesa', 'error');
                    }
                }
            } catch (error) {
                showToast('Erro inesperado ao registrar despesa', 'error');
            } finally {
                submitBtn.classList.remove('loading');
                submitBtn.textContent = 'Registrar Despesa';
            }
        }

        async function handleDynamicSupplierSubmit(e) {
            e.preventDefault();
            console.log('üè¢ Cadastrando fornecedor...');

            const suppliers = allData.filter(item => item.type === 'supplier');
            if (suppliers.length >= 999) {
                showToast('Limite m√°ximo de 999 fornecedores atingido', 'error');
                return;
            }

            const submitBtn = document.getElementById('dynamic-supplier-submit');
            submitBtn.classList.add('loading');
            submitBtn.innerHTML = '<svg class="w-4 h-4 mr-2 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>Cadastrando...';

            try {
                const supplierData = {
                    id: generateId(),
                    type: 'supplier',
                    // Informa√ß√µes B√°sicas
                    nome_fornecedor: document.getElementById('dynamic-supplier-nome').value,
                    razao_social: document.getElementById('dynamic-supplier-razao').value || '',
                    cnpj: document.getElementById('dynamic-supplier-cnpj').value,
                    categoria: document.getElementById('dynamic-supplier-categoria').value || '',
                    especialidade: document.getElementById('dynamic-supplier-especialidade').value || '',
                    // Endere√ßo
                    endereco: document.getElementById('dynamic-supplier-endereco').value || '',
                    numero: document.getElementById('dynamic-supplier-numero').value || '',
                    complemento: document.getElementById('dynamic-supplier-complemento').value || '',
                    bairro: document.getElementById('dynamic-supplier-bairro').value || '',
                    cep: document.getElementById('dynamic-supplier-cep').value || '',
                    cidade: document.getElementById('dynamic-supplier-cidade').value || '',
                    estado: document.getElementById('dynamic-supplier-estado').value || '',
                    // Contato
                    telefone: document.getElementById('dynamic-supplier-telefone').value || '',
                    celular: document.getElementById('dynamic-supplier-celular').value || '',
                    email: document.getElementById('dynamic-supplier-email').value || '',
                    responsavel: document.getElementById('dynamic-supplier-responsavel').value || '',
                    cargo_responsavel: document.getElementById('dynamic-supplier-cargo').value || '',
                    // Informa√ß√µes Comerciais
                    horario_funcionamento: document.getElementById('dynamic-supplier-horario').value || '',
                    prazo_pagamento: document.getElementById('dynamic-supplier-prazo').value || '',
                    desconto_percentual: parseFloat(document.getElementById('dynamic-supplier-desconto').value) || 0,
                    status: document.getElementById('dynamic-supplier-status').value || 'Ativo',
                    // Observa√ß√µes
                    observacoes: document.getElementById('dynamic-supplier-observacoes').value || '',
                    created_at: new Date().toISOString()
                };

                if (window.dataSdk) {
                    const result = await window.dataSdk.create(supplierData);
                    
                    if (result.isOk) {
                        document.getElementById('dynamic-supplier-form').reset();
                        // Reset status to default
                        document.getElementById('dynamic-supplier-status').value = 'Ativo';
                        showToast('Fornecedor cadastrado com sucesso!', 'success');
                        closeModal();
                    } else {
                        showToast('Erro ao cadastrar fornecedor', 'error');
                    }
                }
            } catch (error) {
                showToast('Erro inesperado ao cadastrar fornecedor', 'error');
            } finally {
                submitBtn.classList.remove('loading');
                submitBtn.innerHTML = '<svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>Cadastrar Fornecedor';
            }
        }

        async function handleDynamicVehicleSubmit(e) {
            e.preventDefault();
            console.log('üöó Cadastrando ve√≠culo...');

            const vehicles = allData.filter(item => item.type === 'vehicle');
            if (vehicles.length >= 999) {
                showToast('Limite m√°ximo de 999 ve√≠culos atingido', 'error');
                return;
            }

            const submitBtn = document.getElementById('dynamic-vehicle-submit');
            submitBtn.classList.add('loading');
            submitBtn.innerHTML = '<svg class="w-4 h-4 mr-2 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>Cadastrando...';

            try {
                const vehicleData = {
                    id: generateId(),
                    type: 'vehicle',
                    codigo: document.getElementById('dynamic-vehicle-codigo').value,
                    placa: document.getElementById('dynamic-vehicle-placa').value.toUpperCase(),
                    marca: document.getElementById('dynamic-vehicle-marca').value,
                    modelo: document.getElementById('dynamic-vehicle-modelo').value,
                    ano: document.getElementById('dynamic-vehicle-ano').value || '',
                    ano_modelo: document.getElementById('dynamic-vehicle-ano-modelo').value || '',
                    cor: document.getElementById('dynamic-vehicle-cor').value || '',
                    chassi: document.getElementById('dynamic-vehicle-chassi').value || '',
                    renavam: document.getElementById('dynamic-vehicle-renavam').value || '',
                    odometro: parseInt(document.getElementById('dynamic-vehicle-odometro').value),
                    combustivel: document.getElementById('dynamic-vehicle-combustivel').value || '',
                    categoria: document.getElementById('dynamic-vehicle-categoria').value || '',
                    observacoes: document.getElementById('dynamic-vehicle-observacoes').value || '',
                    created_at: new Date().toISOString()
                };

                if (window.dataSdk) {
                    const result = await window.dataSdk.create(vehicleData);
                    
                    if (result.isOk) {
                        document.getElementById('dynamic-vehicle-form').reset();
                        showToast('Ve√≠culo cadastrado com sucesso!', 'success');
                        closeModal();
                    } else {
                        showToast('Erro ao cadastrar ve√≠culo', 'error');
                    }
                }
            } catch (error) {
                showToast('Erro inesperado ao cadastrar ve√≠culo', 'error');
            } finally {
                submitBtn.classList.remove('loading');
                submitBtn.innerHTML = '<svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>Cadastrar Ve√≠culo';
            }
        }

        async function handleDynamicDriverSubmit(e) {
            e.preventDefault();
            console.log('üë®‚Äçüíº Cadastrando motorista...');

            const drivers = allData.filter(item => item.type === 'driver');
            if (drivers.length >= 999) {
                showToast('Limite m√°ximo de 999 motoristas atingido', 'error');
                return;
            }

            const submitBtn = document.getElementById('dynamic-driver-submit');
            submitBtn.classList.add('loading');
            submitBtn.innerHTML = '<svg class="w-4 h-4 mr-2 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>Cadastrando...';

            try {
                const driverData = {
                    id: generateId(),
                    type: 'driver',
                    // Informa√ß√µes Pessoais
                    nome: document.getElementById('dynamic-driver-nome').value,
                    cpf: document.getElementById('dynamic-driver-cpf').value,
                    rg: document.getElementById('dynamic-driver-rg').value || '',
                    nascimento: document.getElementById('dynamic-driver-nascimento').value || '',
                    telefone: document.getElementById('dynamic-driver-telefone').value,
                    email: document.getElementById('dynamic-driver-email').value || '',
                    // Endere√ßo
                    endereco: document.getElementById('dynamic-driver-endereco').value || '',
                    bairro: document.getElementById('dynamic-driver-bairro').value || '',
                    cep: document.getElementById('dynamic-driver-cep').value || '',
                    cidade: document.getElementById('dynamic-driver-cidade').value || '',
                    estado: document.getElementById('dynamic-driver-estado').value || '',
                    // Habilita√ß√£o
                    cnh: document.getElementById('dynamic-driver-cnh').value,
                    categoria_cnh: document.getElementById('dynamic-driver-categoria').value,
                    vencimento_cnh: document.getElementById('dynamic-driver-vencimento').value,
                    primeira_habilitacao: document.getElementById('dynamic-driver-primeira').value || '',
                    // Informa√ß√µes Profissionais
                    vehicle_id: document.getElementById('dynamic-driver-vehicle').value || '',
                    data_admissao: document.getElementById('dynamic-driver-admissao').value || '',
                    status: document.getElementById('dynamic-driver-status').value || 'Ativo',
                    // Observa√ß√µes
                    observacoes: document.getElementById('dynamic-driver-observacoes').value || '',
                    created_at: new Date().toISOString()
                };

                if (window.dataSdk) {
                    const result = await window.dataSdk.create(driverData);
                    
                    if (result.isOk) {
                        document.getElementById('dynamic-driver-form').reset();
                        // Reset status to default
                        document.getElementById('dynamic-driver-status').value = 'Ativo';
                        showToast('Motorista cadastrado com sucesso!', 'success');
                        closeModal();
                    } else {
                        showToast('Erro ao cadastrar motorista', 'error');
                    }
                }
            } catch (error) {
                showToast('Erro inesperado ao cadastrar motorista', 'error');
            } finally {
                submitBtn.classList.remove('loading');
                submitBtn.innerHTML = '<svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>Cadastrar Motorista';
            }
        }

        async function handleDynamicStationSubmit(e) {
            e.preventDefault();
            console.log('‚õΩ Cadastrando posto...');

            const stations = allData.filter(item => item.type === 'station');
            if (stations.length >= 999) {
                showToast('Limite m√°ximo de 999 postos atingido', 'error');
                return;
            }

            const submitBtn = document.getElementById('dynamic-station-submit');
            submitBtn.classList.add('loading');
            submitBtn.innerHTML = '<svg class="w-4 h-4 mr-2 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>Cadastrando...';

            try {
                const stationData = {
                    id: generateId(),
                    type: 'station',
                    // Informa√ß√µes B√°sicas
                    nome_posto: document.getElementById('dynamic-station-nome').value,
                    razao_social: document.getElementById('dynamic-station-razao').value || '',
                    cnpj: document.getElementById('dynamic-station-cnpj').value,
                    inscricao_estadual: document.getElementById('dynamic-station-inscricao').value || '',
                    bandeira: document.getElementById('dynamic-station-bandeira').value || '',
                    codigo_anp: document.getElementById('dynamic-station-codigo').value || '',
                    // Endere√ßo
                    endereco: document.getElementById('dynamic-station-endereco').value,
                    numero: document.getElementById('dynamic-station-numero').value || '',
                    complemento: document.getElementById('dynamic-station-complemento').value || '',
                    bairro: document.getElementById('dynamic-station-bairro').value,
                    cep: document.getElementById('dynamic-station-cep').value,
                    cidade: document.getElementById('dynamic-station-cidade').value,
                    estado: document.getElementById('dynamic-station-estado').value,
                    // Contato
                    telefone: document.getElementById('dynamic-station-telefone').value || '',
                    celular: document.getElementById('dynamic-station-celular').value || '',
                    email: document.getElementById('dynamic-station-email').value || '',
                    responsavel: document.getElementById('dynamic-station-responsavel').value || '',
                    cargo_responsavel: document.getElementById('dynamic-station-cargo').value || '',
                    // Informa√ß√µes Comerciais
                    horario_funcionamento: document.getElementById('dynamic-station-horario').value || '',
                    convenio: document.getElementById('dynamic-station-convenio').value || '',
                    desconto_percentual: parseFloat(document.getElementById('dynamic-station-desconto').value) || 0,
                    status: document.getElementById('dynamic-station-status').value || 'Ativo',
                    // Observa√ß√µes
                    observacoes: document.getElementById('dynamic-station-observacoes').value || '',
                    created_at: new Date().toISOString()
                };

                if (window.dataSdk) {
                    const result = await window.dataSdk.create(stationData);
                    
                    if (result.isOk) {
                        document.getElementById('dynamic-station-form').reset();
                        // Reset status to default
                        document.getElementById('dynamic-station-status').value = 'Ativo';
                        showToast('Posto cadastrado com sucesso!', 'success');
                        closeModal();
                    } else {
                        showToast('Erro ao cadastrar posto', 'error');
                    }
                }
            } catch (error) {
                showToast('Erro inesperado ao cadastrar posto', 'error');
            } finally {
                submitBtn.classList.remove('loading');
                submitBtn.innerHTML = '<svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>Cadastrar Posto';
            }
        }

        async function handleDynamicFuelingSubmit(e) {
            e.preventDefault();
            console.log('‚õΩ Registrando abastecimento...');

            const fuelings = allData.filter(item => item.type === 'fueling');
            if (fuelings.length >= 999) {
                showToast('Limite m√°ximo de 999 abastecimentos atingido', 'error');
                return;
            }

            const submitBtn = document.getElementById('dynamic-fueling-submit');
            submitBtn.classList.add('loading');
            submitBtn.textContent = 'Registrando...';

            try {
                const fuelingData = {
                    id: generateId(),
                    type: 'fueling',
                    vehicle_id: document.getElementById('dynamic-fueling-vehicle').value,
                    order_id: document.getElementById('dynamic-fueling-order').value,
                    station_id: document.getElementById('dynamic-fueling-station').value,
                    data: document.getElementById('dynamic-fueling-data').value,
                    km_atual: parseInt(document.getElementById('dynamic-fueling-km').value),
                    litros: parseFloat(document.getElementById('dynamic-fueling-litros').value),
                    valor_total: parseFloat(document.getElementById('dynamic-fueling-valor').value),
                    data_vencimento: document.getElementById('dynamic-fueling-vencimento').value,
                    conta_status: 'Pendente',
                    created_at: new Date().toISOString()
                };

                if (window.dataSdk) {
                    const result = await window.dataSdk.create(fuelingData);
                    
                    if (result.isOk) {
                        document.getElementById('dynamic-fueling-form').reset();
                        document.getElementById('dynamic-fueling-data').value = new Date().toISOString().split('T')[0];
                        showToast('Abastecimento registrado com sucesso!', 'success');
                        closeModal();
                    } else {
                        showToast('Erro ao registrar abastecimento', 'error');
                    }
                }
            } catch (error) {
                showToast('Erro inesperado ao registrar abastecimento', 'error');
            } finally {
                submitBtn.classList.remove('loading');
                submitBtn.textContent = 'Registrar Abastecimento';
            }
        }



        // Handle order form submission (legacy - keeping for compatibility)
        async function handleOrderSubmit(e) {
            e.preventDefault();
            console.log('üìã Criando ordem de servi√ßo...');

            const orders = allData.filter(item => item.type === 'order');
            if (orders.length >= 999) {
                showToast('Limite m√°ximo de 999 ordens atingido', 'error');
                return;
            }

            const submitBtn = document.getElementById('order-submit');
            submitBtn.classList.add('loading');
            submitBtn.textContent = 'Criando...';

            try {
                const nextNumber = String(orders.length + 1).padStart(4, '0');
                
                const orderData = {
                    id: generateId(),
                    type: 'order',
                    numero_os: nextNumber,
                    descricao: document.getElementById('order-descricao').value,
                    data_abertura: new Date().toISOString(),
                    data_fechamento: '',
                    status: 'Aberta',
                    observacoes: document.getElementById('order-observacoes').value || '',
                    created_at: new Date().toISOString()
                };

                console.log('üìù Dados da OS:', orderData);

                if (window.dataSdk) {
                    const result = await window.dataSdk.create(orderData);
                    
                    if (result.isOk) {
                        document.getElementById('order-form').reset();
                        showToast('Ordem de servi√ßo criada com sucesso!', 'success');
                        console.log('‚úÖ OS criada');
                    } else {
                        showToast('Erro ao criar ordem de servi√ßo', 'error');
                        console.error('‚ùå Erro:', result.error);
                    }
                }

            } catch (error) {
                console.error('üí• Erro no cadastro:', error);
                showToast('Erro inesperado ao criar ordem de servi√ßo', 'error');
            } finally {
                submitBtn.classList.remove('loading');
                submitBtn.textContent = 'Criar Ordem de Servi√ßo';
            }
        }

        // Handle vehicle form submission
        async function handleVehicleSubmit(e) {
            e.preventDefault();
            console.log('üöó Cadastrando ve√≠culo...');

            const vehicles = allData.filter(item => item.type === 'vehicle');
            if (vehicles.length >= 999) {
                showToast('Limite m√°ximo de 999 ve√≠culos atingido', 'error');
                return;
            }

            const submitBtn = document.getElementById('vehicle-submit');
            submitBtn.classList.add('loading');
            submitBtn.textContent = 'Cadastrando...';

            try {
                const vehicleData = {
                    id: generateId(),
                    type: 'vehicle',
                    codigo: document.getElementById('vehicle-codigo').value,
                    placa: document.getElementById('vehicle-placa').value.toUpperCase(),
                    marca: document.getElementById('vehicle-marca').value,
                    modelo: document.getElementById('vehicle-modelo').value,
                    odometro: parseInt(document.getElementById('vehicle-odometro').value),
                    created_at: new Date().toISOString()
                };

                console.log('üìù Dados do ve√≠culo:', vehicleData);

                if (window.dataSdk) {
                    const result = await window.dataSdk.create(vehicleData);
                    
                    if (result.isOk) {
                        document.getElementById('vehicle-form').reset();
                        showToast('Ve√≠culo cadastrado com sucesso!', 'success');
                        console.log('‚úÖ Ve√≠culo cadastrado');
                    } else {
                        showToast('Erro ao cadastrar ve√≠culo', 'error');
                        console.error('‚ùå Erro:', result.error);
                    }
                }

            } catch (error) {
                console.error('üí• Erro no cadastro:', error);
                showToast('Erro inesperado ao cadastrar ve√≠culo', 'error');
            } finally {
                submitBtn.classList.remove('loading');
                submitBtn.textContent = 'Cadastrar Ve√≠culo';
            }
        }

        // Handle driver form submission
        async function handleDriverSubmit(e) {
            e.preventDefault();
            console.log('üë®‚Äçüíº Cadastrando motorista...');

            const drivers = allData.filter(item => item.type === 'driver');
            if (drivers.length >= 999) {
                showToast('Limite m√°ximo de 999 motoristas atingido', 'error');
                return;
            }

            const submitBtn = document.getElementById('driver-submit');
            submitBtn.classList.add('loading');
            submitBtn.textContent = 'Cadastrando...';

            try {
                const driverData = {
                    id: generateId(),
                    type: 'driver',
                    nome: document.getElementById('driver-nome').value,
                    cnh: document.getElementById('driver-cnh').value,
                    vehicle_id: document.getElementById('driver-vehicle').value || '',
                    created_at: new Date().toISOString()
                };

                console.log('üìù Dados do motorista:', driverData);

                if (window.dataSdk) {
                    const result = await window.dataSdk.create(driverData);
                    
                    if (result.isOk) {
                        document.getElementById('driver-form').reset();
                        showToast('Motorista cadastrado com sucesso!', 'success');
                        console.log('‚úÖ Motorista cadastrado');
                    } else {
                        showToast('Erro ao cadastrar motorista', 'error');
                        console.error('‚ùå Erro:', result.error);
                    }
                }

            } catch (error) {
                console.error('üí• Erro no cadastro:', error);
                showToast('Erro inesperado ao cadastrar motorista', 'error');
            } finally {
                submitBtn.classList.remove('loading');
                submitBtn.textContent = 'Cadastrar Motorista';
            }
        }

        // Handle station form submission
        async function handleStationSubmit(e) {
            e.preventDefault();
            console.log('‚õΩ Cadastrando posto...');

            const stations = allData.filter(item => item.type === 'station');
            if (stations.length >= 999) {
                showToast('Limite m√°ximo de 999 postos atingido', 'error');
                return;
            }

            const submitBtn = document.getElementById('station-submit');
            submitBtn.classList.add('loading');
            submitBtn.textContent = 'Cadastrando...';

            try {
                const stationData = {
                    id: generateId(),
                    type: 'station',
                    nome_posto: document.getElementById('station-nome').value,
                    cnpj: document.getElementById('station-cnpj').value,
                    endereco: document.getElementById('station-endereco').value || '',
                    created_at: new Date().toISOString()
                };

                console.log('üìù Dados do posto:', stationData);

                if (window.dataSdk) {
                    const result = await window.dataSdk.create(stationData);
                    
                    if (result.isOk) {
                        document.getElementById('station-form').reset();
                        showToast('Posto cadastrado com sucesso!', 'success');
                        console.log('‚úÖ Posto cadastrado');
                    } else {
                        showToast('Erro ao cadastrar posto', 'error');
                        console.error('‚ùå Erro:', result.error);
                    }
                }

            } catch (error) {
                console.error('üí• Erro no cadastro:', error);
                showToast('Erro inesperado ao cadastrar posto', 'error');
            } finally {
                submitBtn.classList.remove('loading');
                submitBtn.textContent = 'Cadastrar Posto';
            }
        }

        // Handle fueling form submission
        async function handleFuelingSubmit(e) {
            e.preventDefault();
            console.log('‚õΩ Registrando abastecimento...');

            const fuelings = allData.filter(item => item.type === 'fueling');
            if (fuelings.length >= 999) {
                showToast('Limite m√°ximo de 999 abastecimentos atingido', 'error');
                return;
            }

            const submitBtn = document.getElementById('fueling-submit');
            submitBtn.classList.add('loading');
            submitBtn.textContent = 'Registrando...';

            try {
                const fuelingData = {
                    id: generateId(),
                    type: 'fueling',
                    vehicle_id: document.getElementById('fueling-vehicle').value,
                    order_id: document.getElementById('fueling-order').value,
                    station_id: document.getElementById('fueling-station').value,
                    data: document.getElementById('fueling-data').value,
                    km_atual: parseInt(document.getElementById('fueling-km').value),
                    litros: parseFloat(document.getElementById('fueling-litros').value),
                    valor_total: parseFloat(document.getElementById('fueling-valor').value),
                    created_at: new Date().toISOString()
                };

                console.log('üìù Dados do abastecimento:', fuelingData);

                if (window.dataSdk) {
                    const result = await window.dataSdk.create(fuelingData);
                    
                    if (result.isOk) {
                        document.getElementById('fueling-form').reset();
                        document.getElementById('fueling-data').value = new Date().toISOString().split('T')[0];
                        showToast('Abastecimento registrado com sucesso!', 'success');
                        console.log('‚úÖ Abastecimento registrado');
                    } else {
                        showToast('Erro ao registrar abastecimento', 'error');
                        console.error('‚ùå Erro:', result.error);
                    }
                }

            } catch (error) {
                console.error('üí• Erro no registro:', error);
                showToast('Erro inesperado ao registrar abastecimento', 'error');
            } finally {
                submitBtn.classList.remove('loading');
                submitBtn.textContent = 'Registrar Abastecimento';
            }
        }



        // Handle expense form submission
        async function handleExpenseSubmit(e) {
            e.preventDefault();
            console.log('üí∞ Registrando despesa...');

            const expenses = allData.filter(item => item.type === 'expense');
            if (expenses.length >= 999) {
                showToast('Limite m√°ximo de 999 despesas atingido', 'error');
                return;
            }

            const submitBtn = document.getElementById('expense-submit');
            submitBtn.classList.add('loading');
            submitBtn.textContent = 'Registrando...';

            try {
                const expenseData = {
                    id: generateId(),
                    type: 'expense',
                    order_id: document.getElementById('expense-order').value,
                    tipo_despesa: document.getElementById('expense-tipo').value,
                    descricao: document.getElementById('expense-descricao').value,
                    valor_total: parseFloat(document.getElementById('expense-valor').value),
                    data: document.getElementById('expense-data').value,
                    created_at: new Date().toISOString()
                };

                console.log('üìù Dados da despesa:', expenseData);

                if (window.dataSdk) {
                    const result = await window.dataSdk.create(expenseData);
                    
                    if (result.isOk) {
                        document.getElementById('expense-form').reset();
                        document.getElementById('expense-data').value = new Date().toISOString().split('T')[0];
                        showToast('Despesa registrada com sucesso!', 'success');
                        console.log('‚úÖ Despesa registrada');
                    } else {
                        showToast('Erro ao registrar despesa', 'error');
                        console.error('‚ùå Erro:', result.error);
                    }
                }

            } catch (error) {
                console.error('üí• Erro no registro:', error);
                showToast('Erro inesperado ao registrar despesa', 'error');
            } finally {
                submitBtn.classList.remove('loading');
                submitBtn.textContent = 'Registrar Despesa';
            }
        }

        // Tab management with smooth transitions
        function showTab(tabName) {
            console.log('üìë Mudando para aba:', tabName);
            
            // Hide all tab contents with fade out
            document.querySelectorAll('.tab-content').forEach(content => {
                if (!content.classList.contains('hidden')) {
                    content.style.opacity = '0';
                    content.style.transform = 'translateY(10px)';
                    setTimeout(() => {
                        content.classList.add('hidden');
                    }, 150);
                }
            });

            // Remove active class from all tabs
            document.querySelectorAll('[id^="tab-"]').forEach(tab => {
                tab.classList.remove('tab-active');
                tab.classList.add('text-gray-500', 'hover:text-gray-700');
            });

            // Show selected tab content with fade in
            setTimeout(() => {
                const tabContent = document.getElementById(`${tabName}-content`);
                if (tabContent) {
                    tabContent.classList.remove('hidden');
                    // Force reflow
                    tabContent.offsetHeight;
                    tabContent.style.opacity = '1';
                    tabContent.style.transform = 'translateY(0)';
                }
            }, 150);

            // Add active class to selected tab
            const activeTab = document.getElementById(`tab-${tabName}`);
            if (activeTab) {
                activeTab.classList.add('tab-active');
                activeTab.classList.remove('text-gray-500', 'hover:text-gray-700');
            }
        }

        // Update selects with current data
        function updateSelects() {
            const vehicles = allData.filter(item => item.type === 'vehicle');
            const orders = allData.filter(item => item.type === 'order' && item.status !== 'Fechada');
            const suppliers = allData.filter(item => item.type === 'supplier');

            // Update vehicle selects
            const vehicleSelects = ['driver-vehicle', 'fueling-vehicle'];
            vehicleSelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    const currentValue = select.value;
                    select.innerHTML = '<option value="">Selecione um ve√≠culo</option>';
                    vehicles.forEach(vehicle => {
                        const option = document.createElement('option');
                        option.value = vehicle.id;
                        option.textContent = `${vehicle.codigo} - ${vehicle.placa} - ${vehicle.marca} ${vehicle.modelo}`;
                        select.appendChild(option);
                    });
                    select.value = currentValue;
                }
            });

            // Update order selects
            const orderSelects = ['fueling-order', 'expense-order'];
            orderSelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    const currentValue = select.value;
                    select.innerHTML = '<option value="">Selecione uma OS</option>';
                    orders.forEach(order => {
                        const option = document.createElement('option');
                        option.value = order.id;
                        option.textContent = `OS ${order.numero_os} - ${order.descricao}`;
                        select.appendChild(option);
                    });
                    select.value = currentValue;
                }
            });

            // Update station select (now using suppliers with "Posto de Combust√≠vel" category)
            const stationSelect = document.getElementById('fueling-station');
            if (stationSelect) {
                const currentValue = stationSelect.value;
                stationSelect.innerHTML = '<option value="">Selecione um posto</option>';
                const gasStations = suppliers.filter(s => s.categoria === 'Posto de Combust√≠vel');
                gasStations.forEach(station => {
                    const option = document.createElement('option');
                    option.value = station.id;
                    option.textContent = station.nome_fornecedor;
                    stationSelect.appendChild(option);
                });
                stationSelect.value = currentValue;
            }
        }

        // Update UI with current data
        function updateUI() {
            console.log('üîÑ Atualizando interface...');
            
            const vehicles = allData.filter(item => item.type === 'vehicle');
            const drivers = allData.filter(item => item.type === 'driver');
            const suppliers = allData.filter(item => item.type === 'supplier');

            // Update lists
            updateOrdersList();
            updateVehiclesList(vehicles);
            updateDriversList(drivers, vehicles);
            updateSuppliersList(suppliers);
            updateAllExpensesList();
            updateAllLancamentosList();
            updateContasList();
        }

        // Update contas a pagar list
        function updateContasList() {
            console.log('üí∞ Atualizando lista de contas a pagar...');
            
            const statusFilter = document.getElementById('contas-filter-status')?.value || '';
            const periodoFilter = document.getElementById('contas-filter-periodo')?.value || '';
            
            // Get all expenses and fuelings that have payment due dates
            let contas = allData.filter(item => 
                (item.type === 'fueling' || item.type === 'expense') && 
                item.data_vencimento
            );

            // Apply status filter
            if (statusFilter) {
                contas = contas.filter(conta => {
                    const status = getContaStatus(conta);
                    return status === statusFilter;
                });
            }

            // Apply period filter
            if (periodoFilter) {
                const hoje = new Date();
                hoje.setHours(0, 0, 0, 0);
                
                contas = contas.filter(conta => {
                    const vencimento = new Date(conta.data_vencimento);
                    vencimento.setHours(0, 0, 0, 0);
                    
                    switch (periodoFilter) {
                        case 'hoje':
                            return vencimento.getTime() === hoje.getTime();
                        case 'semana':
                            const semana = new Date(hoje.getTime() + (7 * 24 * 60 * 60 * 1000));
                            return vencimento >= hoje && vencimento <= semana;
                        case 'mes':
                            const mes = new Date(hoje.getTime() + (30 * 24 * 60 * 60 * 1000));
                            return vencimento >= hoje && vencimento <= mes;
                        case 'vencidas':
                            return vencimento < hoje && getContaStatus(conta) !== 'Paga';
                        default:
                            return true;
                    }
                });
            }

            // Sort by due date (most urgent first)
            contas.sort((a, b) => new Date(a.data_vencimento) - new Date(b.data_vencimento));

            updateContasSummary(contas);
            renderContasList(contas);
        }

        // Get conta status based on due date and payment status
        function getContaStatus(conta) {
            if (conta.conta_status === 'Paga') return 'Paga';
            
            const hoje = new Date();
            hoje.setHours(0, 0, 0, 0);
            const vencimento = new Date(conta.data_vencimento);
            vencimento.setHours(0, 0, 0, 0);
            
            if (vencimento < hoje) return 'Vencida';
            return 'Pendente';
        }

        // Update contas summary
        function updateContasSummary(contas) {
            const summaryContainer = document.getElementById('contas-summary');
            if (!summaryContainer) return;

            const hoje = new Date();
            hoje.setHours(0, 0, 0, 0);

            let totalPendentes = 0;
            let valorPendentes = 0;
            let totalVencidas = 0;
            let valorVencidas = 0;
            let totalPagas = 0;
            let valorPagas = 0;
            let totalGeral = 0;
            let valorGeral = 0;

            contas.forEach(conta => {
                const status = getContaStatus(conta);
                const valor = conta.valor_total || 0;
                
                totalGeral++;
                valorGeral += valor;
                
                switch (status) {
                    case 'Pendente':
                        totalPendentes++;
                        valorPendentes += valor;
                        break;
                    case 'Vencida':
                        totalVencidas++;
                        valorVencidas += valor;
                        break;
                    case 'Paga':
                        totalPagas++;
                        valorPagas += valor;
                        break;
                }
            });

            summaryContainer.innerHTML = `
                <div class="bg-yellow-50 p-4 rounded-lg text-center border border-yellow-200">
                    <div class="text-2xl font-bold text-yellow-800">${totalPendentes}</div>
                    <div class="text-sm text-yellow-600 mb-1">Pendentes</div>
                    <div class="text-lg font-semibold text-yellow-800">R$ ${valorPendentes.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</div>
                </div>
                <div class="bg-red-50 p-4 rounded-lg text-center border border-red-200">
                    <div class="text-2xl font-bold text-red-800">${totalVencidas}</div>
                    <div class="text-sm text-red-600 mb-1">Vencidas</div>
                    <div class="text-lg font-semibold text-red-800">R$ ${valorVencidas.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</div>
                </div>
                <div class="bg-green-50 p-4 rounded-lg text-center border border-green-200">
                    <div class="text-2xl font-bold text-green-800">${totalPagas}</div>
                    <div class="text-sm text-green-600 mb-1">Pagas</div>
                    <div class="text-lg font-semibold text-green-800">R$ ${valorPagas.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</div>
                </div>
                <div class="bg-blue-50 p-4 rounded-lg text-center border border-blue-200">
                    <div class="text-2xl font-bold text-blue-800">${totalGeral}</div>
                    <div class="text-sm text-blue-600 mb-1">Total</div>
                    <div class="text-lg font-semibold text-blue-800">R$ ${valorGeral.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</div>
                </div>
            `;
        }

        // Render contas list
        function renderContasList(contas) {
            const container = document.getElementById('contas-list');
            if (!container) return;

            if (contas.length === 0) {
                container.innerHTML = '<div class="text-center py-8 text-gray-500">Nenhuma conta encontrada</div>';
                return;
            }

            const orders = allData.filter(item => item.type === 'order');
            const vehicles = allData.filter(item => item.type === 'vehicle');
            const suppliers = allData.filter(item => item.type === 'supplier');

            container.innerHTML = contas.map(conta => {
                const status = getContaStatus(conta);
                const order = orders.find(o => o.id === conta.order_id);
                const hoje = new Date();
                const vencimento = new Date(conta.data_vencimento);
                const diasParaVencer = Math.ceil((vencimento - hoje) / (1000 * 60 * 60 * 24));
                
                let statusClass = '';
                let statusIcon = '';
                let urgencyBadge = '';
                
                switch (status) {
                    case 'Paga':
                        statusClass = 'bg-green-50 border-green-200';
                        statusIcon = '<svg class="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 24 24"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>';
                        break;
                    case 'Vencida':
                        statusClass = 'bg-red-50 border-red-200';
                        statusIcon = '<svg class="w-5 h-5 text-red-600" fill="currentColor" viewBox="0 0 24 24"><path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"/></svg>';
                        urgencyBadge = `<span class="px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full">Vencida h√° ${Math.abs(diasParaVencer)} dias</span>`;
                        break;
                    default:
                        statusClass = 'bg-yellow-50 border-yellow-200';
                        statusIcon = '<svg class="w-5 h-5 text-yellow-600" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>';
                        if (diasParaVencer <= 0) {
                            urgencyBadge = `<span class="px-2 py-1 bg-orange-100 text-orange-800 text-xs rounded-full">Vence hoje</span>`;
                        } else if (diasParaVencer <= 7) {
                            urgencyBadge = `<span class="px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full">Vence em ${diasParaVencer} dias</span>`;
                        }
                }

                let detalhes = '';
                if (conta.type === 'fueling') {
                    const vehicle = vehicles.find(v => v.id === conta.vehicle_id);
                    const station = suppliers.find(s => s.id === conta.station_id);
                    detalhes = `
                        <div class="flex items-center text-orange-700 mb-2">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                            </svg>
                            <span class="font-medium">Abastecimento</span>
                        </div>
                        <p class="text-gray-600">${vehicle ? `${vehicle.placa} - ${vehicle.marca} ${vehicle.modelo}` : 'Ve√≠culo n√£o encontrado'}</p>
                        <p class="text-sm text-gray-500">${station ? station.nome_fornecedor : 'Posto n√£o encontrado'} ‚Ä¢ ${conta.litros}L</p>
                    `;
                } else {
                    const supplier = suppliers.find(s => s.id === conta.supplier_id);
                    detalhes = `
                        <div class="flex items-center text-red-700 mb-2">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                            </svg>
                            <span class="font-medium">${conta.tipo_despesa}</span>
                        </div>
                        <p class="text-gray-600">${conta.descricao}</p>
                        ${supplier ? `<p class="text-sm text-gray-500">${supplier.nome_fornecedor}</p>` : ''}
                    `;
                }

                return `
                    <div class="border rounded-lg p-4 hover:shadow-md transition-shadow ${statusClass}">
                        <div class="flex items-start gap-3">
                            <!-- Checkbox para sele√ß√£o (apenas para contas n√£o pagas) -->
                            ${status !== 'Paga' ? `
                                <input type="checkbox" 
                                       class="conta-checkbox mt-1 w-4 h-4 text-green-600 bg-gray-100 border-gray-300 rounded focus:ring-green-500" 
                                       onchange="updateContasSelection()"
                                       data-conta-id="${conta.__backendId}"
                                       data-conta-valor="${conta.valor_total}">
                            ` : '<div class="w-4 h-4 mt-1"></div>'}
                            
                            <!-- √çcone de status -->
                            <div class="mt-1">${statusIcon}</div>
                            
                            <!-- Conte√∫do principal -->
                            <div class="flex-1">
                                ${detalhes}
                                
                                <div class="flex flex-wrap items-center gap-2 mt-3 mb-3">
                                    <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">OS ${order ? order.numero_os : 'N/A'}</span>
                                    <span class="px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded-full">${status}</span>
                                    ${urgencyBadge}
                                </div>
                                
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                                    <div>
                                        <span class="text-gray-500">Valor:</span>
                                        <p class="font-semibold text-lg">R$ ${conta.valor_total.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</p>
                                    </div>
                                    <div>
                                        <span class="text-gray-500">Vencimento:</span>
                                        <p class="font-medium">${new Date(conta.data_vencimento).toLocaleDateString('pt-BR')}</p>
                                    </div>
                                    <div>
                                        <span class="text-gray-500">Lan√ßamento:</span>
                                        <p class="font-medium">${new Date(conta.data).toLocaleDateString('pt-BR')}</p>
                                    </div>
                                    ${conta.data_pagamento ? `
                                    <div>
                                        <span class="text-gray-500">Pagamento:</span>
                                        <p class="font-medium">${new Date(conta.data_pagamento).toLocaleDateString('pt-BR')}</p>
                                    </div>
                                    ` : '<div></div>'}
                                </div>
                            </div>
                            
                            <!-- A√ß√µes -->
                            <div class="flex flex-col space-y-2">
                                ${status !== 'Paga' ? `
                                    <button onclick="pagarConta('${conta.__backendId}')" class="text-green-600 hover:text-green-800 p-1 rounded" title="Marcar como Paga">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                    </button>
                                ` : ''}
                                <button onclick="editarConta('${conta.__backendId}')" class="text-blue-600 hover:text-blue-800 p-1 rounded" title="Editar">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Contas selection management
        let selectedContas = new Set();

        function updateContasSelection() {
            const checkboxes = document.querySelectorAll('.conta-checkbox');
            selectedContas.clear();
            let totalSelecionado = 0;
            
            checkboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    selectedContas.add(checkbox.dataset.contaId);
                    totalSelecionado += parseFloat(checkbox.dataset.contaValor);
                }
            });

            const payBtn = document.getElementById('pay-selected-btn');
            const selectionInfo = document.getElementById('contas-selection-info');
            const selectionCount = document.getElementById('contas-selection-count');
            const selectionTotal = document.getElementById('contas-selection-total');

            if (selectedContas.size === 0) {
                payBtn.disabled = true;
                selectionInfo.classList.add('hidden');
            } else {
                payBtn.disabled = false;
                selectionInfo.classList.remove('hidden');
                selectionCount.textContent = `${selectedContas.size} conta${selectedContas.size > 1 ? 's' : ''} selecionada${selectedContas.size > 1 ? 's' : ''}`;
                selectionTotal.textContent = `R$ ${totalSelecionado.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
            }
        }

        // Pay single conta
        async function pagarConta(backendId) {
            const conta = allData.find(item => item.__backendId === backendId);
            if (!conta) return;

            try {
                const updatedConta = { ...conta };
                updatedConta.conta_status = 'Paga';
                updatedConta.data_pagamento = new Date().toISOString();

                if (window.dataSdk) {
                    const result = await window.dataSdk.update(updatedConta);
                    if (result.isOk) {
                        showToast('Conta marcada como paga!', 'success');
                    } else {
                        showToast('Erro ao atualizar conta', 'error');
                    }
                }
            } catch (error) {
                showToast('Erro inesperado ao pagar conta', 'error');
            }
        }

        // Pay selected contas
        async function paySelectedContas() {
            if (selectedContas.size === 0) return;
            
            // Criar confirma√ß√£o inline personalizada
            const totalSelecionado = Array.from(selectedContas).reduce((total, id) => {
                const conta = allData.find(item => item.__backendId === id);
                return total + (conta ? conta.valor_total : 0);
            }, 0);

            const confirmDiv = document.createElement('div');
            confirmDiv.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            confirmDiv.style.backdropFilter = 'blur(8px)';
            confirmDiv.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-6">
                    <div class="flex items-center mb-4">
                        <svg class="w-6 h-6 text-green-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <h3 class="text-lg font-semibold text-gray-900">Confirmar Pagamento</h3>
                    </div>
                    <p class="text-gray-600 mb-6">Confirma o pagamento de <strong>${selectedContas.size} conta${selectedContas.size > 1 ? 's' : ''}</strong> no valor total de <strong>R$ ${totalSelecionado.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</strong>?</p>
                    <div class="flex justify-end space-x-3">
                        <button onclick="this.closest('.fixed').remove()" class="bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600">
                            Cancelar
                        </button>
                        <button onclick="confirmPaySelectedContas(); this.closest('.fixed').remove();" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700">
                            Confirmar Pagamento
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(confirmDiv);
        }

        async function confirmPaySelectedContas() {
            try {
                const payPromises = Array.from(selectedContas).map(async (backendId) => {
                    const conta = allData.find(item => item.__backendId === backendId);
                    if (conta && window.dataSdk) {
                        const updatedConta = { ...conta };
                        updatedConta.conta_status = 'Paga';
                        updatedConta.data_pagamento = new Date().toISOString();
                        return await window.dataSdk.update(updatedConta);
                    }
                });

                const results = await Promise.all(payPromises);
                const successCount = results.filter(r => r && r.isOk).length;
                
                if (successCount === selectedContas.size) {
                    showToast(`${successCount} conta${successCount > 1 ? 's' : ''} paga${successCount > 1 ? 's' : ''} com sucesso!`, 'success');
                } else {
                    showToast(`${successCount} de ${selectedContas.size} contas pagas`, 'warning');
                }
                
                selectedContas.clear();
                updateContasSelection();
                
            } catch (error) {
                showToast('Erro inesperado ao pagar contas', 'error');
            }
        }

        // Edit conta
        function editarConta(backendId) {
            const conta = allData.find(item => item.__backendId === backendId);
            if (!conta) return;

            // Show edit form in modal
            const overlay = document.getElementById('modal-overlay');
            const title = document.getElementById('modal-title');
            const content = document.getElementById('modal-content');
            
            title.textContent = `Editar ${conta.type === 'fueling' ? 'Abastecimento' : 'Despesa'}`;
            content.innerHTML = `
                <form id="edit-conta-form" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="edit-conta-vencimento" class="block text-sm font-medium text-gray-700 mb-1">Data de Vencimento</label>
                            <input type="date" id="edit-conta-vencimento" value="${conta.data_vencimento}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        </div>
                        <div>
                            <label for="edit-conta-status" class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                            <select id="edit-conta-status" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="Pendente" ${conta.conta_status === 'Pendente' ? 'selected' : ''}>Pendente</option>
                                <option value="Paga" ${conta.conta_status === 'Paga' ? 'selected' : ''}>Paga</option>
                            </select>
                        </div>
                        ${conta.conta_status === 'Paga' ? `
                        <div>
                            <label for="edit-conta-pagamento" class="block text-sm font-medium text-gray-700 mb-1">Data de Pagamento</label>
                            <input type="date" id="edit-conta-pagamento" value="${conta.data_pagamento ? conta.data_pagamento.split('T')[0] : ''}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        ` : ''}
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" onclick="closeModal()" class="bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600">
                            Cancelar
                        </button>
                        <button type="submit" id="edit-conta-submit" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
                            Salvar Altera√ß√µes
                        </button>
                    </div>
                </form>
            `;
            
            overlay.classList.remove('hidden');
            
            // Handle status change
            document.getElementById('edit-conta-status').addEventListener('change', function() {
                const form = document.getElementById('edit-conta-form');
                const isPaga = this.value === 'Paga';
                
                // Add or remove payment date field
                const existingPaymentField = form.querySelector('#edit-conta-pagamento');
                if (isPaga && !existingPaymentField) {
                    const paymentDiv = document.createElement('div');
                    paymentDiv.innerHTML = `
                        <label for="edit-conta-pagamento" class="block text-sm font-medium text-gray-700 mb-1">Data de Pagamento</label>
                        <input type="date" id="edit-conta-pagamento" value="${new Date().toISOString().split('T')[0]}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    `;
                    form.querySelector('.grid').appendChild(paymentDiv);
                } else if (!isPaga && existingPaymentField) {
                    existingPaymentField.closest('div').remove();
                }
            });
            
            document.getElementById('edit-conta-form').addEventListener('submit', (e) => handleEditContaSubmit(e, conta));
        }

        async function handleEditContaSubmit(e, originalConta) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('edit-conta-submit');
            submitBtn.classList.add('loading');
            submitBtn.textContent = 'Salvando...';

            try {
                const updatedConta = { ...originalConta };
                updatedConta.data_vencimento = document.getElementById('edit-conta-vencimento').value;
                updatedConta.conta_status = document.getElementById('edit-conta-status').value;
                
                const paymentField = document.getElementById('edit-conta-pagamento');
                if (updatedConta.conta_status === 'Paga') {
                    updatedConta.data_pagamento = paymentField ? paymentField.value + 'T00:00:00.000Z' : new Date().toISOString();
                } else {
                    updatedConta.data_pagamento = '';
                }

                if (window.dataSdk) {
                    const result = await window.dataSdk.update(updatedConta);
                    
                    if (result.isOk) {
                        showToast('Conta atualizada com sucesso!', 'success');
                        closeModal();
                    } else {
                        showToast('Erro ao atualizar conta', 'error');
                    }
                }
            } catch (error) {
                showToast('Erro inesperado ao atualizar conta', 'error');
            } finally {
                submitBtn.classList.remove('loading');
                submitBtn.textContent = 'Salvar Altera√ß√µes';
            }
        }

        // Export contas report
        function exportContasReport() {
            console.log('üìä Exportando relat√≥rio de contas a pagar...');

            const statusFilter = document.getElementById('contas-filter-status')?.value || '';
            const periodoFilter = document.getElementById('contas-filter-periodo')?.value || '';
            
            // Get filtered contas
            let contas = allData.filter(item => 
                (item.type === 'fueling' || item.type === 'expense') && 
                item.data_vencimento
            );

            // Apply same filters as the list
            if (statusFilter) {
                contas = contas.filter(conta => getContaStatus(conta) === statusFilter);
            }

            if (periodoFilter) {
                const hoje = new Date();
                hoje.setHours(0, 0, 0, 0);
                
                contas = contas.filter(conta => {
                    const vencimento = new Date(conta.data_vencimento);
                    vencimento.setHours(0, 0, 0, 0);
                    
                    switch (periodoFilter) {
                        case 'hoje':
                            return vencimento.getTime() === hoje.getTime();
                        case 'semana':
                            const semana = new Date(hoje.getTime() + (7 * 24 * 60 * 60 * 1000));
                            return vencimento >= hoje && vencimento <= semana;
                        case 'mes':
                            const mes = new Date(hoje.getTime() + (30 * 24 * 60 * 60 * 1000));
                            return vencimento >= hoje && vencimento <= mes;
                        case 'vencidas':
                            return vencimento < hoje && getContaStatus(conta) !== 'Paga';
                        default:
                            return true;
                    }
                });
            }

            contas.sort((a, b) => new Date(a.data_vencimento) - new Date(b.data_vencimento));

            const orders = allData.filter(item => item.type === 'order');
            const vehicles = allData.filter(item => item.type === 'vehicle');
            const suppliers = allData.filter(item => item.type === 'supplier');

            // Prepare export data
            const exportData = [];
            
            exportData.push(['RELAT√ìRIO DE CONTAS A PAGAR']);
            exportData.push(['']);
            exportData.push(['Filtros Aplicados:']);
            exportData.push(['Status:', statusFilter || 'Todos']);
            exportData.push(['Per√≠odo:', periodoFilter || 'Todos']);
            exportData.push(['Data de Gera√ß√£o:', new Date().toLocaleDateString('pt-BR')]);
            exportData.push(['']);

            // Summary
            let totalPendentes = 0, valorPendentes = 0;
            let totalVencidas = 0, valorVencidas = 0;
            let totalPagas = 0, valorPagas = 0;

            contas.forEach(conta => {
                const status = getContaStatus(conta);
                const valor = conta.valor_total || 0;
                
                switch (status) {
                    case 'Pendente':
                        totalPendentes++;
                        valorPendentes += valor;
                        break;
                    case 'Vencida':
                        totalVencidas++;
                        valorVencidas += valor;
                        break;
                    case 'Paga':
                        totalPagas++;
                        valorPagas += valor;
                        break;
                }
            });

            exportData.push(['RESUMO']);
            exportData.push(['Contas Pendentes:', totalPendentes, 'R$ ' + valorPendentes.toLocaleString('pt-BR', {minimumFractionDigits: 2})]);
            exportData.push(['Contas Vencidas:', totalVencidas, 'R$ ' + valorVencidas.toLocaleString('pt-BR', {minimumFractionDigits: 2})]);
            exportData.push(['Contas Pagas:', totalPagas, 'R$ ' + valorPagas.toLocaleString('pt-BR', {minimumFractionDigits: 2})]);
            exportData.push(['Total Geral:', contas.length, 'R$ ' + (valorPendentes + valorVencidas + valorPagas).toLocaleString('pt-BR', {minimumFractionDigits: 2})]);
            exportData.push(['']);

            // Detailed list
            exportData.push(['DETALHAMENTO']);
            exportData.push(['Tipo', 'Descri√ß√£o', 'OS', 'Valor', 'Vencimento', 'Status', 'Pagamento', 'Fornecedor/Posto']);
            
            contas.forEach(conta => {
                const order = orders.find(o => o.id === conta.order_id);
                const status = getContaStatus(conta);
                let descricao = '';
                let fornecedor = '';
                
                if (conta.type === 'fueling') {
                    const vehicle = vehicles.find(v => v.id === conta.vehicle_id);
                    const station = suppliers.find(s => s.id === conta.station_id);
                    descricao = `Abastecimento - ${vehicle ? vehicle.placa : 'N/A'} - ${conta.litros}L`;
                    fornecedor = station ? station.nome_fornecedor : 'N/A';
                } else {
                    const supplier = suppliers.find(s => s.id === conta.supplier_id);
                    descricao = `${conta.tipo_despesa} - ${conta.descricao}`;
                    fornecedor = supplier ? supplier.nome_fornecedor : 'N/A';
                }
                
                exportData.push([
                    conta.type === 'fueling' ? 'Abastecimento' : 'Despesa',
                    descricao,
                    order ? order.numero_os : 'N/A',
                    'R$ ' + conta.valor_total.toFixed(2),
                    new Date(conta.data_vencimento).toLocaleDateString('pt-BR'),
                    status,
                    conta.data_pagamento ? new Date(conta.data_pagamento).toLocaleDateString('pt-BR') : '',
                    fornecedor
                ]);
            });

            // Create and download CSV
            const csvContent = exportData.map(row => 
                row.map(cell => `"${cell}"`).join(',')
            ).join('\n');

            const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', `Contas_a_Pagar_${new Date().toISOString().split('T')[0]}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showToast('Relat√≥rio de contas exportado com sucesso!', 'success');
            } else {
                showToast('Erro ao exportar relat√≥rio - navegador n√£o suportado', 'error');
            }
        }

        // Calculate statistics for individual vehicle
        function calculateVehicleStatistics(vehicleId) {
            const vehicleFuelings = allData.filter(item => 
                item.type === 'fueling' && item.vehicle_id === vehicleId
            );
            
            const vehicleExpenses = allData.filter(item => 
                item.type === 'expense' && 
                allData.some(fueling => 
                    fueling.type === 'fueling' && 
                    fueling.vehicle_id === vehicleId && 
                    fueling.order_id === item.order_id
                )
            );

            let totalLiters = 0;
            let totalCost = 0;
            let totalKm = 0;

            // Calculate from fuelings
            vehicleFuelings.forEach(fueling => {
                totalLiters += fueling.litros;
                totalCost += fueling.valor_total;
            });

            // Add vehicle-related expenses
            vehicleExpenses.forEach(expense => {
                totalCost += expense.valor_total;
            });

            // Calculate KM from fueling records (difference between highest and lowest KM)
            if (vehicleFuelings.length > 1) {
                const sortedFuelings = vehicleFuelings.sort((a, b) => a.km_atual - b.km_atual);
                totalKm = sortedFuelings[sortedFuelings.length - 1].km_atual - sortedFuelings[0].km_atual;
            }

            const avgConsumption = totalLiters > 0 && totalKm > 0 ? totalKm / totalLiters : 0;
            const costPerKm = totalKm > 0 ? totalCost / totalKm : 0;

            return {
                totalKm,
                totalLiters,
                totalCost,
                avgConsumption,
                costPerKm,
                fuelingsCount: vehicleFuelings.length,
                expensesCount: vehicleExpenses.length
            };
        }

        // Calculate general statistics (sum of all vehicles)
        function calculateStatistics(vehicles, fuelings, expenses, orders) {
            let totalLiters = 0;
            let totalCost = 0;
            let totalKm = 0;

            // Calculate totals by summing individual vehicle statistics
            vehicles.forEach(vehicle => {
                const vehicleStats = calculateVehicleStatistics(vehicle.id);
                totalLiters += vehicleStats.totalLiters;
                totalCost += vehicleStats.totalCost;
                totalKm += vehicleStats.totalKm;
            });

            const avgConsumption = totalLiters > 0 && totalKm > 0 ? totalKm / totalLiters : 0;
            const costPerKm = totalKm > 0 ? totalCost / totalKm : 0;

            return {
                totalKm,
                totalLiters,
                totalCost,
                avgConsumption,
                costPerKm
            };
        }



        // Update orders list
        function updateOrdersList() {
            const filter = document.getElementById('order-filter').value;
            let orders = allData.filter(item => item.type === 'order');
            
            if (filter) {
                orders = orders.filter(order => order.status === filter);
            }

            const container = document.getElementById('orders-list');
            if (!container) return;

            if (orders.length === 0) {
                container.innerHTML = '<div class="text-center py-8 text-gray-500">Nenhuma ordem de servi√ßo encontrada</div>';
                return;
            }

            container.innerHTML = orders.map(order => {
                const orderExpenses = allData.filter(item => 
                    (item.type === 'fueling' || item.type === 'expense') && item.order_id === order.id
                );
                const totalValue = orderExpenses.reduce((sum, expense) => sum + (expense.valor_total || 0), 0);

                return `
                    <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 hover:bg-gray-100 transition-colors">
                        <div class="flex items-start gap-3">
                            <!-- Checkbox -->
                            <input type="checkbox" 
                                   id="order-${order.__backendId}" 
                                   class="order-checkbox mt-1 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500" 
                                   onchange="updateOrderSelection()"
                                   data-order-id="${order.__backendId}">
                            
                            <!-- Conte√∫do da OS -->
                            <div class="flex-1">
                                <div class="flex justify-between items-start mb-3">
                                    <div>
                                        <h4 class="font-semibold text-lg text-gray-900">OS ${order.numero_os}</h4>
                                        <p class="text-gray-600">${order.descricao}</p>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <span class="px-2 py-1 text-xs font-medium rounded-full status-${order.status.toLowerCase().replace(' ', '')}">
                                            ${order.status}
                                        </span>
                                        <div class="flex space-x-1">
                                            ${order.status !== 'Fechada' ? `
                                                <button onclick="changeOrderStatus('${order.__backendId}', 'Em andamento')" class="text-yellow-600 hover:text-yellow-800 p-1 rounded" title="Em Andamento">
                                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                                                    </svg>
                                                </button>
                                                <button onclick="changeOrderStatus('${order.__backendId}', 'Fechada')" class="text-red-600 hover:text-red-800 p-1 rounded" title="Fechar">
                                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                                        <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/>
                                                    </svg>
                                                </button>
                                            ` : `
                                                <button onclick="changeOrderStatus('${order.__backendId}', 'Aberta')" class="text-green-600 hover:text-green-800 p-1 rounded" title="Reabrir">
                                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                                        <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6h1.9c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/>
                                                    </svg>
                                                </button>
                                            `}
                                        </div>
                                    </div>
                                </div>
                                <!-- Informa√ß√µes Adicionais da OS -->
                                ${order.responsavel || order.prioridade !== 'Normal' ? `
                                <div class="mb-3 flex flex-wrap gap-2">
                                    ${order.responsavel ? `<span class="px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded-full flex items-center"><svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 24 24"><path d="M20 6h-2.18c.11-.31.18-.65.18-1a2.996 2.996 0 0 0-5.5-1.65l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1z"/></svg>${order.responsavel}</span>` : ''}
                                    ${order.prioridade && order.prioridade !== 'Normal' ? `<span class="px-2 py-1 ${order.prioridade === 'Urgente' ? 'bg-red-100 text-red-800' : order.prioridade === 'Alta' ? 'bg-orange-100 text-orange-800' : 'bg-gray-100 text-gray-800'} text-xs rounded-full flex items-center"><svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 24 24"><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/></svg>${order.prioridade}</span>` : ''}
                                </div>
                                ` : ''}
                                
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                                    <div>
                                        <span class="text-gray-500">Abertura:</span>
                                        <p class="font-medium">${new Date(order.data_abertura).toLocaleDateString('pt-BR')}</p>
                                    </div>
                                    <div>
                                        <span class="text-gray-500">Previs√£o:</span>
                                        <p class="font-medium">${order.previsao_termino ? new Date(order.previsao_termino).toLocaleDateString('pt-BR') : '-'}</p>
                                    </div>
                                    <div>
                                        <span class="text-gray-500">Fechamento:</span>
                                        <p class="font-medium">${order.data_fechamento ? new Date(order.data_fechamento).toLocaleDateString('pt-BR') : '-'}</p>
                                    </div>
                                    <div>
                                        <span class="text-gray-500">Valor Total:</span>
                                        <p class="font-medium text-red-600">R$ ${totalValue.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</p>
                                    </div>
                                </div>
                                ${order.observacoes ? `<p class="text-sm text-gray-600 mt-2"><strong>Obs:</strong> ${order.observacoes}</p>` : ''}
                                
                                <!-- Lan√ßamentos da OS -->
                                <div class="mt-4 border-t pt-4">
                                    <button onclick="toggleOrderExpenses('${order.id}')" class="text-blue-600 hover:text-blue-800 text-sm font-medium flex items-center">
                                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                                        </svg>
                                        Ver Lan√ßamentos (${orderExpenses.length})
                                    </button>
                                    <div id="expenses-${order.id}" class="hidden mt-3 space-y-2">
                                        ${orderExpenses.length === 0 ? 
                                            '<p class="text-gray-500 text-sm">Nenhum lan√ßamento nesta OS</p>' :
                                            orderExpenses.map(expense => {
                                                if (expense.type === 'fueling') {
                                                    const vehicle = allData.find(v => v.type === 'vehicle' && v.id === expense.vehicle_id);
                                                    const station = allData.find(s => s.type === 'station' && s.id === expense.station_id);
                                                    return `<div class="bg-orange-50 border border-orange-200 rounded p-3 text-sm">
                                                        <div class="flex justify-between items-start">
                                                            <div>
                                                                <span class="font-medium text-orange-800 flex items-center"><svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 24 24"><path d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/></svg>Abastecimento</span>
                                                                <p class="text-gray-600">${vehicle ? vehicle.placa : 'Ve√≠culo n√£o encontrado'} - ${station ? station.nome_posto : 'Posto n√£o encontrado'}</p>
                                                                <p class="text-gray-500">${expense.litros}L - ${new Date(expense.data).toLocaleDateString('pt-BR')}</p>
                                                            </div>
                                                            <span class="font-semibold text-orange-800">R$ ${expense.valor_total.toFixed(2)}</span>
                                                        </div>
                                                    </div>`;
                                                } else if (expense.type === 'expense') {
                                                    return `<div class="bg-red-50 border border-red-200 rounded p-3 text-sm">
                                                        <div class="flex justify-between items-start">
                                                            <div>
                                                                <span class="font-medium text-red-800 flex items-center"><svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 24 24"><path d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v2a2 2 0 002 2z"/></svg>${expense.tipo_despesa}</span>
                                                                <p class="text-gray-600">${expense.descricao}</p>
                                                                <p class="text-gray-500">${new Date(expense.data).toLocaleDateString('pt-BR')}</p>
                                                            </div>
                                                            <span class="font-semibold text-red-800">R$ ${expense.valor_total.toFixed(2)}</span>
                                                        </div>
                                                    </div>`;
                                                }
                                                return '';
                                            }).join('')
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Update vehicles list
        function updateVehiclesList(vehicles) {
            const container = document.getElementById('vehicles-list');
            if (!container) return;

            if (vehicles.length === 0) {
                container.innerHTML = '<div class="text-center py-8 text-gray-500">Nenhum ve√≠culo cadastrado</div>';
                return;
            }

            container.innerHTML = vehicles.map(vehicle => {
                const vehicleStats = calculateVehicleStatistics(vehicle.id);
                
                return `
                    <div class="bg-white border border-gray-200 rounded-lg p-4 hover-lift">
                        <div class="flex justify-between items-start mb-3">
                            <div>
                                <h4 class="font-semibold text-lg text-gray-900">${vehicle.codigo} - ${vehicle.placa}</h4>
                                <p class="text-gray-600">${vehicle.marca} ${vehicle.modelo}</p>
                                ${vehicle.ano || vehicle.ano_modelo ? `<p class="text-sm text-gray-500">${vehicle.ano ? vehicle.ano : ''}${vehicle.ano_modelo && vehicle.ano_modelo !== vehicle.ano ? `/${vehicle.ano_modelo}` : ''}${vehicle.cor ? ` ‚Ä¢ ${vehicle.cor}` : ''}</p>` : ''}
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="showVehicleConsumptionReport('${vehicle.id}')" class="text-green-600 hover:text-green-800 p-1 rounded" title="Relat√≥rio de Consumo">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                                    </svg>
                                </button>
                                <button onclick="editVehicle('${vehicle.__backendId}')" class="text-blue-600 hover:text-blue-800 p-1 rounded" title="Editar">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                                    </svg>
                                </button>
                                <button onclick="deleteVehicle('${vehicle.__backendId}')" class="text-red-600 hover:text-red-800 p-1 rounded" title="Excluir">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Informa√ß√µes Adicionais -->
                        ${vehicle.categoria || vehicle.combustivel ? `
                        <div class="mb-3 flex flex-wrap gap-2">
                            ${vehicle.categoria ? `<span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">${vehicle.categoria}</span>` : ''}
                            ${vehicle.combustivel ? `<span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">${vehicle.combustivel}</span>` : ''}
                        </div>
                        ` : ''}
                        
                        <!-- Estat√≠sticas do Ve√≠culo -->
                        <div class="grid grid-cols-2 gap-3 mb-3 text-sm">
                            <div class="bg-blue-50 p-2 rounded">
                                <span class="text-blue-600 text-xs">Consumo M√©dio</span>
                                <p class="font-semibold text-blue-800">${vehicleStats.avgConsumption.toFixed(1)} km/l</p>
                            </div>
                            <div class="bg-red-50 p-2 rounded">
                                <span class="text-red-600 text-xs">Custo Total</span>
                                <p class="font-semibold text-red-800">R$ ${vehicleStats.totalCost.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</p>
                            </div>
                            <div class="bg-green-50 p-2 rounded">
                                <span class="text-green-600 text-xs">KM Rodados</span>
                                <p class="font-semibold text-green-800">${vehicleStats.totalKm.toLocaleString('pt-BR')} km</p>
                            </div>
                            <div class="bg-yellow-50 p-2 rounded">
                                <span class="text-yellow-600 text-xs">Custo/KM</span>
                                <p class="font-semibold text-yellow-800">R$ ${vehicleStats.costPerKm.toFixed(2)}</p>
                            </div>
                        </div>
                        
                        <div class="border-t pt-2">
                            <p class="text-sm text-gray-500">Od√¥metro: ${vehicle.odometro.toLocaleString('pt-BR')} km</p>
                            ${vehicle.chassi ? `<p class="text-xs text-gray-400">Chassi: ${vehicle.chassi}</p>` : ''}
                            <p class="text-xs text-gray-400">Cadastrado em: ${new Date(vehicle.created_at).toLocaleDateString('pt-BR')}</p>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Edit driver function
        function editDriver(backendId) {
            const driver = allData.find(item => item.__backendId === backendId);
            if (!driver) return;
            
            console.log('‚úèÔ∏è Editando motorista:', driver.nome);
            
            // Show edit form in modal
            const overlay = document.getElementById('modal-overlay');
            const title = document.getElementById('modal-title');
            const content = document.getElementById('modal-content');
            
            title.textContent = `Editar Motorista ${driver.nome}`;
            content.innerHTML = `
                <form id="edit-driver-form" class="space-y-6">
                    <!-- Informa√ß√µes Pessoais -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                            <svg class="w-5 h-5 mr-2 text-purple-600" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                            </svg>
                            Informa√ß√µes Pessoais
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <div>
                                <label for="edit-driver-nome" class="block text-sm font-medium text-gray-700 mb-1">Nome Completo *</label>
                                <input type="text" id="edit-driver-nome" value="${driver.nome}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                            </div>
                            <div>
                                <label for="edit-driver-cpf" class="block text-sm font-medium text-gray-700 mb-1">CPF *</label>
                                <input type="text" id="edit-driver-cpf" value="${driver.cpf || ''}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                            </div>
                            <div>
                                <label for="edit-driver-telefone" class="block text-sm font-medium text-gray-700 mb-1">Telefone *</label>
                                <input type="tel" id="edit-driver-telefone" value="${driver.telefone || ''}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                            </div>
                        </div>
                    </div>

                    <!-- Habilita√ß√£o -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                            <svg class="w-5 h-5 mr-2 text-green-600" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
                            </svg>
                            Habilita√ß√£o
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <div>
                                <label for="edit-driver-cnh" class="block text-sm font-medium text-gray-700 mb-1">N√∫mero da CNH *</label>
                                <input type="text" id="edit-driver-cnh" value="${driver.cnh}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                            </div>
                            <div>
                                <label for="edit-driver-categoria" class="block text-sm font-medium text-gray-700 mb-1">Categoria *</label>
                                <select id="edit-driver-categoria" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                                    <option value="">Selecione</option>
                                    <option value="A" ${driver.categoria_cnh === 'A' ? 'selected' : ''}>A - Motocicleta</option>
                                    <option value="B" ${driver.categoria_cnh === 'B' ? 'selected' : ''}>B - Autom√≥vel</option>
                                    <option value="C" ${driver.categoria_cnh === 'C' ? 'selected' : ''}>C - Caminh√£o</option>
                                    <option value="D" ${driver.categoria_cnh === 'D' ? 'selected' : ''}>D - √înibus</option>
                                    <option value="E" ${driver.categoria_cnh === 'E' ? 'selected' : ''}>E - Carreta</option>
                                    <option value="AB" ${driver.categoria_cnh === 'AB' ? 'selected' : ''}>AB - A + B</option>
                                    <option value="AC" ${driver.categoria_cnh === 'AC' ? 'selected' : ''}>AC - A + C</option>
                                    <option value="AD" ${driver.categoria_cnh === 'AD' ? 'selected' : ''}>AD - A + D</option>
                                    <option value="AE" ${driver.categoria_cnh === 'AE' ? 'selected' : ''}>AE - A + E</option>
                                </select>
                            </div>
                            <div>
                                <label for="edit-driver-vencimento" class="block text-sm font-medium text-gray-700 mb-1">Vencimento CNH *</label>
                                <input type="date" id="edit-driver-vencimento" value="${driver.vencimento_cnh || ''}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                            </div>
                        </div>
                    </div>

                    <!-- Informa√ß√µes Profissionais -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                            <svg class="w-5 h-5 mr-2 text-orange-600" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M20 6h-2.18c.11-.31.18-.65.18-1a2.996 2.996 0 0 0-5.5-1.65l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1z"/>
                            </svg>
                            Informa√ß√µes Profissionais
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="edit-driver-vehicle" class="block text-sm font-medium text-gray-700 mb-1">Ve√≠culo Principal</label>
                                <select id="edit-driver-vehicle" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                                    <option value="">Selecione um ve√≠culo</option>
                                </select>
                            </div>
                            <div>
                                <label for="edit-driver-status" class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                                <select id="edit-driver-status" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                                    <option value="Ativo" ${driver.status === 'Ativo' ? 'selected' : ''}>Ativo</option>
                                    <option value="Inativo" ${driver.status === 'Inativo' ? 'selected' : ''}>Inativo</option>
                                    <option value="F√©rias" ${driver.status === 'F√©rias' ? 'selected' : ''}>F√©rias</option>
                                    <option value="Afastado" ${driver.status === 'Afastado' ? 'selected' : ''}>Afastado</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Bot√µes -->
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" onclick="closeModal()" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500">
                            Cancelar
                        </button>
                        <button type="submit" id="edit-driver-submit" class="bg-purple-600 text-white px-8 py-2 rounded-lg hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M21 7L9 19l-5.5-5.5 1.41-1.41L9 16.17 19.59 5.59 21 7z"/>
                            </svg>
                            Salvar Altera√ß√µes
                        </button>
                    </div>
                </form>
            `;
            
            // Show modal
            overlay.classList.remove('hidden');
            
            // Update vehicle select
            const vehicles = allData.filter(item => item.type === 'vehicle');
            const vehicleSelect = document.getElementById('edit-driver-vehicle');
            vehicles.forEach(vehicle => {
                const option = document.createElement('option');
                option.value = vehicle.id;
                option.textContent = `${vehicle.codigo} - ${vehicle.placa} - ${vehicle.marca} ${vehicle.modelo}`;
                option.selected = vehicle.id === driver.vehicle_id;
                vehicleSelect.appendChild(option);
            });
            
            // Setup form listener
            document.getElementById('edit-driver-form').addEventListener('submit', (e) => handleEditDriverSubmit(e, driver));
        }

        // Handle edit driver form submission
        async function handleEditDriverSubmit(e, originalDriver) {
            e.preventDefault();
            console.log('‚úèÔ∏è Salvando altera√ß√µes do motorista:', originalDriver.nome);

            const submitBtn = document.getElementById('edit-driver-submit');
            submitBtn.classList.add('loading');
            submitBtn.innerHTML = '<svg class="w-4 h-4 mr-2 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>Salvando...';

            try {
                const updatedDriver = { ...originalDriver };
                updatedDriver.nome = document.getElementById('edit-driver-nome').value;
                updatedDriver.cpf = document.getElementById('edit-driver-cpf').value;
                updatedDriver.telefone = document.getElementById('edit-driver-telefone').value;
                updatedDriver.cnh = document.getElementById('edit-driver-cnh').value;
                updatedDriver.categoria_cnh = document.getElementById('edit-driver-categoria').value;
                updatedDriver.vencimento_cnh = document.getElementById('edit-driver-vencimento').value;
                updatedDriver.vehicle_id = document.getElementById('edit-driver-vehicle').value || '';
                updatedDriver.status = document.getElementById('edit-driver-status').value;

                if (window.dataSdk) {
                    const result = await window.dataSdk.update(updatedDriver);
                    
                    if (result.isOk) {
                        showToast('Motorista atualizado com sucesso!', 'success');
                        closeModal();
                    } else {
                        showToast('Erro ao atualizar motorista', 'error');
                    }
                }
            } catch (error) {
                showToast('Erro inesperado ao atualizar motorista', 'error');
            } finally {
                submitBtn.classList.remove('loading');
                submitBtn.innerHTML = '<svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M21 7L9 19l-5.5-5.5 1.41-1.41L9 16.17 19.59 5.59 21 7z"/></svg>Salvar Altera√ß√µes';
            }
        }

        // Edit station function
        function editStation(backendId) {
            const station = allData.find(item => item.__backendId === backendId);
            if (!station) return;
            
            console.log('‚úèÔ∏è Editando posto:', station.nome_posto);
            
            // Show edit form in modal
            const overlay = document.getElementById('modal-overlay');
            const title = document.getElementById('modal-title');
            const content = document.getElementById('modal-content');
            
            title.textContent = `Editar Posto ${station.nome_posto}`;
            content.innerHTML = `
                <form id="edit-station-form" class="space-y-6">
                    <!-- Informa√ß√µes B√°sicas -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                            <svg class="w-5 h-5 mr-2 text-orange-600" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M19.77 7.23l.01-.01-3.72-3.72L15 4.56l2.11 2.11c-.94.36-1.61 1.26-1.61 2.33 0 1.38 1.12 2.5 2.5 2.5.84 0 1.58-.41 2.03-1.03L22 12.44V20c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2h7.5l1.5-1.5L15 4.56 13.5 6H4v14h16v-7.56l-2.23-2.21zM18 9c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1z"/>
                            </svg>
                            Informa√ß√µes B√°sicas
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <div>
                                <label for="edit-station-nome" class="block text-sm font-medium text-gray-700 mb-1">Nome do Posto *</label>
                                <input type="text" id="edit-station-nome" value="${station.nome_posto}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500" required>
                            </div>
                            <div>
                                <label for="edit-station-cnpj" class="block text-sm font-medium text-gray-700 mb-1">CNPJ *</label>
                                <input type="text" id="edit-station-cnpj" value="${station.cnpj}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500" required>
                            </div>
                            <div>
                                <label for="edit-station-bandeira" class="block text-sm font-medium text-gray-700 mb-1">Bandeira</label>
                                <select id="edit-station-bandeira" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500">
                                    <option value="">Selecione</option>
                                    <option value="Shell" ${station.bandeira === 'Shell' ? 'selected' : ''}>Shell</option>
                                    <option value="Petrobras" ${station.bandeira === 'Petrobras' ? 'selected' : ''}>Petrobras</option>
                                    <option value="Ipiranga" ${station.bandeira === 'Ipiranga' ? 'selected' : ''}>Ipiranga</option>
                                    <option value="Ra√≠zen" ${station.bandeira === 'Ra√≠zen' ? 'selected' : ''}>Ra√≠zen</option>
                                    <option value="Ale" ${station.bandeira === 'Ale' ? 'selected' : ''}>Ale</option>
                                    <option value="Texaco" ${station.bandeira === 'Texaco' ? 'selected' : ''}>Texaco</option>
                                    <option value="Posto Branco" ${station.bandeira === 'Posto Branco' ? 'selected' : ''}>Posto Branco</option>
                                    <option value="Outros" ${station.bandeira === 'Outros' ? 'selected' : ''}>Outros</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Endere√ßo -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                            <svg class="w-5 h-5 mr-2 text-blue-600" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                            </svg>
                            Endere√ßo
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="edit-station-endereco" class="block text-sm font-medium text-gray-700 mb-1">Logradouro *</label>
                                <input type="text" id="edit-station-endereco" value="${station.endereco || ''}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500" required>
                            </div>
                            <div>
                                <label for="edit-station-cidade" class="block text-sm font-medium text-gray-700 mb-1">Cidade *</label>
                                <input type="text" id="edit-station-cidade" value="${station.cidade || ''}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500" required>
                            </div>
                        </div>
                    </div>

                    <!-- Contato -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                            <svg class="w-5 h-5 mr-2 text-green-600" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                            </svg>
                            Informa√ß√µes de Contato
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="edit-station-telefone" class="block text-sm font-medium text-gray-700 mb-1">Telefone</label>
                                <input type="tel" id="edit-station-telefone" value="${station.telefone || ''}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500">
                            </div>
                            <div>
                                <label for="edit-station-status" class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                                <select id="edit-station-status" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500">
                                    <option value="Ativo" ${station.status === 'Ativo' ? 'selected' : ''}>Ativo</option>
                                    <option value="Inativo" ${station.status === 'Inativo' ? 'selected' : ''}>Inativo</option>
                                    <option value="Suspenso" ${station.status === 'Suspenso' ? 'selected' : ''}>Suspenso</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Bot√µes -->
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" onclick="closeModal()" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500">
                            Cancelar
                        </button>
                        <button type="submit" id="edit-station-submit" class="bg-orange-600 text-white px-8 py-2 rounded-lg hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-orange-500 flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M21 7L9 19l-5.5-5.5 1.41-1.41L9 16.17 19.59 5.59 21 7z"/>
                            </svg>
                            Salvar Altera√ß√µes
                        </button>
                    </div>
                </form>
            `;
            
            // Show modal
            overlay.classList.remove('hidden');
            
            // Setup form listener
            document.getElementById('edit-station-form').addEventListener('submit', (e) => handleEditStationSubmit(e, station));
        }

        // Handle edit station form submission
        async function handleEditStationSubmit(e, originalStation) {
            e.preventDefault();
            console.log('‚úèÔ∏è Salvando altera√ß√µes do posto:', originalStation.nome_posto);

            const submitBtn = document.getElementById('edit-station-submit');
            submitBtn.classList.add('loading');
            submitBtn.innerHTML = '<svg class="w-4 h-4 mr-2 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>Salvando...';

            try {
                const updatedStation = { ...originalStation };
                updatedStation.nome_posto = document.getElementById('edit-station-nome').value;
                updatedStation.cnpj = document.getElementById('edit-station-cnpj').value;
                updatedStation.bandeira = document.getElementById('edit-station-bandeira').value || '';
                updatedStation.endereco = document.getElementById('edit-station-endereco').value || '';
                updatedStation.cidade = document.getElementById('edit-station-cidade').value || '';
                updatedStation.telefone = document.getElementById('edit-station-telefone').value || '';
                updatedStation.status = document.getElementById('edit-station-status').value;

                if (window.dataSdk) {
                    const result = await window.dataSdk.update(updatedStation);
                    
                    if (result.isOk) {
                        showToast('Posto atualizado com sucesso!', 'success');
                        closeModal();
                    } else {
                        showToast('Erro ao atualizar posto', 'error');
                    }
                }
            } catch (error) {
                showToast('Erro inesperado ao atualizar posto', 'error');
            } finally {
                submitBtn.classList.remove('loading');
                submitBtn.innerHTML = '<svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M21 7L9 19l-5.5-5.5 1.41-1.41L9 16.17 19.59 5.59 21 7z"/></svg>Salvar Altera√ß√µes';
            }
        }

        // Edit vehicle function
        function editVehicle(backendId) {
            const vehicle = allData.find(item => item.__backendId === backendId);
            if (!vehicle) return;
            
            console.log('‚úèÔ∏è Editando ve√≠culo:', vehicle.placa);
            
            // Show edit form in modal
            const overlay = document.getElementById('modal-overlay');
            const title = document.getElementById('modal-title');
            const content = document.getElementById('modal-content');
            
            title.textContent = `Editar Ve√≠culo ${vehicle.placa}`;
            content.innerHTML = `
                <form id="edit-vehicle-form" class="space-y-6">
                    <!-- Informa√ß√µes B√°sicas -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                            <svg class="w-5 h-5 mr-2 text-blue-600" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                            Informa√ß√µes B√°sicas
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <div>
                                <label for="edit-vehicle-codigo" class="block text-sm font-medium text-gray-700 mb-1">C√≥digo da Frota *</label>
                                <input type="text" id="edit-vehicle-codigo" value="${vehicle.codigo}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            </div>
                            <div>
                                <label for="edit-vehicle-placa" class="block text-sm font-medium text-gray-700 mb-1">Placa *</label>
                                <input type="text" id="edit-vehicle-placa" value="${vehicle.placa}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            </div>
                            <div>
                                <label for="edit-vehicle-marca" class="block text-sm font-medium text-gray-700 mb-1">Marca *</label>
                                <input type="text" id="edit-vehicle-marca" value="${vehicle.marca}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            </div>
                            <div>
                                <label for="edit-vehicle-modelo" class="block text-sm font-medium text-gray-700 mb-1">Modelo *</label>
                                <input type="text" id="edit-vehicle-modelo" value="${vehicle.modelo}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            </div>
                            <div>
                                <label for="edit-vehicle-ano" class="block text-sm font-medium text-gray-700 mb-1">Ano Fabrica√ß√£o</label>
                                <input type="number" id="edit-vehicle-ano" value="${vehicle.ano || ''}" min="1900" max="2030" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="edit-vehicle-ano-modelo" class="block text-sm font-medium text-gray-700 mb-1">Ano Modelo</label>
                                <input type="number" id="edit-vehicle-ano-modelo" value="${vehicle.ano_modelo || ''}" min="1900" max="2030" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="edit-vehicle-cor" class="block text-sm font-medium text-gray-700 mb-1">Cor</label>
                                <input type="text" id="edit-vehicle-cor" value="${vehicle.cor || ''}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                    </div>

                    <!-- Documenta√ß√£o -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                            <svg class="w-5 h-5 mr-2 text-green-600" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
                            </svg>
                            Documenta√ß√£o
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="edit-vehicle-chassi" class="block text-sm font-medium text-gray-700 mb-1">Chassi</label>
                                <input type="text" id="edit-vehicle-chassi" value="${vehicle.chassi || ''}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="edit-vehicle-renavam" class="block text-sm font-medium text-gray-700 mb-1">RENAVAM</label>
                                <input type="text" id="edit-vehicle-renavam" value="${vehicle.renavam || ''}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                    </div>

                    <!-- Informa√ß√µes T√©cnicas -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                            <svg class="w-5 h-5 mr-2 text-orange-600" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                            </svg>
                            Informa√ß√µes T√©cnicas
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label for="edit-vehicle-odometro" class="block text-sm font-medium text-gray-700 mb-1">Od√¥metro Atual (km) *</label>
                                <input type="number" id="edit-vehicle-odometro" value="${vehicle.odometro}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            </div>
                            <div>
                                <label for="edit-vehicle-combustivel" class="block text-sm font-medium text-gray-700 mb-1">Combust√≠vel</label>
                                <select id="edit-vehicle-combustivel" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Selecione</option>
                                    <option value="Gasolina" ${vehicle.combustivel === 'Gasolina' ? 'selected' : ''}>Gasolina</option>
                                    <option value="Etanol" ${vehicle.combustivel === 'Etanol' ? 'selected' : ''}>Etanol</option>
                                    <option value="Flex" ${vehicle.combustivel === 'Flex' ? 'selected' : ''}>Flex</option>
                                    <option value="Diesel" ${vehicle.combustivel === 'Diesel' ? 'selected' : ''}>Diesel</option>
                                    <option value="GNV" ${vehicle.combustivel === 'GNV' ? 'selected' : ''}>GNV</option>
                                </select>
                            </div>
                            <div>
                                <label for="edit-vehicle-categoria" class="block text-sm font-medium text-gray-700 mb-1">Categoria</label>
                                <select id="edit-vehicle-categoria" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Selecione</option>
                                    <option value="Carro" ${vehicle.categoria === 'Carro' ? 'selected' : ''}>Carro</option>
                                    <option value="Caminh√£o" ${vehicle.categoria === 'Caminh√£o' ? 'selected' : ''}>Caminh√£o</option>
                                    <option value="Van" ${vehicle.categoria === 'Van' ? 'selected' : ''}>Van</option>
                                    <option value="Moto" ${vehicle.categoria === 'Moto' ? 'selected' : ''}>Moto</option>
                                    <option value="√înibus" ${vehicle.categoria === '√înibus' ? 'selected' : ''}>√înibus</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Observa√ß√µes -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                            <svg class="w-5 h-5 mr-2 text-purple-600" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                            </svg>
                            Observa√ß√µes Adicionais
                        </h4>
                        <div>
                            <label for="edit-vehicle-observacoes" class="block text-sm font-medium text-gray-700 mb-1">Observa√ß√µes</label>
                            <textarea id="edit-vehicle-observacoes" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">${vehicle.observacoes || ''}</textarea>
                        </div>
                    </div>

                    <!-- Bot√µes -->
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" onclick="closeModal()" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500">
                            Cancelar
                        </button>
                        <button type="submit" id="edit-vehicle-submit" class="bg-blue-600 text-white px-8 py-2 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M21 7L9 19l-5.5-5.5 1.41-1.41L9 16.17 19.59 5.59 21 7z"/>
                            </svg>
                            Salvar Altera√ß√µes
                        </button>
                    </div>
                </form>
            `;
            
            // Show modal
            overlay.classList.remove('hidden');
            
            // Setup form listener
            document.getElementById('edit-vehicle-form').addEventListener('submit', (e) => handleEditVehicleSubmit(e, vehicle));
        }

        // Handle edit vehicle form submission
        async function handleEditVehicleSubmit(e, originalVehicle) {
            e.preventDefault();
            console.log('‚úèÔ∏è Salvando altera√ß√µes do ve√≠culo:', originalVehicle.placa);

            const submitBtn = document.getElementById('edit-vehicle-submit');
            submitBtn.classList.add('loading');
            submitBtn.innerHTML = '<svg class="w-4 h-4 mr-2 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>Salvando...';

            try {
                const updatedVehicle = { ...originalVehicle };
                updatedVehicle.codigo = document.getElementById('edit-vehicle-codigo').value;
                updatedVehicle.placa = document.getElementById('edit-vehicle-placa').value.toUpperCase();
                updatedVehicle.marca = document.getElementById('edit-vehicle-marca').value;
                updatedVehicle.modelo = document.getElementById('edit-vehicle-modelo').value;
                updatedVehicle.ano = document.getElementById('edit-vehicle-ano').value || '';
                updatedVehicle.ano_modelo = document.getElementById('edit-vehicle-ano-modelo').value || '';
                updatedVehicle.cor = document.getElementById('edit-vehicle-cor').value || '';
                updatedVehicle.chassi = document.getElementById('edit-vehicle-chassi').value || '';
                updatedVehicle.renavam = document.getElementById('edit-vehicle-renavam').value || '';
                updatedVehicle.odometro = parseInt(document.getElementById('edit-vehicle-odometro').value);
                updatedVehicle.combustivel = document.getElementById('edit-vehicle-combustivel').value || '';
                updatedVehicle.categoria = document.getElementById('edit-vehicle-categoria').value || '';
                updatedVehicle.observacoes = document.getElementById('edit-vehicle-observacoes').value || '';

                if (window.dataSdk) {
                    const result = await window.dataSdk.update(updatedVehicle);
                    
                    if (result.isOk) {
                        showToast('Ve√≠culo atualizado com sucesso!', 'success');
                        closeModal();
                    } else {
                        showToast('Erro ao atualizar ve√≠culo', 'error');
                    }
                }
            } catch (error) {
                showToast('Erro inesperado ao atualizar ve√≠culo', 'error');
            } finally {
                submitBtn.classList.remove('loading');
                submitBtn.innerHTML = '<svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M21 7L9 19l-5.5-5.5 1.41-1.41L9 16.17 19.59 5.59 21 7z"/></svg>Salvar Altera√ß√µes';
            }
        }

        // Update drivers list
        function updateDriversList(drivers, vehicles) {
            const container = document.getElementById('drivers-list');
            if (!container) return;

            if (drivers.length === 0) {
                container.innerHTML = '<div class="text-center py-8 text-gray-500">Nenhum motorista cadastrado</div>';
                return;
            }

            container.innerHTML = drivers.map(driver => {
                const vehicle = vehicles.find(v => v.id === driver.vehicle_id);
                
                // Verificar vencimento da CNH
                const vencimentoCNH = driver.vencimento_cnh ? new Date(driver.vencimento_cnh) : null;
                const hoje = new Date();
                const diasParaVencer = vencimentoCNH ? Math.ceil((vencimentoCNH - hoje) / (1000 * 60 * 60 * 24)) : null;
                
                let alertaCNH = '';
                if (vencimentoCNH) {
                    if (diasParaVencer < 0) {
                        alertaCNH = '<span class="px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full">CNH Vencida</span>';
                    } else if (diasParaVencer <= 30) {
                        alertaCNH = '<span class="px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full">CNH Vence em ' + diasParaVencer + ' dias</span>';
                    }
                }

                return `
                    <div class="bg-white border border-gray-200 rounded-lg p-4 hover-lift">
                        <div class="flex justify-between items-start mb-3">
                            <div>
                                <h4 class="font-semibold text-lg text-gray-900">${driver.nome}</h4>
                                <p class="text-gray-600">${driver.cpf ? `CPF: ${driver.cpf}` : ''}</p>
                                ${driver.telefone ? `<p class="text-sm text-gray-500 flex items-center"><svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 24 24"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg>${driver.telefone}</p>` : ''}
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="px-2 py-1 text-xs font-medium rounded-full ${driver.status === 'Ativo' ? 'bg-green-100 text-green-800' : driver.status === 'Inativo' ? 'bg-red-100 text-red-800' : driver.status === 'F√©rias' ? 'bg-blue-100 text-blue-800' : 'bg-yellow-100 text-yellow-800'}">
                                    ${driver.status || 'Ativo'}
                                </span>
                                <div class="flex space-x-1">
                                    <button onclick="editDriver('${driver.__backendId}')" class="text-blue-600 hover:text-blue-800 p-1 rounded" title="Editar">
                                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                                        </svg>
                                    </button>
                                    <button onclick="deleteDriver('${driver.__backendId}')" class="text-red-600 hover:text-red-800 p-1 rounded" title="Excluir">
                                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Informa√ß√µes da CNH -->
                        <div class="mb-3">
                            <div class="flex flex-wrap items-center gap-2 mb-2">
                                <span class="px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded-full">CNH: ${driver.cnh}</span>
                                ${driver.categoria_cnh ? `<span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">Categoria ${driver.categoria_cnh}</span>` : ''}
                                ${alertaCNH}
                            </div>
                            ${driver.vencimento_cnh ? `<p class="text-xs text-gray-500">Vencimento: ${new Date(driver.vencimento_cnh).toLocaleDateString('pt-BR')}</p>` : ''}
                        </div>

                        <!-- Informa√ß√µes do Ve√≠culo -->
                        ${vehicle ? `
                        <div class="mb-3 p-2 bg-blue-50 rounded">
                            <p class="text-sm font-medium text-blue-900 flex items-center"><svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"/></svg>Ve√≠culo Principal</p>
                            <p class="text-sm text-blue-700">${vehicle.placa} - ${vehicle.marca} ${vehicle.modelo}</p>
                        </div>
                        ` : ''}

                        <!-- Informa√ß√µes de Contato -->
                        ${driver.email || driver.endereco ? `
                        <div class="mb-3 text-sm">
                            ${driver.email ? `<p class="text-gray-600 flex items-center"><svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 24 24"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>${driver.email}</p>` : ''}
                            ${driver.endereco ? `<p class="text-gray-600 flex items-center"><svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>${driver.endereco}${driver.cidade ? `, ${driver.cidade}` : ''}${driver.estado ? ` - ${driver.estado}` : ''}</p>` : ''}
                        </div>
                        ` : ''}

                        <!-- Informa√ß√µes Adicionais -->
                        <div class="border-t pt-2 text-xs text-gray-400">
                            ${driver.data_admissao ? `<p>Admiss√£o: ${new Date(driver.data_admissao).toLocaleDateString('pt-BR')}</p>` : ''}
                            <p>Cadastrado em: ${new Date(driver.created_at).toLocaleDateString('pt-BR')}</p>
                        </div>
                    </div>
                `;
            }).join('');
        }



        // Update suppliers list
        function updateSuppliersList(suppliers) {
            const container = document.getElementById('suppliers-list');
            if (!container) return;

            if (suppliers.length === 0) {
                container.innerHTML = '<div class="text-center py-8 text-gray-500">Nenhum fornecedor cadastrado</div>';
                return;
            }

            container.innerHTML = suppliers.map(supplier => `
                <div class="bg-white border border-gray-200 rounded-lg p-4 hover-lift">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h4 class="font-semibold text-lg text-gray-900">${supplier.nome_fornecedor}</h4>
                            ${supplier.razao_social ? `<p class="text-gray-600">${supplier.razao_social}</p>` : ''}
                            <p class="text-sm text-gray-500">CNPJ/CPF: ${supplier.cnpj}</p>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="px-2 py-1 text-xs font-medium rounded-full ${supplier.status === 'Ativo' ? 'bg-green-100 text-green-800' : supplier.status === 'Inativo' ? 'bg-red-100 text-red-800' : 'bg-yellow-100 text-yellow-800'}">
                                ${supplier.status || 'Ativo'}
                            </span>
                            <div class="flex space-x-1">
                                <button onclick="editSupplier('${supplier.__backendId}')" class="text-blue-600 hover:text-blue-800 p-1 rounded" title="Editar">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                                    </svg>
                                </button>
                                <button onclick="deleteSupplier('${supplier.__backendId}')" class="text-red-600 hover:text-red-800 p-1 rounded" title="Excluir">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Categoria e Especialidade -->
                    ${supplier.categoria || supplier.especialidade ? `
                    <div class="mb-3 flex flex-wrap gap-2">
                        ${supplier.categoria ? `<span class="px-2 py-1 bg-indigo-100 text-indigo-800 text-xs rounded-full flex items-center"><svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 24 24"><path d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>${supplier.categoria}</span>` : ''}
                        ${supplier.especialidade ? `<span class="px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded-full">${supplier.especialidade}</span>` : ''}
                    </div>
                    ` : ''}

                    <!-- Endere√ßo -->
                    ${supplier.endereco ? `
                    <div class="mb-3 p-2 bg-gray-50 rounded">
                        <p class="text-sm font-medium text-gray-900 flex items-center"><svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>Endere√ßo</p>
                        <p class="text-sm text-gray-700">${supplier.endereco}${supplier.numero ? `, ${supplier.numero}` : ''}${supplier.complemento ? ` - ${supplier.complemento}` : ''}</p>
                        <p class="text-sm text-gray-700">${supplier.bairro}${supplier.cidade ? `, ${supplier.cidade}` : ''}${supplier.estado ? ` - ${supplier.estado}` : ''}</p>
                        ${supplier.cep ? `<p class="text-xs text-gray-500">CEP: ${supplier.cep}</p>` : ''}
                    </div>
                    ` : ''}

                    <!-- Informa√ß√µes de Contato -->
                    ${supplier.telefone || supplier.celular || supplier.email || supplier.responsavel ? `
                    <div class="mb-3 text-sm">
                        ${supplier.telefone ? `<p class="text-gray-600 flex items-center"><svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 24 24"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg>${supplier.telefone}</p>` : ''}
                        ${supplier.celular ? `<p class="text-gray-600 flex items-center"><svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 24 24"><path d="M17 2H7c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H7V6h10v10z"/></svg>${supplier.celular}</p>` : ''}
                        ${supplier.email ? `<p class="text-gray-600 flex items-center"><svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 24 24"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>${supplier.email}</p>` : ''}
                        ${supplier.responsavel ? `<p class="text-gray-600 flex items-center"><svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>${supplier.responsavel}${supplier.cargo_responsavel ? ` (${supplier.cargo_responsavel})` : ''}</p>` : ''}
                    </div>
                    ` : ''}

                    <!-- Informa√ß√µes Comerciais -->
                    ${supplier.horario_funcionamento || supplier.prazo_pagamento || supplier.desconto_percentual ? `
                    <div class="mb-3 p-2 bg-indigo-50 rounded">
                        <p class="text-sm font-medium text-indigo-900 flex items-center"><svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 24 24"><path d="M20 6h-2.18c.11-.31.18-.65.18-1a2.996 2.996 0 0 0-5.5-1.65l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1z"/></svg>Informa√ß√µes Comerciais</p>
                        ${supplier.horario_funcionamento ? `<p class="text-sm text-indigo-700 flex items-center"><svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 24 24"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"/><path d="M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"/></svg>${supplier.horario_funcionamento}</p>` : ''}
                        ${supplier.prazo_pagamento ? `<p class="text-sm text-indigo-700 flex items-center"><svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 24 24"><path d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.1 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"/></svg>Prazo: ${supplier.prazo_pagamento}</p>` : ''}
                        ${supplier.desconto_percentual > 0 ? `<p class="text-sm text-indigo-700 flex items-center"><svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.41 16.09V20h-2.67v-1.93c-1.71-.36-3.16-1.46-3.27-3.4h1.96c.1 1.05.82 1.87 2.65 1.87 1.96 0 2.4-.98 2.4-1.59 0-.83-.44-1.61-2.67-2.14-2.48-.6-4.18-1.62-4.18-3.67 0-1.72 1.39-2.84 3.11-3.21V4h2.67v1.95c1.86.45 2.79 1.86 2.85 3.39H14.3c-.05-1.11-.64-1.87-2.22-1.87-1.5 0-2.4.68-2.4 1.64 0 .84.65 1.39 2.67 1.91s4.18 1.39 4.18 3.91c-.01 1.83-1.38 2.83-3.12 3.16z"/></svg>Desconto: ${supplier.desconto_percentual}%</p>` : ''}
                    </div>
                    ` : ''}

                    <!-- Informa√ß√µes Adicionais -->
                    <div class="border-t pt-2 text-xs text-gray-400">
                        <p>Cadastrado em: ${new Date(supplier.created_at).toLocaleDateString('pt-BR')}</p>
                    </div>
                </div>
            `).join('');
        }





        // Update all expenses list (including fuelings and expenses)
        function updateAllExpensesList() {
            const container = document.getElementById('all-expenses-list');
            if (!container) return;

            const fuelings = allData.filter(item => item.type === 'fueling');
            const expenses = allData.filter(item => item.type === 'expense');
            const orders = allData.filter(item => item.type === 'order');
            const vehicles = allData.filter(item => item.type === 'vehicle');
            const suppliers = allData.filter(item => item.type === 'supplier');

            const allExpenses = [...fuelings, ...expenses].sort((a, b) => new Date(b.created_at) - new Date(a.created_at));

            if (allExpenses.length === 0) {
                container.innerHTML = '<div class="text-center py-8 text-gray-500">Nenhuma despesa registrada</div>';
                return;
            }

            container.innerHTML = allExpenses.map(expense => {
                const order = orders.find(o => o.id === expense.order_id);
                
                if (expense.type === 'fueling') {
                    const vehicle = vehicles.find(v => v.id === expense.vehicle_id);
                    const station = suppliers.find(s => s.id === expense.station_id);
                    
                    return `
                        <div class="bg-orange-50 border border-orange-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                            <div class="flex justify-between items-start mb-2">
                                <div>
                                    <h4 class="font-semibold text-orange-900 flex items-center">
                                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                        </svg>
                                        Abastecimento
                                    </h4>
                                    <p class="text-gray-600">${vehicle ? `${vehicle.placa} - ${vehicle.marca} ${vehicle.modelo}` : 'Ve√≠culo n√£o encontrado'}</p>
                                    <p class="text-sm text-gray-500">${station ? station.nome_fornecedor : 'Posto n√£o encontrado'} ‚Ä¢ ${expense.litros}L</p>
                                    <p class="text-sm text-blue-600">OS: ${order ? order.numero_os : 'OS n√£o encontrada'}</p>
                                </div>
                                <button onclick="deleteFueling('${expense.__backendId}')" class="text-red-600 hover:text-red-800 text-sm">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-2 text-sm">
                                <div>
                                    <span class="text-gray-500">Data:</span>
                                    <p class="font-medium">${new Date(expense.data).toLocaleDateString('pt-BR')}</p>
                                </div>
                                <div>
                                    <span class="text-gray-500">KM:</span>
                                    <p class="font-medium">${expense.km_atual.toLocaleString('pt-BR')}</p>
                                </div>
                                <div>
                                    <span class="text-gray-500">Valor:</span>
                                    <p class="font-medium text-orange-700">R$ ${expense.valor_total.toFixed(2)}</p>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    return `
                        <div class="bg-red-50 border border-red-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                            <div class="flex justify-between items-start mb-2">
                                <div>
                                    <h4 class="font-semibold text-red-900 flex items-center">
                                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                                        </svg>
                                        ${expense.tipo_despesa}
                                    </h4>
                                    <p class="text-gray-600">${expense.descricao}</p>
                                    <p class="text-sm text-blue-600">OS: ${order ? order.numero_os : 'OS n√£o encontrada'}</p>
                                </div>
                                <button onclick="deleteExpense('${expense.__backendId}')" class="text-red-600 hover:text-red-800 text-sm">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="grid grid-cols-2 gap-2 text-sm">
                                <div>
                                    <span class="text-gray-500">Data:</span>
                                    <p class="font-medium">${new Date(expense.data).toLocaleDateString('pt-BR')}</p>
                                </div>
                                <div>
                                    <span class="text-gray-500">Valor:</span>
                                    <p class="font-medium text-red-700">R$ ${expense.valor_total.toFixed(2)}</p>
                                </div>
                            </div>
                        </div>
                    `;
                }
            }).join('');
        }

        // Update all lancamentos list (same as expenses but for lancamentos tab)
        function updateAllLancamentosList() {
            const container = document.getElementById('all-lancamentos-list');
            if (!container) return;

            const fuelings = allData.filter(item => item.type === 'fueling');
            const expenses = allData.filter(item => item.type === 'expense');
            const orders = allData.filter(item => item.type === 'order');
            const vehicles = allData.filter(item => item.type === 'vehicle');
            const suppliers = allData.filter(item => item.type === 'supplier');

            const allLancamentos = [...fuelings, ...expenses].sort((a, b) => new Date(b.created_at) - new Date(a.created_at));

            if (allLancamentos.length === 0) {
                container.innerHTML = '<div class="text-center py-8 text-gray-500">Nenhum lan√ßamento registrado</div>';
                return;
            }

            container.innerHTML = allLancamentos.map(lancamento => {
                const order = orders.find(o => o.id === lancamento.order_id);
                
                if (lancamento.type === 'fueling') {
                    const vehicle = vehicles.find(v => v.id === lancamento.vehicle_id);
                    const station = suppliers.find(s => s.id === lancamento.station_id);
                    
                    return `
                        <div class="bg-orange-50 border border-orange-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                            <div class="flex justify-between items-start mb-2">
                                <div>
                                    <h4 class="font-semibold text-orange-900 flex items-center">
                                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                        </svg>
                                        Abastecimento
                                    </h4>
                                    <p class="text-gray-600">${vehicle ? `${vehicle.placa} - ${vehicle.marca} ${vehicle.modelo}` : 'Ve√≠culo n√£o encontrado'}</p>
                                    <p class="text-sm text-gray-500">${station ? station.nome_fornecedor : 'Posto n√£o encontrado'} ‚Ä¢ ${lancamento.litros}L</p>
                                    <p class="text-sm text-blue-600">OS: ${order ? order.numero_os : 'OS n√£o encontrada'}</p>
                                </div>
                                <button onclick="deleteFueling('${lancamento.__backendId}')" class="text-red-600 hover:text-red-800 text-sm">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-2 text-sm">
                                <div>
                                    <span class="text-gray-500">Data:</span>
                                    <p class="font-medium">${new Date(lancamento.data).toLocaleDateString('pt-BR')}</p>
                                </div>
                                <div>
                                    <span class="text-gray-500">KM:</span>
                                    <p class="font-medium">${lancamento.km_atual.toLocaleString('pt-BR')}</p>
                                </div>
                                <div>
                                    <span class="text-gray-500">Valor:</span>
                                    <p class="font-medium text-orange-700">R$ ${lancamento.valor_total.toFixed(2)}</p>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    const supplier = suppliers.find(s => s.id === lancamento.supplier_id);
                    
                    return `
                        <div class="bg-red-50 border border-red-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                            <div class="flex justify-between items-start mb-2">
                                <div>
                                    <h4 class="font-semibold text-red-900 flex items-center">
                                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                                        </svg>
                                        ${lancamento.tipo_despesa}
                                    </h4>
                                    <p class="text-gray-600">${lancamento.descricao}</p>
                                    <p class="text-sm text-blue-600">OS: ${order ? order.numero_os : 'OS n√£o encontrada'}</p>
                                    ${supplier ? `<p class="text-sm text-indigo-600 flex items-center"><svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 24 24"><path d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>Fornecedor: ${supplier.nome_fornecedor}</p>` : ''}
                                </div>
                                <button onclick="deleteExpense('${lancamento.__backendId}')" class="text-red-600 hover:text-red-800 text-sm">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="grid grid-cols-2 gap-2 text-sm">
                                <div>
                                    <span class="text-gray-500">Data:</span>
                                    <p class="font-medium">${new Date(lancamento.data).toLocaleDateString('pt-BR')}</p>
                                </div>
                                <div>
                                    <span class="text-gray-500">Valor:</span>
                                    <p class="font-medium text-red-700">R$ ${lancamento.valor_total.toFixed(2)}</p>
                                </div>
                            </div>
                        </div>
                    `;
                }
            }).join('');
        }

        // Delete functions
        async function deleteVehicle(backendId) {
            const vehicle = allData.find(item => item.__backendId === backendId);
            if (!vehicle) return;

            // Criar confirma√ß√£o inline personalizada
            const confirmDiv = document.createElement('div');
            confirmDiv.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            confirmDiv.style.backdropFilter = 'blur(8px)';
            confirmDiv.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-6">
                    <div class="flex items-center mb-4">
                        <svg class="w-6 h-6 text-red-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                        </svg>
                        <h3 class="text-lg font-semibold text-gray-900">Confirmar Exclus√£o</h3>
                    </div>
                    <p class="text-gray-600 mb-6">Tem certeza que deseja excluir o ve√≠culo <strong>${vehicle.placa}</strong>?</p>
                    <div class="flex justify-end space-x-3">
                        <button onclick="this.closest('.fixed').remove()" class="bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600">
                            Cancelar
                        </button>
                        <button onclick="confirmDeleteVehicle('${backendId}'); this.closest('.fixed').remove();" class="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700">
                            Excluir
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(confirmDiv);
        }

        async function confirmDeleteVehicle(backendId) {
            const vehicle = allData.find(item => item.__backendId === backendId);
            if (!vehicle) return;

            try {
                if (window.dataSdk) {
                    const result = await window.dataSdk.delete(vehicle);
                    if (result.isOk) {
                        showToast('Ve√≠culo exclu√≠do com sucesso!', 'success');
                    } else {
                        showToast('Erro ao excluir ve√≠culo', 'error');
                    }
                }
            } catch (error) {
                showToast('Erro inesperado ao excluir ve√≠culo', 'error');
            }
        }

        async function deleteDriver(backendId) {
            const driver = allData.find(item => item.__backendId === backendId);
            if (!driver) return;

            // Criar confirma√ß√£o inline personalizada
            const confirmDiv = document.createElement('div');
            confirmDiv.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            confirmDiv.style.backdropFilter = 'blur(8px)';
            confirmDiv.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-6">
                    <div class="flex items-center mb-4">
                        <svg class="w-6 h-6 text-red-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                        </svg>
                        <h3 class="text-lg font-semibold text-gray-900">Confirmar Exclus√£o</h3>
                    </div>
                    <p class="text-gray-600 mb-6">Tem certeza que deseja excluir o motorista <strong>${driver.nome}</strong>?</p>
                    <div class="flex justify-end space-x-3">
                        <button onclick="this.closest('.fixed').remove()" class="bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600">
                            Cancelar
                        </button>
                        <button onclick="confirmDeleteDriver('${backendId}'); this.closest('.fixed').remove();" class="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700">
                            Excluir
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(confirmDiv);
        }

        async function confirmDeleteDriver(backendId) {
            const driver = allData.find(item => item.__backendId === backendId);
            if (!driver) return;

            try {
                if (window.dataSdk) {
                    const result = await window.dataSdk.delete(driver);
                    if (result.isOk) {
                        showToast('Motorista exclu√≠do com sucesso!', 'success');
                    } else {
                        showToast('Erro ao excluir motorista', 'error');
                    }
                }
            } catch (error) {
                showToast('Erro inesperado ao excluir motorista', 'error');
            }
        }

        async function deleteStation(backendId) {
            const station = allData.find(item => item.__backendId === backendId);
            if (!station) return;

            // Criar confirma√ß√£o inline personalizada
            const confirmDiv = document.createElement('div');
            confirmDiv.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            confirmDiv.style.backdropFilter = 'blur(8px)';
            confirmDiv.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-6">
                    <div class="flex items-center mb-4">
                        <svg class="w-6 h-6 text-red-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                        </svg>
                        <h3 class="text-lg font-semibold text-gray-900">Confirmar Exclus√£o</h3>
                    </div>
                    <p class="text-gray-600 mb-6">Tem certeza que deseja excluir o posto <strong>${station.nome_posto}</strong>?</p>
                    <div class="flex justify-end space-x-3">
                        <button onclick="this.closest('.fixed').remove()" class="bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600">
                            Cancelar
                        </button>
                        <button onclick="confirmDeleteStation('${backendId}'); this.closest('.fixed').remove();" class="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700">
                            Excluir
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(confirmDiv);
        }

        async function confirmDeleteStation(backendId) {
            const station = allData.find(item => item.__backendId === backendId);
            if (!station) return;

            try {
                if (window.dataSdk) {
                    const result = await window.dataSdk.delete(station);
                    if (result.isOk) {
                        showToast('Posto exclu√≠do com sucesso!', 'success');
                    } else {
                        showToast('Erro ao excluir posto', 'error');
                    }
                }
            } catch (error) {
                showToast('Erro inesperado ao excluir posto', 'error');
            }
        }

        async function deleteFueling(backendId) {
            const fueling = allData.find(item => item.__backendId === backendId);
            if (!fueling) return;

            // Criar confirma√ß√£o inline personalizada
            const confirmDiv = document.createElement('div');
            confirmDiv.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            confirmDiv.style.backdropFilter = 'blur(8px)';
            confirmDiv.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-6">
                    <div class="flex items-center mb-4">
                        <svg class="w-6 h-6 text-red-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                        </svg>
                        <h3 class="text-lg font-semibold text-gray-900">Confirmar Exclus√£o</h3>
                    </div>
                    <p class="text-gray-600 mb-6">Tem certeza que deseja excluir este <strong>abastecimento</strong>?</p>
                    <div class="flex justify-end space-x-3">
                        <button onclick="this.closest('.fixed').remove()" class="bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600">
                            Cancelar
                        </button>
                        <button onclick="confirmDeleteFueling('${backendId}'); this.closest('.fixed').remove();" class="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700">
                            Excluir
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(confirmDiv);
        }

        async function confirmDeleteFueling(backendId) {
            const fueling = allData.find(item => item.__backendId === backendId);
            if (!fueling) return;

            try {
                if (window.dataSdk) {
                    const result = await window.dataSdk.delete(fueling);
                    if (result.isOk) {
                        showToast('Abastecimento exclu√≠do com sucesso!', 'success');
                    } else {
                        showToast('Erro ao excluir abastecimento', 'error');
                    }
                }
            } catch (error) {
                showToast('Erro inesperado ao excluir abastecimento', 'error');
            }
        }

        // Edit supplier function
        function editSupplier(backendId) {
            const supplier = allData.find(item => item.__backendId === backendId);
            if (!supplier) return;
            
            console.log('‚úèÔ∏è Editando fornecedor:', supplier.nome_fornecedor);
            
            // Show edit form in modal
            const overlay = document.getElementById('modal-overlay');
            const title = document.getElementById('modal-title');
            const content = document.getElementById('modal-content');
            
            title.textContent = `Editar Fornecedor ${supplier.nome_fornecedor}`;
            content.innerHTML = `
                <form id="edit-supplier-form" class="space-y-6">
                    <!-- Informa√ß√µes B√°sicas -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                            <svg class="w-5 h-5 mr-2 text-indigo-600" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M20 6h-2.18c.11-.31.18-.65.18-1a2.996 2.996 0 0 0-5.5-1.65l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1z"/>
                            </svg>
                            Informa√ß√µes B√°sicas
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <div>
                                <label for="edit-supplier-nome" class="block text-sm font-medium text-gray-700 mb-1">Nome do Fornecedor *</label>
                                <input type="text" id="edit-supplier-nome" value="${supplier.nome_fornecedor}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                            </div>
                            <div>
                                <label for="edit-supplier-cnpj" class="block text-sm font-medium text-gray-700 mb-1">CNPJ/CPF *</label>
                                <input type="text" id="edit-supplier-cnpj" value="${supplier.cnpj}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                            </div>
                            <div>
                                <label for="edit-supplier-categoria" class="block text-sm font-medium text-gray-700 mb-1">Categoria</label>
                                <select id="edit-supplier-categoria" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    <option value="">Selecione</option>
                                    <option value="Oficina Mec√¢nica" ${supplier.categoria === 'Oficina Mec√¢nica' ? 'selected' : ''}>Oficina Mec√¢nica</option>
                                    <option value="Autope√ßas" ${supplier.categoria === 'Autope√ßas' ? 'selected' : ''}>Autope√ßas</option>
                                    <option value="Borracharia" ${supplier.categoria === 'Borracharia' ? 'selected' : ''}>Borracharia</option>
                                    <option value="Funilaria" ${supplier.categoria === 'Funilaria' ? 'selected' : ''}>Funilaria</option>
                                    <option value="El√©trica Automotiva" ${supplier.categoria === 'El√©trica Automotiva' ? 'selected' : ''}>El√©trica Automotiva</option>
                                    <option value="Seguradora" ${supplier.categoria === 'Seguradora' ? 'selected' : ''}>Seguradora</option>
                                    <option value="Despachante" ${supplier.categoria === 'Despachante' ? 'selected' : ''}>Despachante</option>
                                    <option value="Lavagem" ${supplier.categoria === 'Lavagem' ? 'selected' : ''}>Lavagem</option>
                                    <option value="Outros" ${supplier.categoria === 'Outros' ? 'selected' : ''}>Outros</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Endere√ßo -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                            <svg class="w-5 h-5 mr-2 text-blue-600" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                            </svg>
                            Endere√ßo
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="edit-supplier-endereco" class="block text-sm font-medium text-gray-700 mb-1">Logradouro *</label>
                                <input type="text" id="edit-supplier-endereco" value="${supplier.endereco || ''}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                            </div>
                            <div>
                                <label for="edit-supplier-cidade" class="block text-sm font-medium text-gray-700 mb-1">Cidade *</label>
                                <input type="text" id="edit-supplier-cidade" value="${supplier.cidade || ''}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                            </div>
                        </div>
                    </div>

                    <!-- Contato -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                            <svg class="w-5 h-5 mr-2 text-green-600" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                            </svg>
                            Informa√ß√µes de Contato
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="edit-supplier-telefone" class="block text-sm font-medium text-gray-700 mb-1">Telefone</label>
                                <input type="tel" id="edit-supplier-telefone" value="${supplier.telefone || ''}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div>
                                <label for="edit-supplier-status" class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                                <select id="edit-supplier-status" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    <option value="Ativo" ${supplier.status === 'Ativo' ? 'selected' : ''}>Ativo</option>
                                    <option value="Inativo" ${supplier.status === 'Inativo' ? 'selected' : ''}>Inativo</option>
                                    <option value="Suspenso" ${supplier.status === 'Suspenso' ? 'selected' : ''}>Suspenso</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Bot√µes -->
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" onclick="closeModal()" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500">
                            Cancelar
                        </button>
                        <button type="submit" id="edit-supplier-submit" class="bg-indigo-600 text-white px-8 py-2 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M21 7L9 19l-5.5-5.5 1.41-1.41L9 16.17 19.59 5.59 21 7z"/>
                            </svg>
                            Salvar Altera√ß√µes
                        </button>
                    </div>
                </form>
            `;
            
            // Show modal
            overlay.classList.remove('hidden');
            
            // Setup form listener
            document.getElementById('edit-supplier-form').addEventListener('submit', (e) => handleEditSupplierSubmit(e, supplier));
        }

        // Handle edit supplier form submission
        async function handleEditSupplierSubmit(e, originalSupplier) {
            e.preventDefault();
            console.log('‚úèÔ∏è Salvando altera√ß√µes do fornecedor:', originalSupplier.nome_fornecedor);

            const submitBtn = document.getElementById('edit-supplier-submit');
            submitBtn.classList.add('loading');
            submitBtn.innerHTML = '<svg class="w-4 h-4 mr-2 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>Salvando...';

            try {
                const updatedSupplier = { ...originalSupplier };
                updatedSupplier.nome_fornecedor = document.getElementById('edit-supplier-nome').value;
                updatedSupplier.cnpj = document.getElementById('edit-supplier-cnpj').value;
                updatedSupplier.categoria = document.getElementById('edit-supplier-categoria').value || '';
                updatedSupplier.endereco = document.getElementById('edit-supplier-endereco').value || '';
                updatedSupplier.cidade = document.getElementById('edit-supplier-cidade').value || '';
                updatedSupplier.telefone = document.getElementById('edit-supplier-telefone').value || '';
                updatedSupplier.status = document.getElementById('edit-supplier-status').value;

                if (window.dataSdk) {
                    const result = await window.dataSdk.update(updatedSupplier);
                    
                    if (result.isOk) {
                        showToast('Fornecedor atualizado com sucesso!', 'success');
                        closeModal();
                    } else {
                        showToast('Erro ao atualizar fornecedor', 'error');
                    }
                }
            } catch (error) {
                showToast('Erro inesperado ao atualizar fornecedor', 'error');
            } finally {
                submitBtn.classList.remove('loading');
                submitBtn.innerHTML = '<svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M21 7L9 19l-5.5-5.5 1.41-1.41L9 16.17 19.59 5.59 21 7z"/></svg>Salvar Altera√ß√µes';
            }
        }

        async function deleteSupplier(backendId) {
            const supplier = allData.find(item => item.__backendId === backendId);
            if (!supplier) return;

            // Criar confirma√ß√£o inline personalizada
            const confirmDiv = document.createElement('div');
            confirmDiv.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            confirmDiv.style.backdropFilter = 'blur(8px)';
            confirmDiv.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-6">
                    <div class="flex items-center mb-4">
                        <svg class="w-6 h-6 text-red-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                        </svg>
                        <h3 class="text-lg font-semibold text-gray-900">Confirmar Exclus√£o</h3>
                    </div>
                    <p class="text-gray-600 mb-6">Tem certeza que deseja excluir o fornecedor <strong>${supplier.nome_fornecedor}</strong>?</p>
                    <div class="flex justify-end space-x-3">
                        <button onclick="this.closest('.fixed').remove()" class="bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600">
                            Cancelar
                        </button>
                        <button onclick="confirmDeleteSupplier('${backendId}'); this.closest('.fixed').remove();" class="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700">
                            Excluir
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(confirmDiv);
        }

        async function confirmDeleteSupplier(backendId) {
            const supplier = allData.find(item => item.__backendId === backendId);
            if (!supplier) return;

            try {
                if (window.dataSdk) {
                    const result = await window.dataSdk.delete(supplier);
                    if (result.isOk) {
                        showToast('Fornecedor exclu√≠do com sucesso!', 'success');
                    } else {
                        showToast('Erro ao excluir fornecedor', 'error');
                    }
                }
            } catch (error) {
                showToast('Erro inesperado ao excluir fornecedor', 'error');
            }
        }

        async function deleteExpense(backendId) {
            const expense = allData.find(item => item.__backendId === backendId);
            if (!expense) return;

            // Criar confirma√ß√£o inline personalizada
            const confirmDiv = document.createElement('div');
            confirmDiv.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            confirmDiv.style.backdropFilter = 'blur(8px)';
            confirmDiv.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-6">
                    <div class="flex items-center mb-4">
                        <svg class="w-6 h-6 text-red-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                        </svg>
                        <h3 class="text-lg font-semibold text-gray-900">Confirmar Exclus√£o</h3>
                    </div>
                    <p class="text-gray-600 mb-6">Tem certeza que deseja excluir esta <strong>despesa</strong>?</p>
                    <div class="flex justify-end space-x-3">
                        <button onclick="this.closest('.fixed').remove()" class="bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600">
                            Cancelar
                        </button>
                        <button onclick="confirmDeleteExpense('${backendId}'); this.closest('.fixed').remove();" class="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700">
                            Excluir
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(confirmDiv);
        }

        async function confirmDeleteExpense(backendId) {
            const expense = allData.find(item => item.__backendId === backendId);
            if (!expense) return;

            try {
                if (window.dataSdk) {
                    const result = await window.dataSdk.delete(expense);
                    if (result.isOk) {
                        showToast('Despesa exclu√≠da com sucesso!', 'success');
                    } else {
                        showToast('Erro ao excluir despesa', 'error');
                    }
                }
            } catch (error) {
                showToast('Erro inesperado ao excluir despesa', 'error');
            }
        }

        // Order management functions
        async function changeOrderStatus(backendId, newStatus) {
            const order = allData.find(item => item.__backendId === backendId);
            if (!order) return;

            try {
                const updatedOrder = { ...order };
                updatedOrder.status = newStatus;
                
                if (newStatus === 'Fechada') {
                    updatedOrder.data_fechamento = new Date().toISOString();
                } else if (newStatus === 'Aberta') {
                    updatedOrder.data_fechamento = '';
                }

                if (window.dataSdk) {
                    const result = await window.dataSdk.update(updatedOrder);
                    if (result.isOk) {
                        showToast(`OS ${order.numero_os} ${newStatus.toLowerCase()}!`, 'success');
                    } else {
                        showToast('Erro ao alterar status da OS', 'error');
                    }
                }
            } catch (error) {
                showToast('Erro inesperado ao alterar status', 'error');
            }
        }

        function toggleOrderExpenses(orderId) {
            const expensesDiv = document.getElementById(`expenses-${orderId}`);
            if (expensesDiv) {
                expensesDiv.classList.toggle('hidden');
            }
        }

        // Order selection management
        let selectedOrders = new Set();

        function updateOrderSelection() {
            const checkboxes = document.querySelectorAll('.order-checkbox');
            selectedOrders.clear();
            
            checkboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    selectedOrders.add(checkbox.dataset.orderId);
                }
            });

            const editBtn = document.getElementById('edit-order-btn');
            const deleteBtn = document.getElementById('delete-orders-btn');
            const exportBtn = document.getElementById('export-order-btn');
            const selectionInfo = document.getElementById('selection-info');
            const selectionCount = document.getElementById('selection-count');

            if (selectedOrders.size === 0) {
                editBtn.disabled = true;
                deleteBtn.disabled = true;
                exportBtn.disabled = true;
                selectionInfo.classList.add('hidden');
            } else {
                deleteBtn.disabled = false;
                editBtn.disabled = selectedOrders.size !== 1;
                exportBtn.disabled = selectedOrders.size !== 1;
                selectionInfo.classList.remove('hidden');
                selectionCount.textContent = `${selectedOrders.size} OS selecionada${selectedOrders.size > 1 ? 's' : ''}`;
            }
        }

        function editSelectedOrder() {
            if (selectedOrders.size !== 1) return;
            
            const backendId = Array.from(selectedOrders)[0];
            const order = allData.find(item => item.__backendId === backendId);
            if (!order) return;

            // Show edit form in modal
            const overlay = document.getElementById('modal-overlay');
            const title = document.getElementById('modal-title');
            const content = document.getElementById('modal-content');
            
            title.textContent = `Editar OS ${order.numero_os}`;
            content.innerHTML = `
                <form id="edit-order-form" class="space-y-4">
                    <div>
                        <label for="edit-order-descricao" class="block text-sm font-medium text-gray-700 mb-1">Descri√ß√£o</label>
                        <input type="text" id="edit-order-descricao" value="${order.descricao}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label for="edit-order-observacoes" class="block text-sm font-medium text-gray-700 mb-1">Observa√ß√µes</label>
                        <textarea id="edit-order-observacoes" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">${order.observacoes || ''}</textarea>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" onclick="closeModal()" class="bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600">
                            Cancelar
                        </button>
                        <button type="submit" id="edit-order-submit" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
                            Salvar Altera√ß√µes
                        </button>
                    </div>
                </form>
            `;
            
            overlay.classList.remove('hidden');
            
            document.getElementById('edit-order-form').addEventListener('submit', (e) => handleEditOrderSubmit(e, order));
        }

        async function handleEditOrderSubmit(e, originalOrder) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('edit-order-submit');
            submitBtn.classList.add('loading');
            submitBtn.textContent = 'Salvando...';

            try {
                const updatedOrder = { ...originalOrder };
                updatedOrder.descricao = document.getElementById('edit-order-descricao').value;
                updatedOrder.observacoes = document.getElementById('edit-order-observacoes').value;

                if (window.dataSdk) {
                    const result = await window.dataSdk.update(updatedOrder);
                    
                    if (result.isOk) {
                        showToast('OS atualizada com sucesso!', 'success');
                        closeModal();
                        selectedOrders.clear();
                        updateOrderSelection();
                    } else {
                        showToast('Erro ao atualizar OS', 'error');
                    }
                }
            } catch (error) {
                showToast('Erro inesperado ao atualizar OS', 'error');
            } finally {
                submitBtn.classList.remove('loading');
                submitBtn.textContent = 'Salvar Altera√ß√µes';
            }
        }

        async function deleteSelectedOrders() {
            if (selectedOrders.size === 0) return;
            
            const ordersList = Array.from(selectedOrders).map(id => {
                const order = allData.find(item => item.__backendId === id);
                return order ? order.numero_os : id;
            }).join(', ');

            // Criar confirma√ß√£o inline personalizada com blur
            const confirmDiv = document.createElement('div');
            confirmDiv.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            confirmDiv.style.backdropFilter = 'blur(8px)';
            confirmDiv.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-6">
                    <div class="flex items-center mb-4">
                        <svg class="w-6 h-6 text-red-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                        </svg>
                        <h3 class="text-lg font-semibold text-gray-900">Confirmar Exclus√£o</h3>
                    </div>
                    <p class="text-gray-600 mb-6">Tem certeza que deseja excluir <strong>${selectedOrders.size} OS</strong>?<br><small class="text-gray-500">(${ordersList})</small></p>
                    <div class="flex justify-end space-x-3">
                        <button onclick="this.closest('.fixed').remove()" class="bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600">
                            Cancelar
                        </button>
                        <button onclick="confirmDeleteSelectedOrders(); this.closest('.fixed').remove();" class="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700">
                            Excluir ${selectedOrders.size} OS
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(confirmDiv);
        }

        async function confirmDeleteSelectedOrders() {
            try {
                const deletePromises = Array.from(selectedOrders).map(async (backendId) => {
                    const order = allData.find(item => item.__backendId === backendId);
                    if (order && window.dataSdk) {
                        return await window.dataSdk.delete(order);
                    }
                });

                const results = await Promise.all(deletePromises);
                const successCount = results.filter(r => r && r.isOk).length;
                
                if (successCount === selectedOrders.size) {
                    showToast(`${successCount} OS exclu√≠da${successCount > 1 ? 's' : ''} com sucesso!`, 'success');
                } else {
                    showToast(`${successCount} de ${selectedOrders.size} OS exclu√≠das`, 'warning');
                }
                
                selectedOrders.clear();
                updateOrderSelection();
                
            } catch (error) {
                showToast('Erro inesperado ao excluir OS', 'error');
            }
        }

        // Utility functions
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function showToast(message, type = 'info') {
            const container = document.getElementById('header-toast-container');
            if (!container) return;

            // Remove any existing toast
            container.innerHTML = '';

            const toast = document.createElement('div');
            toast.className = `toast-enter w-full bg-white shadow-lg rounded-lg pointer-events-auto flex ring-1 ring-black ring-opacity-5 border-2`;
            
            const bgColor = {
                success: 'bg-green-50 border-green-300',
                error: 'bg-red-50 border-red-300',
                warning: 'bg-yellow-50 border-yellow-300',
                info: 'bg-blue-50 border-blue-300'
            }[type] || 'bg-gray-50 border-gray-300';

            const textColor = {
                success: 'text-green-800',
                error: 'text-red-800',
                warning: 'text-yellow-800',
                info: 'text-blue-800'
            }[type] || 'text-gray-800';

            const icon = {
                success: '‚úÖ',
                error: '‚ùå',
                warning: '‚ö†Ô∏è',
                info: '‚ÑπÔ∏è'
            }[type] || '‚ÑπÔ∏è';

            toast.innerHTML = `
                <div class="flex-1 w-0 p-3">
                    <div class="flex items-center">
                        <span class="text-lg mr-2">${icon}</span>
                        <p class="text-sm font-medium ${textColor} flex-1">${message}</p>
                        <button onclick="this.closest('.flex').remove()" class="ml-2 text-gray-400 hover:text-gray-600 focus:outline-none">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            `;

            toast.className += ` ${bgColor}`;
            container.appendChild(toast);

            // Animate in
            setTimeout(() => {
                toast.classList.remove('toast-enter');
                toast.classList.add('toast-show');
            }, 100);

            // Auto remove after 4 seconds
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.classList.remove('toast-show');
                    toast.classList.add('toast-exit');
                    setTimeout(() => {
                        if (toast.parentNode) {
                            toast.remove();
                        }
                    }, 300);
                }
            }, 4000);
        }

        // Export selected order to Excel
        function exportSelectedOrder() {
            if (selectedOrders.size !== 1) return;
            
            const backendId = Array.from(selectedOrders)[0];
            const order = allData.find(item => item.__backendId === backendId);
            if (!order) return;

            console.log('üìä Exportando OS:', order.numero_os);

            // Coletar todos os dados da OS
            const orderExpenses = allData.filter(item => 
                (item.type === 'fueling' || item.type === 'expense') && item.order_id === order.id
            );

            const vehicles = allData.filter(item => item.type === 'vehicle');
            const stations = allData.filter(item => item.type === 'station');

            // Preparar dados para exporta√ß√£o
            const exportData = [];

            // Cabe√ßalho da OS
            exportData.push(['ORDEM DE SERVI√áO - OS ' + order.numero_os]);
            exportData.push(['']);
            exportData.push(['INFORMA√á√ïES GERAIS']);
            exportData.push(['Descri√ß√£o:', order.descricao]);
            exportData.push(['Cliente:', order.cliente || '-']);
            exportData.push(['Respons√°vel:', order.responsavel || '-']);
            exportData.push(['Prioridade:', order.prioridade || 'Normal']);
            exportData.push(['Status:', order.status]);
            exportData.push(['Data de Abertura:', new Date(order.data_abertura).toLocaleDateString('pt-BR')]);
            exportData.push(['Previs√£o de T√©rmino:', order.previsao_termino ? new Date(order.previsao_termino).toLocaleDateString('pt-BR') : '-']);
            exportData.push(['Data de Fechamento:', order.data_fechamento ? new Date(order.data_fechamento).toLocaleDateString('pt-BR') : '-']);
            exportData.push(['Observa√ß√µes:', order.observacoes || '-']);
            exportData.push(['']);

            // Resumo financeiro
            const totalValue = orderExpenses.reduce((sum, expense) => sum + (expense.valor_total || 0), 0);
            const fuelings = orderExpenses.filter(item => item.type === 'fueling');
            const expenses = orderExpenses.filter(item => item.type === 'expense');
            const totalLiters = fuelings.reduce((sum, f) => sum + (f.litros || 0), 0);

            exportData.push(['RESUMO FINANCEIRO']);
            exportData.push(['Total de Abastecimentos:', fuelings.length]);
            exportData.push(['Total de Outras Despesas:', expenses.length]);
            exportData.push(['Total de Litros:', totalLiters.toFixed(2) + 'L']);
            exportData.push(['Valor Total:', 'R$ ' + totalValue.toLocaleString('pt-BR', {minimumFractionDigits: 2})]);
            exportData.push(['']);

            // Detalhamento dos abastecimentos
            if (fuelings.length > 0) {
                exportData.push(['ABASTECIMENTOS']);
                exportData.push(['Data', 'Ve√≠culo', 'Placa', 'Posto', 'KM', 'Litros', 'Valor']);
                
                fuelings.forEach(fueling => {
                    const vehicle = vehicles.find(v => v.id === fueling.vehicle_id);
                    const station = stations.find(s => s.id === fueling.station_id);
                    
                    exportData.push([
                        new Date(fueling.data).toLocaleDateString('pt-BR'),
                        vehicle ? `${vehicle.marca} ${vehicle.modelo}` : 'Ve√≠culo n√£o encontrado',
                        vehicle ? vehicle.placa : '-',
                        station ? station.nome_posto : 'Posto n√£o encontrado',
                        fueling.km_atual.toLocaleString('pt-BR'),
                        fueling.litros.toFixed(2),
                        'R$ ' + fueling.valor_total.toFixed(2)
                    ]);
                });
                exportData.push(['']);
            }

            // Detalhamento das outras despesas
            if (expenses.length > 0) {
                exportData.push(['OUTRAS DESPESAS']);
                exportData.push(['Data', 'Tipo', 'Descri√ß√£o', 'Valor']);
                
                expenses.forEach(expense => {
                    exportData.push([
                        new Date(expense.data).toLocaleDateString('pt-BR'),
                        expense.tipo_despesa,
                        expense.descricao,
                        'R$ ' + expense.valor_total.toFixed(2)
                    ]);
                });
                exportData.push(['']);
            }

            // Criar e baixar arquivo CSV
            const csvContent = exportData.map(row => 
                row.map(cell => `"${cell}"`).join(',')
            ).join('\n');

            const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', `OS_${order.numero_os}_${order.descricao.replace(/[^a-zA-Z0-9]/g, '_')}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showToast(`OS ${order.numero_os} exportada com sucesso!`, 'success');
                console.log('‚úÖ Exporta√ß√£o conclu√≠da');
            } else {
                showToast('Erro ao exportar OS - navegador n√£o suportado', 'error');
            }
        }

        // Show vehicle consumption report
        function showVehicleConsumptionReport(vehicleId) {
            const vehicle = allData.find(item => item.type === 'vehicle' && item.id === vehicleId);
            if (!vehicle) return;

            console.log('üìä Mostrando relat√≥rio de consumo para:', vehicle.placa);

            // Get all fuelings for this vehicle
            const vehicleFuelings = allData.filter(item => 
                item.type === 'fueling' && item.vehicle_id === vehicleId
            ).sort((a, b) => new Date(a.data) - new Date(b.data));

            if (vehicleFuelings.length === 0) {
                showToast('Nenhum abastecimento encontrado para este ve√≠culo', 'warning');
                return;
            }

            // Show report in modal
            const overlay = document.getElementById('modal-overlay');
            const title = document.getElementById('modal-title');
            const content = document.getElementById('modal-content');
            
            title.textContent = `Relat√≥rio de Consumo - ${vehicle.placa}`;
            content.innerHTML = `
                <div class="space-y-6">
                    <!-- Filtros de Per√≠odo -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                            <svg class="w-5 h-5 mr-2 text-blue-600" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.1 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"/>
                            </svg>
                            Filtrar por Per√≠odo
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label for="consumption-start-date" class="block text-sm font-medium text-gray-700 mb-1">Data Inicial</label>
                                <input type="date" id="consumption-start-date" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="consumption-end-date" class="block text-sm font-medium text-gray-700 mb-1">Data Final</label>
                                <input type="date" id="consumption-end-date" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div class="flex items-end">
                                <button onclick="updateConsumptionReport('${vehicleId}')" class="w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    Atualizar Relat√≥rio
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Resumo Geral -->
                    <div id="consumption-summary" class="bg-white border border-gray-200 rounded-lg p-6">
                        <!-- Ser√° preenchido dinamicamente -->
                    </div>

                    <!-- Detalhamento por Per√≠odo -->
                    <div id="consumption-details" class="bg-white border border-gray-200 rounded-lg p-6">
                        <!-- Ser√° preenchido dinamicamente -->
                    </div>

                    <!-- Hist√≥rico de Abastecimentos -->
                    <div id="consumption-history" class="bg-white border border-gray-200 rounded-lg p-6">
                        <!-- Ser√° preenchido dinamicamente -->
                    </div>

                    <!-- Bot√µes de A√ß√£o -->
                    <div class="flex justify-end space-x-3 pt-4">
                        <button onclick="exportConsumptionReport('${vehicleId}')" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                            Exportar Relat√≥rio
                        </button>
                        <button onclick="closeModal()" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500">
                            Fechar
                        </button>
                    </div>
                </div>
            `;
            
            // Show modal
            overlay.classList.remove('hidden');
            
            // Set default dates (last 30 days)
            const today = new Date();
            const thirtyDaysAgo = new Date(today.getTime() - (30 * 24 * 60 * 60 * 1000));
            
            document.getElementById('consumption-end-date').value = today.toISOString().split('T')[0];
            document.getElementById('consumption-start-date').value = thirtyDaysAgo.toISOString().split('T')[0];
            
            // Generate initial report
            updateConsumptionReport(vehicleId);
        }

        // Update consumption report based on selected period
        function updateConsumptionReport(vehicleId) {
            const vehicle = allData.find(item => item.type === 'vehicle' && item.id === vehicleId);
            if (!vehicle) return;

            const startDate = document.getElementById('consumption-start-date').value;
            const endDate = document.getElementById('consumption-end-date').value;

            // Filter fuelings by date range
            let vehicleFuelings = allData.filter(item => 
                item.type === 'fueling' && item.vehicle_id === vehicleId
            );

            if (startDate) {
                vehicleFuelings = vehicleFuelings.filter(f => f.data >= startDate);
            }
            if (endDate) {
                vehicleFuelings = vehicleFuelings.filter(f => f.data <= endDate);
            }

            vehicleFuelings.sort((a, b) => new Date(a.data) - new Date(b.data));

            // Get related data
            const orders = allData.filter(item => item.type === 'order');
            const stations = allData.filter(item => item.type === 'station');

            // Calculate statistics
            const stats = calculatePeriodConsumption(vehicleFuelings);
            
            // Update summary
            updateConsumptionSummary(vehicle, stats, startDate, endDate);
            
            // Update details
            updateConsumptionDetails(vehicleFuelings, stats);
            
            // Update history
            updateConsumptionHistory(vehicleFuelings, orders, stations);
        }

        // Calculate consumption statistics for a period
        function calculatePeriodConsumption(fuelings) {
            if (fuelings.length === 0) {
                return {
                    totalFuelings: 0,
                    totalLiters: 0,
                    totalCost: 0,
                    totalKm: 0,
                    avgConsumption: 0,
                    costPerKm: 0,
                    costPerLiter: 0,
                    monthlyStats: []
                };
            }

            const totalLiters = fuelings.reduce((sum, f) => sum + f.litros, 0);
            const totalCost = fuelings.reduce((sum, f) => sum + f.valor_total, 0);
            
            // Calculate KM difference between first and last fueling
            const sortedByKm = [...fuelings].sort((a, b) => a.km_atual - b.km_atual);
            const totalKm = sortedByKm.length > 1 ? 
                sortedByKm[sortedByKm.length - 1].km_atual - sortedByKm[0].km_atual : 0;

            const avgConsumption = totalLiters > 0 && totalKm > 0 ? totalKm / totalLiters : 0;
            const costPerKm = totalKm > 0 ? totalCost / totalKm : 0;
            const costPerLiter = totalLiters > 0 ? totalCost / totalLiters : 0;

            // Group by month for trend analysis
            const monthlyStats = {};
            fuelings.forEach(fueling => {
                const date = new Date(fueling.data);
                const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                
                if (!monthlyStats[monthKey]) {
                    monthlyStats[monthKey] = {
                        month: monthKey,
                        fuelings: [],
                        totalLiters: 0,
                        totalCost: 0,
                        totalKm: 0
                    };
                }
                
                monthlyStats[monthKey].fuelings.push(fueling);
                monthlyStats[monthKey].totalLiters += fueling.litros;
                monthlyStats[monthKey].totalCost += fueling.valor_total;
            });

            // Calculate KM for each month
            Object.values(monthlyStats).forEach(month => {
                if (month.fuelings.length > 1) {
                    const sortedByKm = month.fuelings.sort((a, b) => a.km_atual - b.km_atual);
                    month.totalKm = sortedByKm[sortedByKm.length - 1].km_atual - sortedByKm[0].km_atual;
                }
                month.avgConsumption = month.totalLiters > 0 && month.totalKm > 0 ? 
                    month.totalKm / month.totalLiters : 0;
                month.costPerKm = month.totalKm > 0 ? month.totalCost / month.totalKm : 0;
            });

            return {
                totalFuelings: fuelings.length,
                totalLiters,
                totalCost,
                totalKm,
                avgConsumption,
                costPerKm,
                costPerLiter,
                monthlyStats: Object.values(monthlyStats).sort((a, b) => a.month.localeCompare(b.month))
            };
        }

        // Update consumption summary section
        function updateConsumptionSummary(vehicle, stats, startDate, endDate) {
            const summaryContainer = document.getElementById('consumption-summary');
            if (!summaryContainer) return;

            const periodText = startDate && endDate ? 
                `${new Date(startDate).toLocaleDateString('pt-BR')} a ${new Date(endDate).toLocaleDateString('pt-BR')}` :
                'Per√≠odo completo';

            summaryContainer.innerHTML = `
                <div class="mb-4">
                    <h4 class="text-lg font-semibold text-gray-900 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-green-600" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                        </svg>
                        Resumo do Per√≠odo
                    </h4>
                    <p class="text-gray-600">${vehicle.marca} ${vehicle.modelo} - ${vehicle.placa}</p>
                    <p class="text-sm text-gray-500">${periodText}</p>
                </div>

                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="bg-blue-50 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-blue-800">${stats.totalFuelings}</div>
                        <div class="text-sm text-blue-600">Abastecimentos</div>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-green-800">${stats.totalLiters.toFixed(1)}L</div>
                        <div class="text-sm text-green-600">Total de Litros</div>
                    </div>
                    <div class="bg-red-50 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-red-800">R$ ${stats.totalCost.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</div>
                        <div class="text-sm text-red-600">Custo Total</div>
                    </div>
                    <div class="bg-yellow-50 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-yellow-800">${stats.totalKm.toLocaleString('pt-BR')} km</div>
                        <div class="text-sm text-yellow-600">KM Rodados</div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                    <div class="bg-purple-50 p-4 rounded-lg text-center">
                        <div class="text-xl font-bold text-purple-800">${stats.avgConsumption.toFixed(1)} km/l</div>
                        <div class="text-sm text-purple-600">Consumo M√©dio</div>
                    </div>
                    <div class="bg-orange-50 p-4 rounded-lg text-center">
                        <div class="text-xl font-bold text-orange-800">R$ ${stats.costPerKm.toFixed(2)}</div>
                        <div class="text-sm text-orange-600">Custo por KM</div>
                    </div>
                    <div class="bg-indigo-50 p-4 rounded-lg text-center">
                        <div class="text-xl font-bold text-indigo-800">R$ ${stats.costPerLiter.toFixed(2)}</div>
                        <div class="text-sm text-indigo-600">Pre√ßo M√©dio/Litro</div>
                    </div>
                </div>
            `;
        }

        // Update consumption details section
        function updateConsumptionDetails(fuelings, stats) {
            const detailsContainer = document.getElementById('consumption-details');
            if (!detailsContainer) return;

            if (stats.monthlyStats.length === 0) {
                detailsContainer.innerHTML = `
                    <h4 class="text-lg font-semibold text-gray-900 mb-4">An√°lise Mensal</h4>
                    <div class="text-center py-8 text-gray-500">Nenhum dado encontrado para o per√≠odo selecionado</div>
                `;
                return;
            }

            detailsContainer.innerHTML = `
                <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                    <svg class="w-5 h-5 mr-2 text-blue-600" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"/>
                    </svg>
                    An√°lise Mensal
                </h4>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">M√™s</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Abastecimentos</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Litros</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">KM</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Consumo</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Custo</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">R$/KM</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            ${stats.monthlyStats.map(month => {
                                const [year, monthNum] = month.month.split('-');
                                const monthName = new Date(year, monthNum - 1).toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });
                                
                                return `
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${monthName}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${month.fuelings.length}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${month.totalLiters.toFixed(1)}L</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${month.totalKm.toLocaleString('pt-BR')} km</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${month.avgConsumption.toFixed(1)} km/l</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">R$ ${month.totalCost.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">R$ ${month.costPerKm.toFixed(2)}</td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        // Update consumption history section
        function updateConsumptionHistory(fuelings, orders, stations) {
            const historyContainer = document.getElementById('consumption-history');
            if (!historyContainer) return;

            if (fuelings.length === 0) {
                historyContainer.innerHTML = `
                    <h4 class="text-lg font-semibold text-gray-900 mb-4">Hist√≥rico de Abastecimentos</h4>
                    <div class="text-center py-8 text-gray-500">Nenhum abastecimento encontrado para o per√≠odo selecionado</div>
                `;
                return;
            }

            // Sort by date (most recent first)
            const sortedFuelings = [...fuelings].sort((a, b) => new Date(b.data) - new Date(a.data));

            historyContainer.innerHTML = `
                <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                    <svg class="w-5 h-5 mr-2 text-orange-600" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"/>
                    </svg>
                    Hist√≥rico de Abastecimentos (${fuelings.length})
                </h4>
                <div class="space-y-3 max-h-96 overflow-y-auto">
                    ${sortedFuelings.map(fueling => {
                        const order = orders.find(o => o.id === fueling.order_id);
                        const station = stations.find(s => s.id === fueling.station_id);
                        const pricePerLiter = fueling.litros > 0 ? fueling.valor_total / fueling.litros : 0;
                        
                        return `
                            <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
                                <div class="flex justify-between items-start mb-2">
                                    <div>
                                        <h5 class="font-semibold text-orange-900">${new Date(fueling.data).toLocaleDateString('pt-BR')}</h5>
                                        <p class="text-sm text-gray-600">${station ? station.nome_posto : 'Posto n√£o encontrado'}</p>
                                        <p class="text-xs text-blue-600">OS: ${order ? order.numero_os : 'OS n√£o encontrada'}</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-semibold text-orange-800">R$ ${fueling.valor_total.toFixed(2)}</p>
                                        <p class="text-xs text-gray-500">R$ ${pricePerLiter.toFixed(2)}/L</p>
                                    </div>
                                </div>
                                <div class="grid grid-cols-3 gap-4 text-sm">
                                    <div>
                                        <span class="text-gray-500">Litros:</span>
                                        <p class="font-medium">${fueling.litros.toFixed(1)}L</p>
                                    </div>
                                    <div>
                                        <span class="text-gray-500">KM:</span>
                                        <p class="font-medium">${fueling.km_atual.toLocaleString('pt-BR')}</p>
                                    </div>
                                    <div>
                                        <span class="text-gray-500">Cadastrado:</span>
                                        <p class="font-medium">${new Date(fueling.created_at).toLocaleDateString('pt-BR')}</p>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        // Export consumption report
        function exportConsumptionReport(vehicleId) {
            const vehicle = allData.find(item => item.type === 'vehicle' && item.id === vehicleId);
            if (!vehicle) return;

            const startDate = document.getElementById('consumption-start-date').value;
            const endDate = document.getElementById('consumption-end-date').value;

            // Filter fuelings by date range
            let vehicleFuelings = allData.filter(item => 
                item.type === 'fueling' && item.vehicle_id === vehicleId
            );

            if (startDate) {
                vehicleFuelings = vehicleFuelings.filter(f => f.data >= startDate);
            }
            if (endDate) {
                vehicleFuelings = vehicleFuelings.filter(f => f.data <= endDate);
            }

            vehicleFuelings.sort((a, b) => new Date(a.data) - new Date(b.data));

            const orders = allData.filter(item => item.type === 'order');
            const stations = allData.filter(item => item.type === 'station');
            const stats = calculatePeriodConsumption(vehicleFuelings);

            // Prepare export data
            const exportData = [];
            const periodText = startDate && endDate ? 
                `${new Date(startDate).toLocaleDateString('pt-BR')} a ${new Date(endDate).toLocaleDateString('pt-BR')}` :
                'Per√≠odo completo';

            // Header
            exportData.push(['RELAT√ìRIO DE CONSUMO DE COMBUST√çVEL']);
            exportData.push(['']);
            exportData.push(['INFORMA√á√ïES DO VE√çCULO']);
            exportData.push(['C√≥digo:', vehicle.codigo]);
            exportData.push(['Placa:', vehicle.placa]);
            exportData.push(['Marca/Modelo:', `${vehicle.marca} ${vehicle.modelo}`]);
            exportData.push(['Ano:', vehicle.ano || '-']);
            exportData.push(['Combust√≠vel:', vehicle.combustivel || '-']);
            exportData.push(['Per√≠odo:', periodText]);
            exportData.push(['']);

            // Summary
            exportData.push(['RESUMO DO PER√çODO']);
            exportData.push(['Total de Abastecimentos:', stats.totalFuelings]);
            exportData.push(['Total de Litros:', stats.totalLiters.toFixed(2) + 'L']);
            exportData.push(['Custo Total:', 'R$ ' + stats.totalCost.toLocaleString('pt-BR', {minimumFractionDigits: 2})]);
            exportData.push(['KM Rodados:', stats.totalKm.toLocaleString('pt-BR') + ' km']);
            exportData.push(['Consumo M√©dio:', stats.avgConsumption.toFixed(1) + ' km/l']);
            exportData.push(['Custo por KM:', 'R$ ' + stats.costPerKm.toFixed(2)]);
            exportData.push(['Pre√ßo M√©dio por Litro:', 'R$ ' + stats.costPerLiter.toFixed(2)]);
            exportData.push(['']);

            // Monthly analysis
            if (stats.monthlyStats.length > 0) {
                exportData.push(['AN√ÅLISE MENSAL']);
                exportData.push(['M√™s', 'Abastecimentos', 'Litros', 'KM', 'Consumo (km/l)', 'Custo Total', 'Custo/KM']);
                
                stats.monthlyStats.forEach(month => {
                    const [year, monthNum] = month.month.split('-');
                    const monthName = new Date(year, monthNum - 1).toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });
                    
                    exportData.push([
                        monthName,
                        month.fuelings.length,
                        month.totalLiters.toFixed(1) + 'L',
                        month.totalKm.toLocaleString('pt-BR') + ' km',
                        month.avgConsumption.toFixed(1),
                        'R$ ' + month.totalCost.toLocaleString('pt-BR', {minimumFractionDigits: 2}),
                        'R$ ' + month.costPerKm.toFixed(2)
                    ]);
                });
                exportData.push(['']);
            }

            // Detailed history
            exportData.push(['HIST√ìRICO DETALHADO']);
            exportData.push(['Data', 'Posto', 'OS', 'KM', 'Litros', 'Valor Total', 'Pre√ßo/Litro']);
            
            vehicleFuelings.forEach(fueling => {
                const order = orders.find(o => o.id === fueling.order_id);
                const station = stations.find(s => s.id === fueling.station_id);
                const pricePerLiter = fueling.litros > 0 ? fueling.valor_total / fueling.litros : 0;
                
                exportData.push([
                    new Date(fueling.data).toLocaleDateString('pt-BR'),
                    station ? station.nome_posto : 'Posto n√£o encontrado',
                    order ? order.numero_os : 'OS n√£o encontrada',
                    fueling.km_atual.toLocaleString('pt-BR'),
                    fueling.litros.toFixed(2),
                    'R$ ' + fueling.valor_total.toFixed(2),
                    'R$ ' + pricePerLiter.toFixed(2)
                ]);
            });

            // Create and download CSV
            const csvContent = exportData.map(row => 
                row.map(cell => `"${cell}"`).join(',')
            ).join('\n');

            const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', `Relatorio_Consumo_${vehicle.placa}_${periodText.replace(/[^a-zA-Z0-9]/g, '_')}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showToast(`Relat√≥rio de consumo exportado com sucesso!`, 'success');
                console.log('‚úÖ Exporta√ß√£o de consumo conclu√≠da');
            } else {
                showToast('Erro ao exportar relat√≥rio - navegador n√£o suportado', 'error');
            }
        }

        // Set default dates when showing order form
        function setDefaultOrderDates() {
            const today = new Date().toISOString().split('T')[0];
            const dataAberturaField = document.getElementById('dynamic-order-data-abertura');
            if (dataAberturaField) {
                dataAberturaField.value = today;
            }
        }

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9990b1a2f39e6242',t:'MTc2MjIyMzQ3My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
