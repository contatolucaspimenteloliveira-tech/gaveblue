<!doctype html>
<html lang="pt-BR" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WeFrotas - Gest√£o de Frotas</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif;
    }
    
    * {
      box-sizing: border-box;
    }

    /* One UI & iOS Design System */
    .card-modern {
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(20px) saturate(180%);
      border: 0.5px solid rgba(0, 0, 0, 0.06);
      border-radius: 20px;
      box-shadow: 0 2px 16px rgba(0, 0, 0, 0.04);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .card-modern:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
    }

    .glass-header {
      background: rgba(255, 255, 255, 0.72);
      backdrop-filter: blur(40px) saturate(180%);
      border-bottom: 0.5px solid rgba(0, 0, 0, 0.08);
    }

    .tab-active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white !important;
      border-radius: 16px;
      font-weight: 600;
      box-shadow: 0 4px 16px rgba(102, 126, 234, 0.3);
    }

    .tab-button {
      border-radius: 16px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .tab-button:hover:not(.tab-active) {
      background: rgba(102, 126, 234, 0.08);
    }

    .status-aberta {
      background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
      color: white;
      border-radius: 12px;
      padding: 6px 14px;
      font-weight: 600;
      font-size: 11px;
      letter-spacing: 0.5px;
      box-shadow: 0 2px 8px rgba(253, 160, 133, 0.3);
    }

    .status-andamento {
      background: linear-gradient(135deg, #a8edea 0%, #667eea 100%);
      color: white;
      border-radius: 12px;
      padding: 6px 14px;
      font-weight: 600;
      font-size: 11px;
      letter-spacing: 0.5px;
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
    }

    .status-fechada {
      background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
      color: white;
      border-radius: 12px;
      padding: 6px 14px;
      font-weight: 600;
      font-size: 11px;
      letter-spacing: 0.5px;
      box-shadow: 0 2px 8px rgba(132, 250, 176, 0.3);
    }

    .modal-backdrop {
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(12px) saturate(180%);
    }

    .modal-content-wrapper {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(40px) saturate(180%);
      border-radius: 28px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
      border: 0.5px solid rgba(255, 255, 255, 0.6);
    }

    .toast {
      animation: slideIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(40px) saturate(180%);
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
      border: 0.5px solid rgba(0, 0, 0, 0.06);
    }

    @keyframes slideIn {
      from {
        transform: translateX(120%) scale(0.9);
        opacity: 0;
      }
      to {
        transform: translateX(0) scale(1);
        opacity: 1;
      }
    }

    .modern-input {
      background: rgba(245, 247, 250, 0.8);
      border: 1.5px solid rgba(0, 0, 0, 0.06);
      border-radius: 14px;
      padding: 12px 16px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      font-size: 15px;
    }

    .modern-input:focus {
      outline: none;
      background: rgba(255, 255, 255, 0.95);
      border-color: #667eea;
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
    }

    .modern-button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      border-radius: 14px;
      padding: 12px 24px;
      color: white;
      font-weight: 600;
      font-size: 15px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 16px rgba(102, 126, 234, 0.3);
    }

    .modern-button:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.35);
    }

    .modern-button:active {
      transform: translateY(0);
    }

    .modern-button-secondary {
      background: rgba(0, 0, 0, 0.04);
      border: 1.5px solid rgba(0, 0, 0, 0.08);
      border-radius: 14px;
      padding: 12px 24px;
      color: #333;
      font-weight: 600;
      font-size: 15px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .modern-button-secondary:hover {
      background: rgba(0, 0, 0, 0.08);
      transform: translateY(-1px);
    }

    /* Estiliza√ß√£o de campos de data */
    input[type="date"]::-webkit-calendar-picker-indicator {
      cursor: pointer;
      opacity: 0.6;
      transition: opacity 0.3s;
    }

    input[type="date"]::-webkit-calendar-picker-indicator:hover {
      opacity: 1;
    }

    .badge-new {
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
      color: white;
      font-size: 10px;
      padding: 4px 10px;
      border-radius: 12px;
      font-weight: 700;
      margin-left: 6px;
      box-shadow: 0 2px 8px rgba(255, 107, 107, 0.3);
      letter-spacing: 0.5px;
    }

    .badge-numero-os {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      font-size: 12px;
      padding: 6px 14px;
      border-radius: 12px;
      font-weight: 700;
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
      letter-spacing: 0.5px;
    }

    .modern-checkbox {
      width: 20px;
      height: 20px;
      border-radius: 7px;
      border: 2px solid #667eea;
      appearance: none;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
    }

    .modern-checkbox:checked {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-color: #667eea;
    }

    .modern-checkbox:checked::after {
      content: "‚úì";
      position: absolute;
      color: white;
      font-size: 14px;
      font-weight: bold;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    .loading-spinner {
      border: 3px solid rgba(102, 126, 234, 0.2);
      border-top: 3px solid #667eea;
      border-radius: 50%;
      width: 1.5rem;
      height: 1.5rem;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .tab-content {
      display: none;
      animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .tab-content.active {
      display: block;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .icon-circle {
      width: 56px;
      height: 56px;
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .card-modern:hover .icon-circle {
      transform: scale(1.05);
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%);
    }

    .gradient-text {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-weight: 700;
    }

    .summary-card {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(20px) saturate(180%);
      border: 0.5px solid rgba(0, 0, 0, 0.06);
      border-radius: 18px;
      padding: 20px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .summary-card:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
    }

    /* Scrollbar Styling */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.02);
    }

    ::-webkit-scrollbar-thumb {
      background: rgba(102, 126, 234, 0.3);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: rgba(102, 126, 234, 0.5);
    }

    /* Dark Mode Styles */
    body.dark-mode {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%) !important;
    }

    body.dark-mode .card-modern {
      background: rgba(30, 30, 46, 0.85);
      border: 0.5px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 2px 16px rgba(0, 0, 0, 0.3);
    }

    body.dark-mode .card-modern:hover {
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.5);
    }

    body.dark-mode .glass-header {
      background: rgba(30, 30, 46, 0.85);
      backdrop-filter: blur(40px) saturate(180%);
      border-bottom: 0.5px solid rgba(255, 255, 255, 0.1);
    }

    body.dark-mode .modern-input {
      background: rgba(50, 50, 70, 0.8);
      border: 1.5px solid rgba(255, 255, 255, 0.1);
      color: #e0e0e0;
    }

    body.dark-mode .modern-input:focus {
      background: rgba(60, 60, 80, 0.95);
      border-color: #667eea;
      color: #ffffff;
    }

    body.dark-mode .modern-input::placeholder {
      color: rgba(255, 255, 255, 0.4);
    }

    body.dark-mode .modern-button-secondary {
      background: rgba(255, 255, 255, 0.08);
      border: 1.5px solid rgba(255, 255, 255, 0.15);
      color: #e0e0e0;
    }

    body.dark-mode .modern-button-secondary:hover {
      background: rgba(255, 255, 255, 0.12);
    }

    body.dark-mode .modal-backdrop {
      background: rgba(0, 0, 0, 0.8);
    }

    body.dark-mode .modal-content-wrapper {
      background: rgba(30, 30, 46, 0.98);
      border: 0.5px solid rgba(255, 255, 255, 0.15);
    }

    body.dark-mode .summary-card {
      background: rgba(40, 40, 60, 0.9);
      border: 0.5px solid rgba(255, 255, 255, 0.1);
    }

    body.dark-mode .toast {
      background: rgba(30, 30, 46, 0.98);
      border: 0.5px solid rgba(255, 255, 255, 0.1);
    }

    body.dark-mode .text-gray-900 {
      color: #e0e0e0 !important;
    }

    body.dark-mode .text-gray-800 {
      color: #d0d0d0 !important;
    }

    body.dark-mode .text-gray-700 {
      color: #b0b0b0 !important;
    }

    body.dark-mode .text-gray-600 {
      color: #a0a0a0 !important;
    }

    body.dark-mode .text-gray-500 {
      color: #909090 !important;
    }

    body.dark-mode .text-gray-400 {
      color: #808080 !important;
    }

    body.dark-mode ::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
    }

    body.dark-mode ::-webkit-scrollbar-thumb {
      background: rgba(102, 126, 234, 0.5);
    }

    body.dark-mode ::-webkit-scrollbar-thumb:hover {
      background: rgba(102, 126, 234, 0.7);
    }

    .dark-mode-toggle {
      width: 60px;
      height: 32px;
      background: rgba(0, 0, 0, 0.1);
      border-radius: 16px;
      position: relative;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: 1.5px solid rgba(0, 0, 0, 0.1);
    }

    .dark-mode-toggle.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-color: #667eea;
    }

    .dark-mode-toggle-circle {
      width: 24px;
      height: 24px;
      background: white;
      border-radius: 50%;
      position: absolute;
      top: 3px;
      left: 3px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    .dark-mode-toggle.active .dark-mode-toggle-circle {
      left: 31px;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full" style="background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);">
  <div id="app-container" class="h-full w-full flex flex-col overflow-auto"><!-- Header -->
   <header class="glass-header px-6 py-5 sticky top-0 z-40">
    <div class="flex items-center justify-between">
     <div>
      <h1 id="app-title" class="text-3xl font-bold gradient-text">WeFrotas</h1>
      <p id="company-name" class="text-sm text-gray-600 font-medium mt-1">Gest√£o de Frotas</p>
     </div>
    </div>
   </header><!-- Toast Container (Fixed Position) -->
   <div id="header-toast-container" class="fixed top-6 right-6 z-50 flex flex-col items-end gap-3 pointer-events-none">
    <style>
        #header-toast-container .toast {
          pointer-events: auto;
        }
      </style>
   </div><!-- Nav Tabs -->
   <nav class="glass-header px-6 py-3 sticky top-[88px] z-30 overflow-x-auto">
    <div class="flex gap-2 items-center"><button class="tab-button w-12 h-12 flex items-center justify-center transition-all tab-active" onclick="showTab('dashboard')" title="Dashboard">
      <svg width="22" height="22" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"></rect> <rect x="14" y="3" width="7" height="7"></rect> <rect x="14" y="14" width="7" height="7"></rect> <rect x="3" y="14" width="7" height="7"></rect>
      </svg></button> <button class="tab-button w-12 h-12 flex items-center justify-center transition-all" onclick="showTab('contas')" title="Contas a Pagar">
      <svg width="22" height="22" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="20" x2="12" y2="10"></line> <line x1="18" y1="20" x2="18" y2="4"></line> <line x1="6" y1="20" x2="6" y2="16"></line>
      </svg></button> <button class="tab-button w-12 h-12 flex items-center justify-center transition-all" onclick="showTab('orders')" title="Ordens de Servi√ßo">
      <svg width="22" height="22" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" /> <polyline points="14 2 14 8 20 8"></polyline> <line x1="9" y1="15" x2="15" y2="15"></line> <line x1="9" y1="18" x2="15" y2="18"></line> <line x1="9" y1="12" x2="12" y2="12"></line>
      </svg></button> <button class="tab-button w-12 h-12 flex items-center justify-center transition-all" onclick="showTab('lancamentos')" title="Lan√ßamentos">
      <svg width="22" height="22" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"></line> <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" />
      </svg></button>
     <div class="w-px h-8 bg-gray-300 mx-1"></div><button class="tab-button w-12 h-12 flex items-center justify-center transition-all" onclick="showTab('veiculos')" title="Ve√≠culos">
      <svg width="22" height="22" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="1" y="3" width="15" height="13"></rect> <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon> <circle cx="5.5" cy="18.5" r="2.5"></circle> <circle cx="18.5" cy="18.5" r="2.5"></circle>
      </svg></button> <button class="tab-button w-12 h-12 flex items-center justify-center transition-all" onclick="showTab('motoristas')" title="Motoristas">
      <svg width="22" height="22" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" /> <circle cx="12" cy="7" r="4"></circle>
      </svg></button> <button class="tab-button w-12 h-12 flex items-center justify-center transition-all" onclick="showTab('fornecedores')" title="Fornecedores">
      <svg width="22" height="22" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect> <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16" />
      </svg></button> <button class="tab-button w-12 h-12 flex items-center justify-center transition-all" onclick="toggleDarkMode()" id="dark-mode-btn" title="Alternar Modo Escuro/Claro">
      <svg width="22" height="22" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
      </svg></button> <button class="tab-button w-12 h-12 flex items-center justify-center transition-all" onclick="openHelpModal()" title="Ajuda">
      <svg width="22" height="22" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle> <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" /> <line x1="12" y1="17" x2="12.01" y2="17"></line>
      </svg></button> <button class="tab-button w-12 h-12 flex items-center justify-center transition-all" onclick="window.open('https://gaveblue.com', '_blank')" title="Sair">
      <svg width="22" height="22" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" /> <polyline points="16 17 21 12 16 7"></polyline> <line x1="21" y1="12" x2="9" y2="12"></line>
      </svg></button>
    </div>
   </nav><!-- Main Content -->
   <main class="flex-1 p-6 overflow-auto"><!-- Dashboard Content -->
    <div id="dashboard-content" class="tab-content active">
     <div class="space-y-6"><!-- Main Stats -->
      <div class="grid grid-cols-1 md:grid-cols-5 gap-6">
       <div class="summary-card">
        <div class="icon-circle mx-auto mb-4">
         üöó
        </div>
        <div class="text-xs text-gray-500 font-bold uppercase tracking-wide text-center">
         Ve√≠culos
        </div>
        <div id="dashboard-veiculos" class="text-4xl font-bold gradient-text text-center mt-2">
         0
        </div>
       </div>
       <div class="summary-card">
        <div class="icon-circle mx-auto mb-4">
         üë§
        </div>
        <div class="text-xs text-gray-500 font-bold uppercase tracking-wide text-center">
         Motoristas
        </div>
        <div id="dashboard-motoristas" class="text-4xl font-bold gradient-text text-center mt-2">
         0
        </div>
       </div>
       <div class="summary-card">
        <div class="icon-circle mx-auto mb-4">
         üè¢
        </div>
        <div class="text-xs text-gray-500 font-bold uppercase tracking-wide text-center">
         Fornecedores
        </div>
        <div id="dashboard-fornecedores" class="text-4xl font-bold gradient-text text-center mt-2">
         0
        </div>
       </div>
       <div class="summary-card">
        <div class="icon-circle mx-auto mb-4">
         üìã
        </div>
        <div class="text-xs text-gray-500 font-bold uppercase tracking-wide text-center">
         Ordens Abertas
        </div>
        <div id="dashboard-ordens" class="text-4xl font-bold gradient-text text-center mt-2">
         0
        </div>
       </div>
       <div class="summary-card">
        <div class="icon-circle mx-auto mb-4">
         üí∞
        </div>
        <div class="text-xs text-gray-500 font-bold uppercase tracking-wide text-center">
         Contas Pendentes
        </div>
        <div id="dashboard-contas" class="text-4xl font-bold gradient-text text-center mt-2">
         0
        </div>
       </div>
      </div><!-- Financial Summary -->
      <div class="card-modern p-8">
       <h3 class="text-2xl font-bold text-gray-900 mb-6">Resumo Financeiro</h3>
       <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="summary-card" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(220, 38, 38, 0.1) 100%); border: 1.5px solid rgba(239, 68, 68, 0.2);">
         <div class="text-sm text-red-700 font-bold uppercase tracking-wide">
          Total a Pagar
         </div>
         <div id="dashboard-total-pagar" class="text-3xl font-bold text-red-700 mt-3">
          R$ 0,00
         </div>
        </div>
        <div class="summary-card" style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(217, 119, 6, 0.1) 100%); border: 1.5px solid rgba(245, 158, 11, 0.2);">
         <div class="text-sm text-yellow-700 font-bold uppercase tracking-wide">
          Contas Vencidas
         </div>
         <div id="dashboard-vencidas" class="text-3xl font-bold text-yellow-700 mt-3">
          R$ 0,00
         </div>
        </div>
        <div class="summary-card" style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, rgba(22, 163, 74, 0.1) 100%); border: 1.5px solid rgba(34, 197, 94, 0.2);">
         <div class="text-sm text-green-700 font-bold uppercase tracking-wide">
          Total Pago
         </div>
         <div id="dashboard-pago" class="text-3xl font-bold text-green-700 mt-3">
          R$ 0,00
         </div>
        </div>
       </div>
      </div><!-- Recent Activity -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6"><!-- Recent Orders -->
       <div class="card-modern p-8">
        <h3 class="text-xl font-bold text-gray-900 mb-5">√öltimas Ordens de Servi√ßo</h3>
        <div id="dashboard-recent-orders" class="space-y-3">
         <div class="text-center py-8 text-gray-500 text-sm">
          Nenhuma ordem registrada
         </div>
        </div>
       </div><!-- Recent Lancamentos -->
       <div class="card-modern p-8">
        <h3 class="text-xl font-bold text-gray-900 mb-5">√öltimos Lan√ßamentos</h3>
        <div id="dashboard-recent-lancamentos" class="space-y-3">
         <div class="text-center py-8 text-gray-500 text-sm">
          Nenhum lan√ßamento registrado
         </div>
        </div>
       </div>
      </div>
     </div>
    </div><!-- Ve√≠culos Content -->
    <div id="veiculos-content" class="tab-content">
     <div class="card-modern p-8">
      <div class="flex items-center justify-between mb-8">
       <h2 class="text-2xl font-bold text-gray-900">Lista de Ve√≠culos</h2>
      </div><!-- Selection Info -->
      <div id="vehicles-selection-info" class="mb-6 flex items-center justify-between px-2">
       <div class="flex items-center gap-3"><input type="checkbox" id="select-all-vehicles" class="modern-checkbox" onchange="toggleSelectAllVehicles()" title="Selecionar Todos"> <span id="vehicles-selected-count" class="text-sm font-semibold text-gray-700">0 selecionados</span>
       </div>
       <div class="flex items-center gap-3"><button onclick="showCadastroForm('vehicle')" class="w-10 h-10 flex items-center justify-center rounded-xl text-purple-600 hover:bg-purple-50 transition-all" title="Novo Ve√≠culo">
         <svg width="20" height="20" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line> <line x1="5" y1="12" x2="19" y2="12"></line>
         </svg></button> <button onclick="editSelectedVehicle()" id="btn-edit-vehicle" class="w-10 h-10 flex items-center justify-center rounded-xl text-blue-600 hover:bg-blue-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all" disabled title="Editar Ve√≠culo">
         <svg width="20" height="20" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" /> <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
         </svg></button> <button onclick="deleteSelectedVehicles()" id="btn-delete-vehicles" class="w-10 h-10 flex items-center justify-center rounded-xl text-red-600 hover:bg-red-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all" disabled title="Excluir Selecionados">
         <svg width="20" height="20" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline> <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
         </svg></button>
       </div>
      </div>
      <div id="vehicles-list" class="space-y-4">
       <div class="text-center py-16 text-gray-500">
        Nenhum ve√≠culo cadastrado. Clique no bot√£o + para come√ßar.
       </div>
      </div>
     </div>
    </div><!-- Motoristas Content -->
    <div id="motoristas-content" class="tab-content">
     <div class="card-modern p-8">
      <div class="flex items-center justify-between mb-8">
       <h2 class="text-2xl font-bold text-gray-900">Lista de Motoristas</h2>
      </div><!-- Selection Info -->
      <div id="drivers-selection-info" class="mb-6 flex items-center justify-between px-2">
       <div class="flex items-center gap-3"><input type="checkbox" id="select-all-drivers" class="modern-checkbox" onchange="toggleSelectAllDrivers()" title="Selecionar Todos"> <span id="drivers-selected-count" class="text-sm font-semibold text-gray-700">0 selecionados</span>
       </div>
       <div class="flex items-center gap-3"><button onclick="showCadastroForm('driver')" class="w-10 h-10 flex items-center justify-center rounded-xl text-purple-600 hover:bg-purple-50 transition-all" title="Novo Motorista">
         <svg width="20" height="20" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line> <line x1="5" y1="12" x2="19" y2="12"></line>
         </svg></button> <button onclick="editSelectedDriver()" id="btn-edit-driver" class="w-10 h-10 flex items-center justify-center rounded-xl text-blue-600 hover:bg-blue-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all" disabled title="Editar Motorista">
         <svg width="20" height="20" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" /> <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
         </svg></button> <button onclick="deleteSelectedDrivers()" id="btn-delete-drivers" class="w-10 h-10 flex items-center justify-center rounded-xl text-red-600 hover:bg-red-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all" disabled title="Excluir Selecionados">
         <svg width="20" height="20" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline> <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
         </svg></button>
       </div>
      </div>
      <div id="drivers-list" class="space-y-4">
       <div class="text-center py-16 text-gray-500">
        Nenhum motorista cadastrado. Clique no bot√£o + para come√ßar.
       </div>
      </div>
     </div>
    </div><!-- Orders Content -->
    <div id="orders-content" class="tab-content">
     <div class="card-modern p-8">
      <div class="flex items-center justify-between mb-8">
       <h2 class="text-2xl font-bold text-gray-900">Ordens de Servi√ßo</h2>
      </div><!-- Filtros OS -->
      <div class="mb-6 card-modern p-5" style="background: rgba(255, 255, 255, 0.6);">
       <div class="flex flex-wrap gap-3 items-end">
        <div class="flex-1 min-w-[120px]"><label class="block text-xs font-semibold text-gray-700 mb-2 uppercase tracking-wide">N¬∫ da OS</label> <input type="text" id="filter-order-numero" class="modern-input w-full" placeholder="Ex: 0001">
        </div>
        <div class="flex-1 min-w-[150px]"><label class="block text-xs font-semibold text-gray-700 mb-2 uppercase tracking-wide">Data Inicial</label> <input type="date" id="filter-order-start-date" class="modern-input w-full">
        </div>
        <div class="flex-1 min-w-[150px]"><label class="block text-xs font-semibold text-gray-700 mb-2 uppercase tracking-wide">Data Final</label> <input type="date" id="filter-order-end-date" class="modern-input w-full">
        </div>
        <div class="flex-1 min-w-[150px]"><label class="block text-xs font-semibold text-gray-700 mb-2 uppercase tracking-wide">Status</label> <select id="filter-order-status" class="modern-input w-full"> <option value="">Todos os Status</option> <option value="aberta">Aberta</option> <option value="andamento">Em Andamento</option> <option value="fechada">Fechada</option> </select>
        </div>
        <div class="flex-1 min-w-[150px]"><label class="block text-xs font-semibold text-gray-700 mb-2 uppercase tracking-wide">Ordena√ß√£o</label> <select id="order-sort" class="modern-input w-full"> <option value="newest">Mais Recentes</option> <option value="oldest">Mais Antigas</option> </select>
        </div><button onclick="applyOrderFilters()" class="modern-button w-12 h-12 flex items-center justify-center p-0" title="Aplicar Filtros">
         <svg width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
         </svg></button> <button onclick="clearOrderFilters()" class="modern-button-secondary w-12 h-12 flex items-center justify-center p-0" title="Limpar Filtros">
         <svg width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line> <line x1="6" y1="6" x2="18" y2="18"></line>
         </svg></button>
       </div>
      </div><!-- Selection Info -->
      <div id="selection-info" class="mb-6 flex items-center justify-between px-2">
       <div class="flex items-center gap-3"><input type="checkbox" id="select-all-orders" class="modern-checkbox" onchange="toggleSelectAllOrders()" title="Selecionar Todas"> <span id="orders-selected-count" class="text-sm font-semibold text-gray-700">0 selecionadas</span>
       </div>
       <div class="flex items-center gap-3"><button onclick="showCadastroForm('order')" class="w-10 h-10 flex items-center justify-center rounded-xl text-purple-600 hover:bg-purple-50 transition-all" title="Nova Ordem de Servi√ßo">
         <svg width="20" height="20" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line> <line x1="5" y1="12" x2="19" y2="12"></line>
         </svg></button> <button onclick="editSelectedOrder()" id="btn-edit-selected" class="w-10 h-10 flex items-center justify-center rounded-xl text-blue-600 hover:bg-blue-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all" disabled title="Editar Ordem Selecionada">
         <svg width="20" height="20" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" /> <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
         </svg></button> <button onclick="printSelectedOrder()" id="btn-print-selected" class="w-10 h-10 flex items-center justify-center rounded-xl text-purple-600 hover:bg-purple-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all" disabled title="Imprimir OS">
         <svg width="20" height="20" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 6 2 18 2 18 9"></polyline> <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2" /> <rect x="6" y="14" width="12" height="8"></rect>
         </svg></button> <button onclick="exportSelectedOrder()" class="w-10 h-10 flex items-center justify-center rounded-xl text-green-600 hover:bg-green-50 transition-all" title="Exportar">
         <svg width="20" height="20" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /> <polyline points="7 10 12 15 17 10"></polyline> <line x1="12" y1="15" x2="12" y2="3"></line>
         </svg></button> <button onclick="deleteSelectedOrders()" id="btn-delete-selected" class="w-10 h-10 flex items-center justify-center rounded-xl text-red-600 hover:bg-red-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all" disabled title="Excluir Selecionadas">
         <svg width="20" height="20" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline> <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
         </svg></button>
       </div>
      </div>
      <div id="orders-list" class="space-y-4">
       <div class="text-center py-16 text-gray-500">
        Nenhuma ordem de servi√ßo cadastrada.
       </div>
      </div>
     </div>
    </div><!-- Lan√ßamentos Content -->
    <div id="lancamentos-content" class="tab-content">
     <div class="card-modern p-8">
      <h2 class="text-2xl font-bold text-gray-900 mb-8">Central de Lan√ßamentos</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8"><!-- Abastecimento Card -->
       <div class="card-modern p-6 hover:shadow-2xl transition-all cursor-pointer" style="background: linear-gradient(135deg, rgba(132, 250, 176, 0.1) 0%, rgba(143, 211, 244, 0.1) 100%);" onclick="showLancamentoPopup('fueling')">
        <div class="flex items-center gap-4 mb-4">
         <div class="icon-circle">
          ‚õΩ
         </div>
         <div>
          <h3 class="text-lg font-bold text-gray-900">Abastecimento</h3>
          <p class="text-sm text-gray-600 font-medium">Registrar abastecimento de ve√≠culo</p>
         </div>
        </div><button class="w-12 h-12 modern-button flex items-center justify-center p-0 ml-auto" style="background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);" title="Novo Abastecimento">
         <svg width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line> <line x1="5" y1="12" x2="19" y2="12"></line>
         </svg></button>
       </div><!-- Despesa Card -->
       <div class="card-modern p-6 hover:shadow-2xl transition-all cursor-pointer" style="background: linear-gradient(135deg, rgba(246, 211, 101, 0.1) 0%, rgba(253, 160, 133, 0.1) 100%);" onclick="showLancamentoPopup('expense')">
        <div class="flex items-center gap-4 mb-4">
         <div class="icon-circle">
          üí∏
         </div>
         <div>
          <h3 class="text-lg font-bold text-gray-900">Despesa</h3>
          <p class="text-sm text-gray-600 font-medium">Registrar despesa da frota</p>
         </div>
        </div><button class="w-12 h-12 modern-button flex items-center justify-center p-0 ml-auto" style="background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);" title="Nova Despesa">
         <svg width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line> <line x1="5" y1="12" x2="19" y2="12"></line>
         </svg></button>
       </div>
      </div>
      <h3 class="text-xl font-bold text-gray-900 mb-5">Todos os Lan√ßamentos</h3>
      <div id="all-lancamentos-list" class="space-y-4">
       <div class="text-center py-16 text-gray-500">
        Nenhum lan√ßamento registrado.
       </div>
      </div>
     </div>
    </div><!-- Contas Content -->
    <div id="contas-content" class="tab-content">
     <div class="card-modern p-8">
      <div class="flex items-center justify-between mb-8">
       <h2 class="text-2xl font-bold text-gray-900">Contas a Pagar</h2>
       <div class="flex gap-3"><button onclick="showNovoLancamentoMenu()" class="modern-button w-12 h-12 flex items-center justify-center p-0" title="Novo Lan√ßamento">
         <svg width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line> <line x1="5" y1="12" x2="19" y2="12"></line>
         </svg></button> <button onclick="exportContas()" class="modern-button-secondary w-12 h-12 flex items-center justify-center p-0" title="Exportar Contas">
         <svg width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /> <polyline points="7 10 12 15 17 10"></polyline> <line x1="12" y1="15" x2="12" y2="3"></line>
         </svg></button>
       </div>
      </div><!-- Filtros Contas -->
      <div class="mb-6 card-modern p-5" style="background: rgba(255, 255, 255, 0.6);">
       <div class="flex flex-wrap gap-3 items-end">
        <div class="flex-1 min-w-[150px]"><label class="block text-xs font-semibold text-gray-700 mb-2 uppercase tracking-wide">Status</label> <select id="filter-contas-status" class="modern-input w-full"> <option value="">Todas as Contas</option> <option value="pendente">Pendentes</option> <option value="pago">Pagas</option> <option value="vencidas">Vencidas</option> </select>
        </div>
        <div class="flex-1 min-w-[150px]"><label class="block text-xs font-semibold text-gray-700 mb-2 uppercase tracking-wide">Vencimento Inicial</label> <input type="date" id="filter-contas-start-date" class="modern-input w-full">
        </div>
        <div class="flex-1 min-w-[150px]"><label class="block text-xs font-semibold text-gray-700 mb-2 uppercase tracking-wide">Vencimento Final</label> <input type="date" id="filter-contas-end-date" class="modern-input w-full">
        </div><button onclick="applyContasFilters()" class="modern-button w-12 h-12 flex items-center justify-center p-0" title="Aplicar Filtros">
         <svg width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
         </svg></button> <button onclick="clearContasFilters()" class="modern-button-secondary w-12 h-12 flex items-center justify-center p-0" title="Limpar Filtros">
         <svg width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line> <line x1="6" y1="6" x2="18" y2="18"></line>
         </svg></button>
       </div>
      </div><!-- Contas Selection Info -->
      <div id="contas-selection-info" class="mb-6 flex items-center justify-between px-2">
       <div class="flex items-center gap-3"><span id="contas-selected-count" class="text-sm font-semibold text-gray-700">0 selecionadas</span> <span id="contas-selected-total" class="text-sm font-bold gradient-text">R$ 0,00</span>
       </div>
       <div class="flex items-center gap-3"><button onclick="editSelectedConta()" id="btn-edit-conta" class="w-10 h-10 flex items-center justify-center rounded-xl text-blue-600 hover:bg-blue-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all" disabled title="Editar Conta">
         <svg width="20" height="20" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" /> <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
         </svg></button> <button onclick="deleteSelectedContas()" id="btn-delete-conta" class="w-10 h-10 flex items-center justify-center rounded-xl text-red-600 hover:bg-red-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all" disabled title="Excluir Selecionadas">
         <svg width="20" height="20" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline> <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
         </svg></button> <button onclick="agruparContas()" id="btn-agrupar-conta" class="w-10 h-10 flex items-center justify-center rounded-xl text-purple-600 hover:bg-purple-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all" disabled title="Agrupar em Uma Conta">
         <svg width="20" height="20" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" /> <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline> <line x1="12" y1="22.08" x2="12" y2="12"></line>
         </svg></button> <button onclick="paySelectedContas()" id="btn-pay-selected" class="w-10 h-10 flex items-center justify-center rounded-xl text-green-600 hover:bg-green-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all" disabled title="Dar Baixa">
         <svg width="20" height="20" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline>
         </svg></button> <button onclick="renegociarConta()" id="btn-renegociar" class="w-10 h-10 flex items-center justify-center rounded-xl text-orange-600 hover:bg-orange-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all" disabled title="Renegociar Vencimento">
         <svg width="20" height="20" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2" />
         </svg></button>
       </div>
      </div>
      <div id="contas-list" class="space-y-4">
       <div class="text-center py-16 text-gray-500">
        Nenhuma conta cadastrada.
       </div>
      </div>
     </div>
    </div><!-- Fornecedores Content -->
    <div id="fornecedores-content" class="tab-content">
     <div class="card-modern p-8">
      <div class="flex items-center justify-between mb-8">
       <h2 class="text-2xl font-bold text-gray-900">Lista de Fornecedores</h2>
      </div><!-- Selection Info -->
      <div id="suppliers-selection-info" class="mb-6 flex items-center justify-between px-2">
       <div class="flex items-center gap-3"><input type="checkbox" id="select-all-suppliers" class="modern-checkbox" onchange="toggleSelectAllSuppliers()" title="Selecionar Todos"> <span id="suppliers-selected-count" class="text-sm font-semibold text-gray-700">0 selecionados</span>
       </div>
       <div class="flex items-center gap-3"><button onclick="showCadastroForm('supplier')" class="w-10 h-10 flex items-center justify-center rounded-xl text-purple-600 hover:bg-purple-50 transition-all" title="Novo Fornecedor">
         <svg width="20" height="20" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line> <line x1="5" y1="12" x2="19" y2="12"></line>
         </svg></button> <button onclick="editSelectedSupplier()" id="btn-edit-supplier" class="w-10 h-10 flex items-center justify-center rounded-xl text-blue-600 hover:bg-blue-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all" disabled title="Editar Fornecedor">
         <svg width="20" height="20" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" /> <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
         </svg></button> <button onclick="deleteSelectedSuppliers()" id="btn-delete-suppliers" class="w-10 h-10 flex items-center justify-center rounded-xl text-red-600 hover:bg-red-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all" disabled title="Excluir Selecionados">
         <svg width="20" height="20" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline> <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
         </svg></button>
       </div>
      </div>
      <div id="fornecedores-list" class="space-y-4">
       <div class="text-center py-16 text-gray-500">
        Nenhum fornecedor cadastrado. Clique no bot√£o + para come√ßar.
       </div>
      </div>
     </div>
    </div>
   </main><!-- Modal Overlay -->
   <div id="modal-overlay" class="fixed inset-0 z-50 hidden items-center justify-center modal-backdrop">
    <div class="modal-content-wrapper max-w-2xl w-full mx-6 max-h-[90%] overflow-auto">
     <div class="sticky top-0 glass-header px-8 py-5 flex items-center justify-between">
      <h3 id="modal-title" class="text-xl font-bold gradient-text"></h3><button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 text-3xl leading-none transition-all hover:rotate-90" style="transition: transform 0.3s;">√ó</button>
     </div>
     <div id="modal-content" class="p-8"></div>
    </div>
   </div>
  </div>
  <script>
    // Global State
    let allData = [];
    let selectedOrders = new Set();
    let selectedContas = new Set();
    let selectedLancamentos = new Set();
    let selectedVehicles = new Set();
    let selectedDrivers = new Set();
    let selectedSuppliers = new Set();
    let currentEditingRecord = null;

    // LocalStorage Helper Functions
    function saveToLocalStorage() {
      localStorage.setItem('wefrotas_data', JSON.stringify(allData));
    }

    function loadFromLocalStorage() {
      const saved = localStorage.getItem('wefrotas_data');
      if (saved) {
        try {
          allData = JSON.parse(saved);
        } catch (e) {
          allData = [];
        }
      }
    }

    function generateId() {
      return `${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
    }

    const defaultConfig = {
      app_title: "WeFrotas",
      company_name: "Gest√£o de Frotas",
      dark_mode: false
    };

    // Form Configurations
    const formConfigs = {
      vehicle: `
        <form id="dynamic-form" class="space-y-5">
          <div class="grid grid-cols-2 gap-5">
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Placa*</label>
              <input type="text" id="dynamic-vehicle-placa" required class="modern-input w-full" placeholder="ABC-1234">
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Modelo*</label>
              <input type="text" id="dynamic-vehicle-modelo" required class="modern-input w-full" placeholder="Fiat Uno">
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Ano*</label>
              <input type="number" id="dynamic-vehicle-ano" required class="modern-input w-full" placeholder="2020">
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Cor*</label>
              <input type="text" id="dynamic-vehicle-cor" required class="modern-input w-full" placeholder="Branco">
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Chassi</label>
              <input type="text" id="dynamic-vehicle-chassi" class="modern-input w-full" placeholder="9BWZZZ377VT004251">
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">RENAVAM</label>
              <input type="text" id="dynamic-vehicle-renavam" class="modern-input w-full" placeholder="00000000000">
            </div>
          </div>
          <div class="flex justify-end gap-3 mt-8 pt-4 border-t border-gray-200">
            <button type="button" onclick="closeModal()" class="modern-button-secondary">
              Cancelar
            </button>
            <button type="submit" class="modern-button flex items-center gap-2">
              <span id="submit-text">Salvar</span>
              <div id="submit-loading" class="hidden loading-spinner"></div>
            </button>
          </div>
        </form>
      `,
      driver: `
        <form id="dynamic-form" class="space-y-5">
          <div class="grid grid-cols-2 gap-5">
            <div class="col-span-2">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Nome Completo*</label>
              <input type="text" id="dynamic-driver-nome" required class="modern-input w-full" placeholder="Jo√£o Silva">
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">CPF*</label>
              <input type="text" id="dynamic-driver-cpf" required class="modern-input w-full" placeholder="000.000.000-00">
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">CNH*</label>
              <input type="text" id="dynamic-driver-cnh" required class="modern-input w-full" placeholder="00000000000">
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Categoria CNH*</label>
              <select id="dynamic-driver-categoria_cnh" required class="modern-input w-full">
                <option value="">Selecione</option>
                <option value="A">A - Motocicletas</option>
                <option value="B">B - Ve√≠culos at√© 3.500kg</option>
                <option value="AB">AB - Moto + Carro</option>
                <option value="C">C - Ve√≠culos acima de 3.500kg</option>
                <option value="D">D - Transporte de Passageiros</option>
                <option value="E">E - Ve√≠culos com reboque</option>
                <option value="AC">AC - A + C</option>
                <option value="AD">AD - A + D</option>
                <option value="AE">AE - A + E</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Telefone*</label>
              <input type="tel" id="dynamic-driver-telefone" required class="modern-input w-full" placeholder="(00) 00000-0000">
            </div>
            <div class="col-span-2">
              <label class="block text-sm font-semibold text-gray-700 mb-2">E-mail</label>
              <input type="email" id="dynamic-driver-email" class="modern-input w-full" placeholder="joao@email.com">
            </div>
          </div>
          <div class="flex justify-end gap-3 mt-8 pt-4 border-t border-gray-200">
            <button type="button" onclick="closeModal()" class="modern-button-secondary">
              Cancelar
            </button>
            <button type="submit" class="modern-button flex items-center gap-2">
              <span id="submit-text">Salvar</span>
              <div id="submit-loading" class="hidden loading-spinner"></div>
            </button>
          </div>
        </form>
      `,
      order: `
        <form id="dynamic-form" class="space-y-5">
          <div class="grid grid-cols-2 gap-5">
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">VeÔøΩÔøΩculo</label>
              <select id="dynamic-order-veiculo_id" class="modern-input w-full">
                <option value="">Selecione um ve√≠culo</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Motorista</label>
              <select id="dynamic-order-motorista_id" class="modern-input w-full">
                <option value="">Selecione um motorista</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Data Abertura*</label>
              <input type="date" id="dynamic-order-data_abertura" required class="modern-input w-full">
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Data Fechamento</label>
              <input type="date" id="dynamic-order-data_fechamento" class="modern-input w-full">
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Status*</label>
              <select id="dynamic-order-status" required class="modern-input w-full">
                <option value="aberta">Aberta</option>
                <option value="andamento">Em Andamento</option>
                <option value="fechada">Fechada</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">KM</label>
              <input type="number" id="dynamic-order-km" class="modern-input w-full" placeholder="0">
            </div>
            <div class="col-span-2">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Descri√ß√£o*</label>
              <textarea id="dynamic-order-descricao" required rows="3" class="modern-input w-full" placeholder="Descreva o servi√ßo..."></textarea>
            </div>
          </div>
          <div class="flex justify-end gap-3 mt-8 pt-4 border-t border-gray-200">
            <button type="button" onclick="closeModal()" class="modern-button-secondary">
              Cancelar
            </button>
            <button type="submit" class="modern-button flex items-center gap-2">
              <span id="submit-text">Salvar</span>
              <div id="submit-loading" class="hidden loading-spinner"></div>
            </button>
          </div>
        </form>
      `,
      supplier: `
        <form id="dynamic-form" class="space-y-5">
          <div class="grid grid-cols-2 gap-5">
            <div class="col-span-2">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Raz√£o Social*</label>
              <input type="text" id="dynamic-supplier-razao_social" required class="modern-input w-full" placeholder="Empresa LTDA">
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Categoria*</label>
              <select id="dynamic-supplier-categoria" required class="modern-input w-full">
                <option value="">Selecione</option>
                <option value="posto">Posto de Gasolina</option>
                <option value="oficina">Oficina Mec√¢nica</option>
                <option value="borracharia">Borracharia</option>
                <option value="concessionaria">Concession√°ria</option>
                <option value="autoeletrica">Auto El√©trica</option>
                <option value="funilaria">Funilaria e Pintura</option>
                <option value="lavagem">Lavagem e Est√©tica</option>
                <option value="pecas">Loja de Pe√ßas</option>
                <option value="seguros">Seguradora</option>
                <option value="outros">Outros</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">CNPJ*</label>
              <input type="text" id="dynamic-supplier-cnpj" required class="modern-input w-full" placeholder="00.000.000/0000-00">
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Telefone</label>
              <input type="tel" id="dynamic-supplier-telefone" class="modern-input w-full" placeholder="(00) 0000-0000">
            </div>
            <div class="col-span-2">
              <label class="block text-sm font-semibold text-gray-700 mb-2">E-mail</label>
              <input type="email" id="dynamic-supplier-email" class="modern-input w-full" placeholder="contato@empresa.com">
            </div>
            <div class="col-span-2">
              <label class="block text-sm font-semibold text-gray-700 mb-2">EndereÔøΩÔøΩo</label>
              <input type="text" id="dynamic-supplier-endereco" class="modern-input w-full" placeholder="Rua, n√∫mero, bairro">
            </div>
          </div>
          <div class="flex justify-end gap-3 mt-8 pt-4 border-t border-gray-200">
            <button type="button" onclick="closeModal()" class="modern-button-secondary">
              Cancelar
            </button>
            <button type="submit" class="modern-button flex items-center gap-2">
              <span id="submit-text">Salvar</span>
              <div id="submit-loading" class="hidden loading-spinner"></div>
            </button>
          </div>
        </form>
      `,
      fueling: `
        <form id="dynamic-form" class="space-y-5">
          <div class="text-center mb-6">
            <div class="icon-circle mx-auto">‚õΩ</div>
          </div>
          <div class="grid grid-cols-2 gap-5">
            <div class="col-span-2">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Ve√≠culo*</label>
              <select id="dynamic-fueling-veiculo_id" required class="modern-input w-full">
                <option value="">Selecione um ve√≠culo</option>
              </select>
            </div>
            <div class="col-span-2">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Alocar em Ordem de Servi√ßo</label>
              <select id="dynamic-fueling-ordem_id" class="modern-input w-full">
                <option value="">N√£o alocar em OS</option>
              </select>
            </div>
            <div class="col-span-2">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Posto de Gasolina*</label>
              <select id="dynamic-fueling-fornecedor_id" required class="modern-input w-full">
                <option value="">Selecione um posto</option>
              </select>
            </div>
            <div class="col-span-2">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Descri√ß√£o*</label>
              <input type="text" id="dynamic-fueling-descricao" required class="modern-input w-full" placeholder="Ex: Abastecimento Posto Shell">
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Litros*</label>
              <input type="number" id="dynamic-fueling-litros" required step="0.01" class="modern-input w-full" placeholder="0.00">
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Valor*</label>
              <input type="number" id="dynamic-fueling-valor" required step="0.01" class="modern-input w-full" placeholder="0.00">
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Nota Fiscal</label>
              <input type="text" id="dynamic-fueling-nota_fiscal" class="modern-input w-full" placeholder="000000">
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Data de Vencimento*</label>
              <input type="date" id="dynamic-fueling-data_vencimento" required class="modern-input w-full">
            </div>
          </div>
          <div class="flex justify-end gap-3 mt-8 pt-4 border-t border-gray-200">
            <button type="button" onclick="closeModal()" class="modern-button-secondary">
              Cancelar
            </button>
            <button type="submit" class="modern-button flex items-center gap-2" style="background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);">
              <span id="submit-text">Salvar</span>
              <div id="submit-loading" class="hidden loading-spinner"></div>
            </button>
          </div>
        </form>
      `,
      expense: `
        <form id="dynamic-form" class="space-y-5">
          <div class="text-center mb-6">
            <div class="icon-circle mx-auto">üí∏</div>
          </div>
          <div class="grid grid-cols-2 gap-5">
            <div class="col-span-2">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Ve√≠culo*</label>
              <select id="dynamic-expense-veiculo_id" required class="modern-input w-full">
                <option value="">Selecione um ve√≠culo</option>
              </select>
            </div>
            <div class="col-span-2">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Alocar em Ordem de Servi√ßo</label>
              <select id="dynamic-expense-ordem_id" class="modern-input w-full">
                <option value="">N√£o alocar em OS</option>
              </select>
            </div>
            <div class="col-span-2">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Fornecedor*</label>
              <select id="dynamic-expense-fornecedor_id" required class="modern-input w-full">
                <option value="">Selecione um fornecedor</option>
              </select>
            </div>
            <div class="col-span-2">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Descri√ß√£o*</label>
              <input type="text" id="dynamic-expense-descricao" required class="modern-input w-full" placeholder="Ex: Troca de √≥leo">
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Valor*</label>
              <input type="number" id="dynamic-expense-valor" required step="0.01" class="modern-input w-full" placeholder="0.00">
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Nota Fiscal</label>
              <input type="text" id="dynamic-expense-nota_fiscal" class="modern-input w-full" placeholder="000000">
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Data de Vencimento*</label>
              <input type="date" id="dynamic-expense-data_vencimento" required class="modern-input w-full">
            </div>
          </div>
          <div class="flex justify-end gap-3 mt-8 pt-4 border-t border-gray-200">
            <button type="button" onclick="closeModal()" class="modern-button-secondary">
              Cancelar
            </button>
            <button type="submit" class="modern-button flex items-center gap-2" style="background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);">
              <span id="submit-text">Salvar</span>
              <div id="submit-loading" class="hidden loading-spinner"></div>
            </button>
          </div>
        </form>
      `
    };

    // Utility Functions
    function formatCurrency(value) {
      return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value || 0);
    }

    function formatDate(dateString) {
      if (!dateString) return '-';
      return new Date(dateString).toLocaleDateString('pt-BR');
    }

    function showToast(message, type = 'success') {
      const container = document.getElementById('header-toast-container');
      const toast = document.createElement('div');
      toast.className = `toast bg-white border-l-4 ${type === 'success' ? 'border-green-500' : 'border-red-500'} rounded-lg shadow-lg p-4 flex items-center gap-3`;
      toast.innerHTML = `
        <span class="text-2xl">${type === 'success' ? '‚úì' : '‚úó'}</span>
        <span class="text-sm text-gray-800">${message}</span>
      `;
      container.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    function getOrderNumber(order) {
      const orders = allData.filter(item => item.type === 'order').sort((a, b) => {
        return new Date(a.created_at) - new Date(b.created_at);
      });
      const index = orders.findIndex(o => o.__backendId === order.__backendId);
      return String(index + 1).padStart(4, '0');
    }

    // Tab Navigation
    function showTab(tabId) {
      // Update tab buttons
      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('tab-active');
      });
      event.target.closest('.tab-button').classList.add('tab-active');

      // Update content
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      
      const targetContent = document.getElementById(`${tabId}-content`);
      if (targetContent) {
        targetContent.classList.add('active');
      }

      updateUI();
    }

    // Modal Functions
    function closeModal() {
      document.getElementById('modal-overlay').classList.remove('flex');
      document.getElementById('modal-overlay').classList.add('hidden');
      currentEditingRecord = null;
    }

    function openHelpModal() {
      document.getElementById('modal-title').textContent = 'üí° Guia Completo do Sistema';
      document.getElementById('modal-content').innerHTML = `
        <div class="space-y-6" style="max-height: 70vh; overflow-y: auto; padding-right: 10px;">
          
          <!-- Vis√£o Geral -->
          <div class="card-modern p-6" style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);">
            <h4 class="text-lg font-bold gradient-text mb-3">üéØ Vis√£o Geral</h4>
            <p class="text-sm text-gray-700 leading-relaxed">
              O WeFrotas √© um sistema completo de gest√£o de frotas que permite controlar ve√≠culos, motoristas, 
              ordens de servi√ßo, lan√ßamentos (abastecimentos e despesas) e contas a pagar. Tudo em um s√≥ lugar!
            </p>
          </div>

          <!-- Navega√ß√£o -->
          <div class="card-modern p-6">
            <h4 class="text-lg font-bold text-gray-900 mb-4">üß≠ Barra de Navega√ß√£o</h4>
            <div class="space-y-3">
              <div class="flex items-center gap-3 p-3 summary-card">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="3" width="7" height="7"></rect>
                  <rect x="14" y="3" width="7" height="7"></rect>
                  <rect x="14" y="14" width="7" height="7"></rect>
                  <rect x="3" y="14" width="7" height="7"></rect>
                </svg>
                <div>
                  <div class="text-sm font-bold text-gray-900">Dashboard</div>
                  <div class="text-xs text-gray-600">Vis√£o geral com estat√≠sticas, resumo financeiro e atividades recentes</div>
                </div>
              </div>

              <div class="flex items-center gap-3 p-3 summary-card">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                  <polyline points="14 2 14 8 20 8"></polyline>
                </svg>
                <div>
                  <div class="text-sm font-bold text-gray-900">Ordens de Servi√ßo</div>
                  <div class="text-xs text-gray-600">Gerencie ordens de servi√ßo (OS) dos ve√≠culos com filtros e status</div>
                </div>
              </div>

              <div class="flex items-center gap-3 p-3 summary-card">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="12" y1="1" x2="12" y2="23"></line>
                  <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                </svg>
                <div>
                  <div class="text-sm font-bold text-gray-900">Lan√ßamentos</div>
                  <div class="text-xs text-gray-600">Registre abastecimentos ‚õΩ e despesas üí∏ da frota</div>
                </div>
              </div>

              <div class="flex items-center gap-3 p-3 summary-card">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="12" y1="20" x2="12" y2="10"></line>
                  <line x1="18" y1="20" x2="18" y2="4"></line>
                  <line x1="6" y1="20" x2="6" y2="16"></line>
                </svg>
                <div>
                  <div class="text-sm font-bold text-gray-900">Contas a Pagar</div>
                  <div class="text-xs text-gray-600">Controle financeiro completo: pendentes, vencidas e pagas</div>
                </div>
              </div>

              <div class="flex items-center gap-3 p-3 summary-card">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="1" y="3" width="15" height="13"></rect>
                  <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon>
                  <circle cx="5.5" cy="18.5" r="2.5"></circle>
                  <circle cx="18.5" cy="18.5" r="2.5"></circle>
                </svg>
                <div>
                  <div class="text-sm font-bold text-gray-900">Ve√≠culos</div>
                  <div class="text-xs text-gray-600">Cadastre, edite e exclua ve√≠culos diretamente na listagem</div>
                </div>
              </div>

              <div class="flex items-center gap-3 p-3 summary-card">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                  <circle cx="12" cy="7" r="4"></circle>
                </svg>
                <div>
                  <div class="text-sm font-bold text-gray-900">Motoristas</div>
                  <div class="text-xs text-gray-600">Cadastre, edite e exclua motoristas diretamente na listagem</div>
                </div>
              </div>

              <div class="flex items-center gap-3 p-3 summary-card">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                  <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
                <div>
                  <div class="text-sm font-bold text-gray-900">Fornecedores</div>
                  <div class="text-xs text-gray-600">Cadastre postos, oficinas e outros fornecedores diretamente na listagem</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Funcionalidades Principais -->
          <div class="card-modern p-6">
            <h4 class="text-lg font-bold text-gray-900 mb-4">‚ö° Funcionalidades Principais</h4>
            
            <div class="space-y-4">
              <div class="summary-card p-4">
                <h5 class="font-bold text-gray-900 mb-2">üìã Ordens de Servi√ßo</h5>
                <ul class="text-sm text-gray-700 space-y-1 ml-4 list-disc">
                  <li><strong>Criar OS:</strong> Clique no bot√£o + para criar uma nova ordem</li>
                  <li><strong>Status:</strong> Aberta (‚ö†Ô∏è amarelo), Em Andamento (üîµ azul), Fechada (ÔøΩÔøΩ verde)</li>
                  <li><strong>Filtros:</strong> Filtre por n√∫mero, data, status e ordena√ß√£o</li>
                  <li><strong>Sele√ß√£o m√∫ltipla:</strong> Use os checkboxes para selecionar ordens</li>
                  <li><strong>Editar:</strong> Selecione apenas 1 OS e clique no √≠cone de edi√ß√£o ‚úèÔøΩÔøΩ</li>
                  <li><strong>Excluir:</strong> Selecione e clique no √≠cone da lixeira üóëÔ∏è</li>
                  <li><strong>Imprimir:</strong> Selecione 1 OS e clique no √≠cone de impressora üñ®Ô∏è</li>
                  <li><strong>Exportar:</strong> Clique no √≠cone de download ‚¨áÔ∏è para exportar CSV</li>
                </ul>
              </div>

              <div class="summary-card p-4">
                <h5 class="font-bold text-gray-900 mb-2">üí∞ Lan√ßamentos</h5>
                <ul class="text-sm text-gray-700 space-y-1 ml-4 list-disc">
                  <li><strong>Abastecimento ‚õΩ:</strong> Registre combust√≠vel, litros, posto e valor</li>
                  <li><strong>Despesa üí∏:</strong> Registre manuten√ß√µes, pe√ßas e outros custos</li>
                  <li><strong>Alocar em OS:</strong> Vincule lan√ßamentos a ordens de servi√ßo espec√≠ficas</li>
                  <li><strong>Nota Fiscal:</strong> Registre o n√∫mero da NF para cada lan√ßamento</li>
                  <li><strong>Contas autom√°ticas:</strong> Ao criar um lan√ßamento, uma conta a pagar √© gerada automaticamente</li>
                </ul>
              </div>

              <div class="summary-card p-4">
                <h5 class="font-bold text-gray-900 mb-2">üí≥ Contas a Pagar</h5>
                <ul class="text-sm text-gray-700 space-y-1 ml-4 list-disc">
                  <li><strong>Status:</strong> Pendentes (‚è≥), Vencidas (‚ö†Ô∏è vermelho), Pagas (‚úÖ verde)</li>
                  <li><strong>Dar Baixa ‚úì:</strong> Selecione contas e clique em ‚úì para marcar como pagas</li>
                  <li><strong>Editar ‚úèÔ∏è:</strong> Selecione 1 conta para editar valor, vencimento ou fornecedor</li>
                  <li><strong>Renegociar üîÑ:</strong> Altere a data de vencimento de uma conta</li>
                  <li><strong>Agrupar üì¶:</strong> Selecione 2+ contas para unir em uma √∫nica conta</li>
                  <li><strong>Excluir üóëÔ∏è:</strong> Exclua contas pendentes (contas pagas n√£o podem ser exclu√≠das)</li>
                  <li><strong>Resumo visual:</strong> Veja totais de contas a vencer, vencidas e pagas</li>
                </ul>
              </div>

              <div class="summary-card p-4">
                <h5 class="font-bold text-gray-900 mb-2">ÔøΩÔøΩ Cadastros</h5>
                <ul class="text-sm text-gray-700 space-y-1 ml-4 list-disc">
                  <li><strong>Ve√≠culos:</strong> Placa, modelo, ano, cor, chassi e RENAVAM</li>
                  <li><strong>Motoristas:</strong> Nome, CPF, CNH, categoria, telefone e e-mail</li>
                  <li><strong>Fornecedores:</strong> Raz√£o social, CNPJ, categoria (posto, oficina, etc.)</li>
                  <li><strong>Bot√µes no cabe√ßalho:</strong> + (incluir), ‚úèÔ∏è (editar), ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ (excluir)</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- Status e Indicadores -->
          <div class="card-modern p-6">
            <h4 class="text-lg font-bold text-gray-900 mb-4">üé® Status e Indicadores</h4>
            <div class="space-y-3">
              <div class="flex items-center gap-3">
                <span class="status-aberta">ABERTA</span>
                <span class="text-sm text-gray-700">Ordem de servi√ßo iniciada</span>
              </div>
              <div class="flex items-center gap-3">
                <span class="status-andamento">EM ANDAMENTO</span>
                <span class="text-sm text-gray-700">Ordem em execu√ß√£o</span>
              </div>
              <div class="flex items-center gap-3">
                <span class="status-fechada">FECHADA</span>
                <span class="text-sm text-gray-700">Ordem conclu√≠da</span>
              </div>
              <div class="flex items-center gap-3 mt-4">
                <div class="text-2xl">‚õΩ</div>
                <span class="text-sm text-gray-700">Abastecimento</span>
              </div>
              <div class="flex items-center gap-3">
                <div class="text-2xl">üí∏</div>
                <span class="text-sm text-gray-700">Despesa</span>
              </div>
            </div>
          </div>

          <!-- Dicas -->
          <div class="card-modern p-6" style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, rgba(22, 163, 74, 0.1) 100%); border: 1.5px solid rgba(34, 197, 94, 0.2);">
            <h4 class="text-lg font-bold text-green-800 mb-3">üí° Dicas Importantes</h4>
            <ul class="text-sm text-green-900 space-y-2 ml-4 list-disc">
              <li>Sempre cadastre ve√≠culos, motoristas e fornecedores <strong>antes</strong> de criar ordens de servi√ßo</li>
              <li>Use filtros para encontrar informa√ß√µes rapidamente</li>
              <li>A impress√£o de OS gera um PDF profissional com todos os dados</li>
              <li>Agrupar contas facilita o pagamento de m√∫ltiplas despesas de uma vez</li>
              <li>Lan√ßamentos vinculados a OS aparecem na impress√£o da ordem</li>
              <li>O Dashboard oferece uma vis√£o r√°pida de toda a opera√ß√£o</li>
              <li>Os bot√µes de + ‚úèÔ∏è üóëÔ∏è agora est√£o nos cabe√ßalhos de cada m√≥dulo!</li>
            </ul>
          </div>

          <div class="flex justify-end pt-4 border-t border-gray-200">
            <button onclick="closeModal()" class="modern-button">
              Entendi!
            </button>
          </div>
        </div>
      `;
      
      document.getElementById('modal-overlay').classList.remove('hidden');
      document.getElementById('modal-overlay').classList.add('flex');
    }

    function toggleDarkMode() {
      const isDark = document.body.classList.toggle('dark-mode');
      localStorage.setItem('wefrotas_dark_mode', isDark);
      
      const btn = document.getElementById('dark-mode-btn');
      if (isDark) {
        // √çcone de sol para modo escuro
        btn.innerHTML = '<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>';
        showToast('Modo escuro ativado! ÔøΩÔøΩ');
      } else {
        // √çcone de lua para modo claro
        btn.innerHTML = '<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>';
        showToast('Modo claro ativado! ‚òÄÔ∏è');
      }
    }

    function showCadastroForm(type) {
      const titles = {
        vehicle: currentEditingRecord ? 'Editar Ve√≠culo' : 'Novo Ve√≠culo',
        driver: currentEditingRecord ? 'Editar Motorista' : 'Novo Motorista',
        order: currentEditingRecord ? 'Editar Ordem de Servi√ßo' : 'Nova Ordem de Servi√ßo',
        supplier: currentEditingRecord ? 'Editar Fornecedor' : 'Novo Fornecedor',
        fueling: 'Novo Abastecimento',
        expense: 'Nova Despesa'
      };

      document.getElementById('modal-title').textContent = titles[type];
      document.getElementById('modal-content').innerHTML = formConfigs[type];
      document.getElementById('modal-overlay').classList.remove('hidden');
      document.getElementById('modal-overlay').classList.add('flex');

      updateSelects();

      // Pre-fill form if editing
      if (currentEditingRecord && currentEditingRecord.type === type) {
        Object.keys(currentEditingRecord).forEach(key => {
          const input = document.getElementById(`dynamic-${type}-${key}`);
          if (input && key !== '__backendId' && key !== 'type' && key !== 'created_at') {
            input.value = currentEditingRecord[key] || '';
          }
        });
      }

      // Set default date for order
      if (type === 'order' && !currentEditingRecord) {
        document.getElementById('dynamic-order-data_abertura').value = new Date().toISOString().split('T')[0];
      }

      // Setup form submit
      document.getElementById('dynamic-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const submitBtn = e.target.querySelector('button[type="submit"]');
        const submitText = document.getElementById('submit-text');
        const submitLoading = document.getElementById('submit-loading');
        
        submitBtn.disabled = true;
        submitText.classList.add('hidden');
        submitLoading.classList.remove('hidden');

        if (type === 'fueling') {
          await handleFuelingSubmit(e);
        } else if (type === 'expense') {
          await handleExpenseSubmit(e);
        } else {
          await handleGenericSubmit(e, type);
        }
      });
    }

    function showLancamentoPopup(type) {
      showCadastroForm(type);
    }

    function showNovoLancamentoMenu() {
      document.getElementById('modal-title').textContent = 'Novo Lan√ßamento';
      document.getElementById('modal-content').innerHTML = `
        <div class="space-y-4">
          <p class="text-sm text-gray-700 text-center mb-6">Escolha o tipo de lan√ßamento que deseja registrar:</p>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Abastecimento Card -->
            <button onclick="closeModal(); showLancamentoPopup('fueling');" class="card-modern p-6 hover:shadow-2xl transition-all text-left" style="background: linear-gradient(135deg, rgba(132, 250, 176, 0.1) 0%, rgba(143, 211, 244, 0.1) 100%);">
              <div class="flex items-center gap-4 mb-4">
                <div class="icon-circle">‚õΩ</div>
                <div>
                  <h3 class="text-lg font-bold text-gray-900">Abastecimento</h3>
                  <p class="text-sm text-gray-600 font-medium">Registrar abastecimento de ve√≠culo</p>
                </div>
              </div>
            </button>

            <!-- Despesa Card -->
            <button onclick="closeModal(); showLancamentoPopup('expense');" class="card-modern p-6 hover:shadow-2xl transition-all text-left" style="background: linear-gradient(135deg, rgba(246, 211, 101, 0.1) 0%, rgba(253, 160, 133, 0.1) 100%);">
              <div class="flex items-center gap-4 mb-4">
                <div class="icon-circle">üí∏</div>
                <div>
                  <h3 class="text-lg font-bold text-gray-900">Despesa</h3>
                  <p class="text-sm text-gray-600 font-medium">Registrar despesa da frota</p>
                </div>
              </div>
            </button>
          </div>

          <div class="flex justify-end pt-4 border-t border-gray-200 mt-6">
            <button onclick="closeModal()" class="modern-button-secondary">
              Cancelar
            </button>
          </div>
        </div>
      `;
      
      document.getElementById('modal-overlay').classList.remove('hidden');
      document.getElementById('modal-overlay').classList.add('flex');
    }

    // Form Handlers
    async function handleGenericSubmit(e, type) {
      const form = e.target;
      const inputs = form.querySelectorAll('input, select, textarea');
      const isEditing = !!currentEditingRecord;
      const data = {
        __backendId: currentEditingRecord?.__backendId || generateId(),
        id: currentEditingRecord?.id || `${type}-${Date.now()}`,
        type: type,
        created_at: currentEditingRecord?.created_at || new Date().toISOString()
      };

      inputs.forEach(input => {
        const fieldName = input.id.replace(`dynamic-${type}-`, '');
        if (fieldName && input.id.startsWith(`dynamic-${type}-`)) {
          if (input.type === 'number') {
            data[fieldName] = input.value ? parseFloat(input.value) : null;
          } else {
            data[fieldName] = input.value || '';
          }
        }
      });

      if (isEditing) {
        // Update existing record
        const index = allData.findIndex(item => item.__backendId === currentEditingRecord.__backendId);
        if (index !== -1) {
          allData[index] = data;
        }
      } else {
        // Add new record
        allData.push(data);
      }

      saveToLocalStorage();
      
      // Show toast first
      showToast(isEditing ? 'Registro atualizado!' : 'Registro cadastrado!');
      
      // Then close modal and update UI
      closeModal();
      currentEditingRecord = null;
      updateUI();
    }

    async function handleFuelingSubmit(e) {
      const fornecedor_id = document.getElementById('dynamic-fueling-fornecedor_id').value;
      const data_vencimento = document.getElementById('dynamic-fueling-data_vencimento').value;
      const nota_fiscal = document.getElementById('dynamic-fueling-nota_fiscal').value;
      const ordem_id = document.getElementById('dynamic-fueling-ordem_id').value;
      const isEditing = !!currentEditingRecord;
      
      const data = {
        __backendId: currentEditingRecord?.__backendId || generateId(),
        id: currentEditingRecord?.id || `lancamento-${Date.now()}`,
        type: 'lancamento',
        tipo_lancamento: 'abastecimento',
        veiculo_id: document.getElementById('dynamic-fueling-veiculo_id').value,
        fornecedor_id: fornecedor_id,
        descricao: document.getElementById('dynamic-fueling-descricao').value,
        valor: parseFloat(document.getElementById('dynamic-fueling-valor').value),
        litros: parseFloat(document.getElementById('dynamic-fueling-litros').value),
        nota_fiscal: nota_fiscal,
        data_vencimento: data_vencimento,
        ordem_id: ordem_id || null,
        created_at: currentEditingRecord?.created_at || new Date().toISOString()
      };

      if (isEditing) {
        // Update existing
        const index = allData.findIndex(item => item.__backendId === currentEditingRecord.__backendId);
        if (index !== -1) {
          allData[index] = data;
          // Update associated conta
          const contaIndex = allData.findIndex(c => c.type === 'conta' && c.lancamento_id === data.id);
          if (contaIndex !== -1) {
            allData[contaIndex].descricao = data.descricao;
            allData[contaIndex].valor = data.valor;
            allData[contaIndex].data_vencimento = data_vencimento;
            allData[contaIndex].nota_fiscal = nota_fiscal;
            allData[contaIndex].fornecedor_id = fornecedor_id;
          }
        }
      } else {
        // Create new
        allData.push(data);
        
        // Create associated conta
        const contaData = {
          __backendId: generateId(),
          id: `conta-${Date.now()}`,
          type: 'conta',
          descricao: data.descricao,
          valor: data.valor,
          data_vencimento: data_vencimento,
          nota_fiscal: nota_fiscal,
          fornecedor_id: fornecedor_id,
          lancamento_id: data.id,
          pago: false,
          created_at: new Date().toISOString()
        };
        allData.push(contaData);
      }
      
      saveToLocalStorage();
      
      // Show toast first
      showToast(isEditing ? 'Abastecimento atualizado!' : 'Abastecimento registrado!');
      
      // Then close modal and update UI
      closeModal();
      currentEditingRecord = null;
      updateUI();
    }

    async function handleExpenseSubmit(e) {
      const fornecedor_id = document.getElementById('dynamic-expense-fornecedor_id').value;
      const data_vencimento = document.getElementById('dynamic-expense-data_vencimento').value;
      const nota_fiscal = document.getElementById('dynamic-expense-nota_fiscal').value;
      const ordem_id = document.getElementById('dynamic-expense-ordem_id').value;
      const isEditing = !!currentEditingRecord;
      
      const data = {
        __backendId: currentEditingRecord?.__backendId || generateId(),
        id: currentEditingRecord?.id || `lancamento-${Date.now()}`,
        type: 'lancamento',
        tipo_lancamento: 'despesa',
        veiculo_id: document.getElementById('dynamic-expense-veiculo_id').value,
        fornecedor_id: fornecedor_id,
        descricao: document.getElementById('dynamic-expense-descricao').value,
        valor: parseFloat(document.getElementById('dynamic-expense-valor').value),
        nota_fiscal: nota_fiscal,
        data_vencimento: data_vencimento,
        ordem_id: ordem_id || null,
        created_at: currentEditingRecord?.created_at || new Date().toISOString()
      };

      if (isEditing) {
        // Update existing
        const index = allData.findIndex(item => item.__backendId === currentEditingRecord.__backendId);
        if (index !== -1) {
          allData[index] = data;
          // Update associated conta
          const contaIndex = allData.findIndex(c => c.type === 'conta' && c.lancamento_id === data.id);
          if (contaIndex !== -1) {
            allData[contaIndex].descricao = data.descricao;
            allData[contaIndex].valor = data.valor;
            allData[contaIndex].data_vencimento = data_vencimento;
            allData[contaIndex].nota_fiscal = nota_fiscal;
            allData[contaIndex].fornecedor_id = fornecedor_id;
          }
        }
      } else {
        // Create new
        allData.push(data);
        
        // Create associated conta
        const contaData = {
          __backendId: generateId(),
          id: `conta-${Date.now()}`,
          type: 'conta',
          descricao: data.descricao,
          valor: data.valor,
          data_vencimento: data_vencimento,
          nota_fiscal: nota_fiscal,
          fornecedor_id: fornecedor_id,
          lancamento_id: data.id,
          pago: false,
          created_at: new Date().toISOString()
        };
        allData.push(contaData);
      }
      
      saveToLocalStorage();
      
      // Show toast first
      showToast(isEditing ? 'Despesa atualizada!' : 'Despesa registrada!');
      
      // Then close modal and update UI
      closeModal();
      currentEditingRecord = null;
      updateUI();
    }

    // Filter Functions
    function getFilteredOrders() {
      let filtered = allData.filter(item => item.type === 'order');
      
      const numero = document.getElementById('filter-order-numero').value.trim();
      const startDate = document.getElementById('filter-order-start-date').value;
      const endDate = document.getElementById('filter-order-end-date').value;
      const status = document.getElementById('filter-order-status').value;
      const sort = document.getElementById('order-sort').value;

      if (numero) {
        filtered = filtered.filter(order => getOrderNumber(order) === numero.padStart(4, '0'));
      }
      if (startDate) {
        filtered = filtered.filter(order => order.data_abertura >= startDate);
      }
      if (endDate) {
        filtered = filtered.filter(order => order.data_abertura <= endDate);
      }
      if (status) {
        filtered = filtered.filter(order => order.status === status);
      }

      filtered.sort((a, b) => {
        const dateA = new Date(a.data_abertura);
        const dateB = new Date(b.data_abertura);
        return sort === 'newest' ? dateB - dateA : dateA - dateB;
      });

      return filtered;
    }

    function getFilteredContas() {
      let filtered = allData.filter(item => item.type === 'conta');
      const status = document.getElementById('filter-contas-status').value;
      const startDate = document.getElementById('filter-contas-start-date').value;
      const endDate = document.getElementById('filter-contas-end-date').value;
      const hoje = new Date().toISOString().split('T')[0];

      if (status === 'pendente') {
        filtered = filtered.filter(c => !c.pago);
      } else if (status === 'pago') {
        filtered = filtered.filter(c => c.pago);
      } else if (status === 'vencidas') {
        filtered = filtered.filter(c => !c.pago && c.data_vencimento < hoje);
      }

      if (startDate) {
        filtered = filtered.filter(c => c.data_vencimento >= startDate);
      }
      if (endDate) {
        filtered = filtered.filter(c => c.data_vencimento <= endDate);
      }

      return filtered;
    }

    function applyOrderFilters() {
      updateUI();
      showToast('Filtros aplicados!');
    }

    function clearOrderFilters() {
      document.getElementById('filter-order-numero').value = '';
      document.getElementById('filter-order-start-date').value = '';
      document.getElementById('filter-order-end-date').value = '';
      document.getElementById('filter-order-status').value = '';
      document.getElementById('order-sort').value = 'newest';
      updateUI();
      showToast('Filtros limpos!');
    }

    function applyContasFilters() {
      updateUI();
      showToast('Filtros aplicados!');
    }

    function clearContasFilters() {
      document.getElementById('filter-contas-status').value = '';
      document.getElementById('filter-contas-start-date').value = '';
      document.getElementById('filter-contas-end-date').value = '';
      updateUI();
      showToast('Filtros limpos!');
    }

    // Order Actions
    function editSelectedOrder() {
      if (selectedOrders.size === 1) {
        const id = Array.from(selectedOrders)[0];
        currentEditingRecord = allData.find(item => item.__backendId === id);
        if (currentEditingRecord) {
          showCadastroForm('order');
        }
      }
    }

    function editOrderDirect(orderId) {
      currentEditingRecord = allData.find(item => item.__backendId === orderId);
      if (currentEditingRecord) {
        showCadastroForm('order');
      }
    }

    function closeOrderDirect(orderId) {
      const order = allData.find(item => item.__backendId === orderId);
      if (!order) return;

      document.getElementById('modal-title').textContent = 'Fechar Ordem de Servi√ßo';
      document.getElementById('modal-content').innerHTML = `
        <form id="close-order-form" class="space-y-5">
          <div class="summary-card p-5 mb-5" style="background: linear-gradient(135deg, rgba(132, 250, 176, 0.1) 0%, rgba(143, 211, 244, 0.1) 100%); border: 1.5px solid rgba(132, 250, 176, 0.3);">
            <div class="text-sm text-gray-600 font-semibold">Ordem de Servi√ßo</div>
            <div class="text-xl font-bold text-gray-900 mt-2">OS N¬∫ ${getOrderNumber(order)}</div>
            <div class="text-sm text-gray-700 mt-2">${order.descricao}</div>
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">Data de Fechamento*</label>
            <input type="date" id="close-date" required class="modern-input w-full" value="${new Date().toISOString().split('T')[0]}">
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">KM Final</label>
            <input type="number" id="close-km" class="modern-input w-full" placeholder="${order.km || '0'}" value="${order.km || ''}">
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">Observa√ß√µes de Fechamento</label>
            <textarea id="close-obs" rows="3" class="modern-input w-full" placeholder="Observa√ß√µes sobre o fechamento da OS..."></textarea>
          </div>
          <div class="flex justify-end gap-3 mt-8 pt-4 border-t border-gray-200">
            <button type="button" onclick="closeModal()" class="modern-button-secondary">
              Cancelar
            </button>
            <button type="submit" class="modern-button" style="background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);">
              Fechar Ordem
            </button>
          </div>
        </form>
      `;
      
      document.getElementById('modal-overlay').classList.remove('hidden');
      document.getElementById('modal-overlay').classList.add('flex');

      document.getElementById('close-order-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const index = allData.findIndex(item => item.__backendId === orderId);
        if (index !== -1) {
          allData[index].status = 'fechada';
          allData[index].data_fechamento = document.getElementById('close-date').value;
          const kmFinal = document.getElementById('close-km').value;
          if (kmFinal) {
            allData[index].km = parseFloat(kmFinal);
          }
          const obs = document.getElementById('close-obs').value;
          if (obs) {
            allData[index].observacoes_fechamento = obs;
          }

          saveToLocalStorage();
          updateUI();
          
          showToast('Ordem de servi√ßo fechada com sucesso!');
          closeModal();
        }
      });
    }

    function reopenOrderDirect(orderId) {
      const order = allData.find(item => item.__backendId === orderId);
      if (!order) return;

      document.getElementById('modal-title').textContent = 'Reabrir Ordem de Servi√ßo';
      document.getElementById('modal-content').innerHTML = `
        <form id="reopen-order-form" class="space-y-5">
          <div class="summary-card p-5 mb-5" style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(217, 119, 6, 0.1) 100%); border: 1.5px solid rgba(245, 158, 11, 0.3);">
            <div class="text-sm text-gray-600 font-semibold">Ordem de Servi√ßo</div>
            <div class="text-xl font-bold text-gray-900 mt-2">OS N¬∫ ${getOrderNumber(order)}</div>
            <div class="text-sm text-gray-700 mt-2">${order.descricao}</div>
          </div>
          <div class="summary-card p-4 text-center">
            <p class="text-sm text-gray-700">Deseja reabrir esta ordem de servi√ßo? O status ser√° alterado para <strong>Em Andamento</strong>.</p>
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">Motivo da Reabertura</label>
            <textarea id="reopen-obs" rows="3" class="modern-input w-full" placeholder="Descreva o motivo da reabertura..."></textarea>
          </div>
          <div class="flex justify-end gap-3 mt-8 pt-4 border-t border-gray-200">
            <button type="button" onclick="closeModal()" class="modern-button-secondary">
              Cancelar
            </button>
            <button type="submit" class="modern-button" style="background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);">
              Reabrir Ordem
            </button>
          </div>
        </form>
      `;
      
      document.getElementById('modal-overlay').classList.remove('hidden');
      document.getElementById('modal-overlay').classList.add('flex');

      document.getElementById('reopen-order-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const index = allData.findIndex(item => item.__backendId === orderId);
        if (index !== -1) {
          allData[index].status = 'andamento';
          allData[index].data_fechamento = '';
          const obs = document.getElementById('reopen-obs').value;
          if (obs) {
            allData[index].observacoes_reabertura = obs;
          }

          saveToLocalStorage();
          updateUI();
          
          showToast('Ordem de servi√ßo reaberta!');
          closeModal();
        }
      });
    }

    function printOrderDirect(orderId) {
      const order = allData.find(item => item.__backendId === orderId);
      if (!order) return;

      const veiculo = allData.find(v => v.type === 'vehicle' && v.id === order.veiculo_id);
      const motorista = allData.find(m => m.type === 'driver' && m.id === order.motorista_id);
      const numeroOS = getOrderNumber(order);
      
      const lancamentos = allData.filter(l => l.type === 'lancamento' && l.ordem_id === order.id);
      
      const contas = allData.filter(c => 
        c.type === 'conta' && 
        lancamentos.some(l => l.id === c.lancamento_id)
      );

      const totalContas = contas.reduce((sum, c) => sum + (c.valor || 0), 0);

      const contasHTML = contas.map(c => {
        const fornecedor = allData.find(f => f.type === 'supplier' && f.id === c.fornecedor_id);
        return `
          <tr>
            <td>${formatDate(c.data_vencimento)}</td>
            <td>${fornecedor ? fornecedor.razao_social : '-'}</td>
            <td>${c.nota_fiscal || '-'}</td>
            <td>${c.descricao}</td>
            <td style="text-align: right;">${formatCurrency(c.valor)}</td>
          </tr>
        `;
      }).join('');

      const printWindow = window.open('', '_blank');
      printWindow.document.write('<!DOCTYPE html><html><head><title>Ordem de Servico ' + numeroOS + '</title>');
      printWindow.document.write('<style>@page{size:A4;margin:2cm}body{font-family:Arial,sans-serif;font-size:12px;line-height:1.4;color:#000;max-width:21cm;margin:0 auto;padding:20px}.header{text-align:center;border-bottom:3px solid #667eea;padding-bottom:20px;margin-bottom:30px}.header h1{margin:0;font-size:28px;color:#667eea}.header .os-number{font-size:24px;font-weight:bold;color:#333;margin-top:10px}.section{margin-bottom:25px}.section-title{font-size:14px;font-weight:bold;color:#667eea;border-bottom:2px solid #e0e0e0;padding-bottom:5px;margin-bottom:12px}.info-row{display:flex;margin-bottom:8px}.info-label{font-weight:bold;min-width:150px;color:#555}.info-value{color:#000}table{width:100%;border-collapse:collapse;margin-top:15px}th{background:#667eea;color:white;padding:10px;text-align:left;font-weight:bold;font-size:11px}td{padding:8px;border-bottom:1px solid #e0e0e0;font-size:11px}.total-row{font-weight:bold;background:#f5f7fa;border-top:2px solid #667eea}.signature-area{margin-top:60px;padding-top:20px;border-top:2px solid #e0e0e0}.signature-line{margin-top:50px;border-top:2px solid #000;width:300px;text-align:center;padding-top:5px}.status-badge{display:inline-block;padding:4px 12px;border-radius:8px;font-weight:bold;font-size:11px;text-transform:uppercase}.status-aberta{background:#fda085;color:white}.status-andamento{background:#667eea;color:white}.status-fechada{background:#84fab0;color:white}@media print{body{padding:0}.no-print{display:none}}</style></head><body>');
      printWindow.document.write('<div class="header"><h1>WeFrotas</h1><div class="os-number">ORDEM DE SERVICO N ' + numeroOS + '</div></div>');
      printWindow.document.write('<div class="section"><div class="section-title">Informacoes Gerais</div><div class="info-row"><div class="info-label">Status:</div><div class="info-value"><span class="status-badge status-' + order.status + '">' + order.status + '</span></div></div>');
      printWindow.document.write('<div class="info-row"><div class="info-label">Data de Abertura:</div><div class="info-value">' + formatDate(order.data_abertura) + '</div></div>');
      if (order.data_fechamento) {
        printWindow.document.write('<div class="info-row"><div class="info-label">Data de Fechamento:</div><div class="info-value">' + formatDate(order.data_fechamento) + '</div></div>');
      }
      printWindow.document.write('</div>');
      printWindow.document.write('<div class="section"><div class="section-title">Veiculo e Motorista</div>');
      printWindow.document.write('<div class="info-row"><div class="info-label">Veiculo:</div><div class="info-value">' + (veiculo ? veiculo.placa + ' - ' + veiculo.modelo + ' ' + veiculo.ano : '-') + '</div></div>');
      printWindow.document.write('<div class="info-row"><div class="info-label">Motorista:</div><div class="info-value">' + (motorista ? motorista.nome : '-') + '</div></div>');
      if (order.km) {
        printWindow.document.write('<div class="info-row"><div class="info-label">Quilometragem:</div><div class="info-value">' + order.km + ' km</div></div>');
      }
      printWindow.document.write('</div>');
      printWindow.document.write('<div class="section"><div class="section-title">Descricao do Servico</div><div class="info-value">' + order.descricao + '</div></div>');
      if (contas.length > 0) {
        printWindow.document.write('<div class="section"><div class="section-title">Lancamentos e Pagamentos</div><table><thead><tr><th>Vencimento</th><th>Fornecedor</th><th>Nota Fiscal</th><th>Descricao</th><th style="text-align:right;">Valor</th></tr></thead><tbody>');
        printWindow.document.write(contasHTML);
        printWindow.document.write('<tr class="total-row"><td colspan="4" style="text-align:right;">TOTAL</td><td style="text-align:right;">' + formatCurrency(totalContas) + '</td></tr></tbody></table></div>');
      }
      printWindow.document.write('<div class="signature-area"><div class="signature-line" style="margin: 0 auto;"><div>AUTORIZADOR</div></div></div>');
      printWindow.document.write('<script>window.onload=function(){window.print()}<\/script></body></html>');
      printWindow.document.close();

      showToast('PDF gerado com sucesso!');
    }

    // Conta Actions
    async function paySelectedContas() {
      if (selectedContas.size === 0) return;
      
      const total = Array.from(selectedContas).reduce((sum, id) => {
        const conta = allData.find(c => c.__backendId === id);
        return sum + (conta ? conta.valor : 0);
      }, 0);

      document.getElementById('modal-title').textContent = 'Confirmar Baixa de Contas';
      document.getElementById('modal-content').innerHTML = `
        <form id="baixa-form" class="space-y-5">
          <div class="summary-card p-5 mb-5" style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, rgba(22, 163, 74, 0.1) 100%); border: 1.5px solid rgba(34, 197, 94, 0.2);">
            <div class="text-sm text-green-700 font-semibold">Total de Contas Selecionadas</div>
            <div class="text-4xl font-bold text-green-700 mt-2">${selectedContas.size}</div>
            <div class="text-2xl font-bold text-green-700 mt-3">${formatCurrency(total)}</div>
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">Data da Baixa*</label>
            <input type="date" id="data-baixa" required class="modern-input w-full" value="${new Date().toISOString().split('T')[0]}">
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">Observa√ß√µes</label>
            <textarea id="observacoes-baixa" rows="3" class="modern-input w-full" placeholder="Observa√ß√µes sobre a baixa..."></textarea>
          </div>
          <div class="flex justify-end gap-3 mt-8 pt-4 border-t border-gray-200">
            <button type="button" onclick="closeModal()" class="modern-button-secondary">
              Cancelar
            </button>
            <button type="submit" class="modern-button" style="background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);">
              Confirmar Baixa
            </button>
          </div>
        </form>
      `;
      
      document.getElementById('modal-overlay').classList.remove('hidden');
      document.getElementById('modal-overlay').classList.add('flex');

      document.getElementById('baixa-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const dataBaixa = document.getElementById('data-baixa').value;
        const obs = document.getElementById('observacoes-baixa').value;

        for (const id of selectedContas) {
          const index = allData.findIndex(item => item.__backendId === id);
          if (index !== -1) {
            allData[index].pago = true;
            allData[index].data_pagamento = dataBaixa;
            if (obs) {
              allData[index].observacoes_baixa = obs;
            }
          }
        }
        
        saveToLocalStorage();
        selectedContas.clear();
        updateUI();
        
        showToast('Baixa realizada com sucesso!');
        closeModal();
      });
    }

    async function deleteSelectedContas() {
      if (selectedContas.size === 0) return;
      
      for (const id of selectedContas) {
        const conta = allData.find(c => c.__backendId === id);
        if (conta && conta.pago) {
          showToast('N√£o √© poss√≠vel excluir contas j√° pagas', 'error');
          return;
        }
      }

      for (const id of selectedContas) {
        const index = allData.findIndex(item => item.__backendId === id);
        if (index !== -1) {
          allData.splice(index, 1);
        }
      }
      
      saveToLocalStorage();
      selectedContas.clear();
      updateUI();
      showToast('Contas exclu√≠das!');
    }

    async function editSelectedConta() {
      if (selectedContas.size !== 1) {
        showToast('Selecione apenas uma conta para editar', 'error');
        return;
      }

      const contaId = Array.from(selectedContas)[0];
      const conta = allData.find(item => item.__backendId === contaId);
      if (!conta) return;

      if (conta.pago) {
        showToast('N√£o √© poss√≠vel editar uma conta j√° paga', 'error');
        return;
      }

      const fornecedores = allData.filter(item => item.type === 'supplier');

      document.getElementById('modal-title').textContent = 'Editar Conta';
      document.getElementById('modal-content').innerHTML = `
        <form id="edit-conta-form" class="space-y-5">
          <div class="col-span-2">
            <label class="block text-sm font-semibold text-gray-700 mb-2">Descri√ßÔøΩÔøΩo*</label>
            <input type="text" id="edit-descricao" required class="modern-input w-full" value="${conta.descricao}">
          </div>
          <div class="grid grid-cols-2 gap-5">
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Valor*</label>
              <input type="number" id="edit-valor" required step="0.01" class="modern-input w-full" value="${conta.valor}">
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Data de Vencimento*</label>
              <input type="date" id="edit-vencimento" required class="modern-input w-full" value="${conta.data_vencimento}">
            </div>
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">Fornecedor*</label>
            <select id="edit-fornecedor" required class="modern-input w-full">
              <option value="">Selecione um fornecedor</option>
              ${fornecedores.map(f => `<option value="${f.id}" ${conta.fornecedor_id === f.id ? 'selected' : ''}>${f.razao_social}</option>`).join('')}
            </select>
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">Nota Fiscal</label>
            <input type="text" id="edit-nota-fiscal" class="modern-input w-full" value="${conta.nota_fiscal || ''}">
          </div>
          <div class="flex justify-end gap-3 mt-8 pt-4 border-t border-gray-200">
            <button type="button" onclick="closeModal()" class="modern-button-secondary">
              Cancelar
            </button>
            <button type="submit" class="modern-button">
              Salvar Altera√ß√µes
            </button>
          </div>
        </form>
      `;
      
      document.getElementById('modal-overlay').classList.remove('hidden');
      document.getElementById('modal-overlay').classList.add('flex');

      document.getElementById('edit-conta-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const index = allData.findIndex(item => item.__backendId === contaId);
        if (index !== -1) {
          allData[index].descricao = document.getElementById('edit-descricao').value;
          allData[index].valor = parseFloat(document.getElementById('edit-valor').value);
          allData[index].data_vencimento = document.getElementById('edit-vencimento').value;
          allData[index].fornecedor_id = document.getElementById('edit-fornecedor').value;
          allData[index].nota_fiscal = document.getElementById('edit-nota-fiscal').value;

          saveToLocalStorage();
          selectedContas.clear();
          updateUI();
          
          showToast('Conta atualizada com sucesso!');
          closeModal();
        }
      });
    }

    async function agruparContas() {
      if (selectedContas.size < 2) {
        showToast('Selecione pelo menos 2 contas para agrupar', 'error');
        return;
      }

      const contas = Array.from(selectedContas).map(id => 
        allData.find(item => item.__backendId === id)
      ).filter(Boolean);

      // Check if any conta is already paid
      if (contas.some(c => c.pago)) {
        showToast('N√£o √© poss√≠vel agrupar contas j√° pagas', 'error');
        return;
      }

      const totalValor = contas.reduce((sum, c) => sum + c.valor, 0);
      const descricoes = contas.map(c => c.descricao).join(' + ');
      
      // Get latest vencimento
      const vencimentos = contas.map(c => c.data_vencimento).sort().reverse();
      const latestVencimento = vencimentos[0];

      // Create grouped conta
      const contaAgrupada = {
        __backendId: generateId(),
        id: `conta-${Date.now()}`,
        type: 'conta',
        descricao: `Agrupamento: ${descricoes.substring(0, 100)}${descricoes.length > 100 ? '...' : ''}`,
        valor: totalValor,
        data_vencimento: latestVencimento,
        nota_fiscal: `AGR-${Date.now()}`,
        fornecedor_id: contas[0].fornecedor_id,
        conta_ids: contas.map(c => c.id),
        pago: false,
        agrupada: true,
        created_at: new Date().toISOString()
      };

      allData.push(contaAgrupada);

      // Remove individual contas
      for (const conta of contas) {
        const index = allData.findIndex(c => c.__backendId === conta.__backendId);
        if (index !== -1) {
          allData.splice(index, 1);
        }
      }

      saveToLocalStorage();
      selectedContas.clear();
      updateUI();
      showToast(`${contas.length} contas agrupadas em uma √∫nica conta!`);
    }

    async function renegociarConta() {
      if (selectedContas.size !== 1) {
        showToast('Selecione apenas uma conta para renegociar', 'error');
        return;
      }

      const contaId = Array.from(selectedContas)[0];
      const conta = allData.find(item => item.__backendId === contaId);
      if (!conta || conta.pago) {
        showToast('N√£o √© poss√≠vel renegociar uma conta j√° paga', 'error');
        return;
      }

      document.getElementById('modal-title').textContent = 'Renegociar Vencimento';
      document.getElementById('modal-content').innerHTML = `
        <form id="renegociar-form" class="space-y-5">
          <div class="summary-card p-5 mb-5">
            <div class="text-sm text-gray-600 font-semibold">Conta Selecionada</div>
            <div class="text-lg font-bold text-gray-900 mt-2">${conta.descricao}</div>
            <div class="text-2xl font-bold gradient-text mt-2">${formatCurrency(conta.valor)}</div>
            <div class="text-sm text-gray-600 mt-2">Vencimento Atual: <span class="font-bold">${formatDate(conta.data_vencimento)}</span></div>
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">Nova Data de Vencimento*</label>
            <input type="date" id="nova-data-vencimento" required class="modern-input w-full" min="${new Date().toISOString().split('T')[0]}">
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">Observa√ß√µes</label>
            <textarea id="observacoes-renegociacao" rows="3" class="modern-input w-full" placeholder="Motivo da renegociaÔøΩÔøΩ√£o..."></textarea>
          </div>
          <div class="flex justify-end gap-3 mt-8 pt-4 border-t border-gray-200">
            <button type="button" onclick="closeModal()" class="modern-button-secondary">
              Cancelar
            </button>
            <button type="submit" class="modern-button">
              Confirmar Renegocia√ßÔøΩÔøΩÔøΩÔøΩo
            </button>
          </div>
        </form>
      `;
      
      document.getElementById('modal-overlay').classList.remove('hidden');
      document.getElementById('modal-overlay').classList.add('flex');

      document.getElementById('renegociar-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const novaData = document.getElementById('nova-data-vencimento').value;
        const obs = document.getElementById('observacoes-renegociacao').value;

        const index = allData.findIndex(item => item.__backendId === contaId);
        if (index !== -1) {
          const dataAnterior = allData[index].data_vencimento;
          allData[index].data_vencimento = novaData;
          allData[index].renegociada = true;
          allData[index].data_renegociacao = new Date().toISOString().split('T')[0];
          allData[index].observacoes_renegociacao = obs;
          allData[index].vencimento_anterior = dataAnterior;

          saveToLocalStorage();
          selectedContas.clear();
          updateUI();
          
          showToast('Vencimento renegociado com sucesso!');
          closeModal();
        }
      });
    }

    async function deleteSelectedOrders() {
      if (selectedOrders.size === 0) return;
      
      const btn = document.getElementById('btn-delete-selected');
      btn.disabled = true;
      btn.innerHTML = '<div class="loading-spinner inline-block"></div>';

      for (const id of selectedOrders) {
        const index = allData.findIndex(item => item.__backendId === id);
        if (index !== -1) {
          allData.splice(index, 1);
        }
      }
      
      saveToLocalStorage();
      selectedOrders.clear();
      updateUI();
      showToast('Ordens exclu√≠das!');
    }

    function exportSelectedOrder() {
      const orders = getFilteredOrders();
      const csv = 'N√∫mero,Data,Status,Ve√≠culo,Motorista,KM\n' + 
        orders.map(order => {
          const veiculo = allData.find(v => v.type === 'vehicle' && v.id === order.veiculo_id);
          const motorista = allData.find(m => m.type === 'driver' && m.id === order.motorista_id);
          return `${getOrderNumber(order)},${formatDate(order.data_abertura)},${order.status},${veiculo?.placa || '-'},${motorista?.nome || '-'},${order.km}`;
        }).join('\n');
      
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'ordens-servico.csv';
      a.click();
      showToast('Ordens exportadas!');
    }

    function printSelectedOrder() {
      if (selectedOrders.size !== 1) {
        showToast('Selecione apenas uma ordem para imprimir', 'error');
        return;
      }
      
      const orderId = Array.from(selectedOrders)[0];
      printOrderDirect(orderId);
    }

    function exportContas() {
      const contas = getFilteredContas();
      const csv = 'Descri√ß√£o,Valor,Vencimento,Status\n' + 
        contas.map(conta => {
          const status = conta.pago ? 'Pago' : (conta.data_vencimento < new Date().toISOString().split('T')[0] ? 'Vencido' : 'Pendente');
          return `${conta.descricao},${conta.valor},${formatDate(conta.data_vencimento)},${status}`;
        }).join('\n');
      
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'contas-pagar.csv';
      a.click();
      showToast('Contas exportadas!');
    }

    // Vehicle Actions
    function editSelectedVehicle() {
      if (selectedVehicles.size === 1) {
        const id = Array.from(selectedVehicles)[0];
        currentEditingRecord = allData.find(item => item.__backendId === id);
        if (currentEditingRecord) {
          showCadastroForm('vehicle');
        }
      }
    }

    async function deleteSelectedVehicles() {
      if (selectedVehicles.size === 0) return;
      
      for (const id of selectedVehicles) {
        const index = allData.findIndex(item => item.__backendId === id);
        if (index !== -1) {
          allData.splice(index, 1);
        }
      }
      
      saveToLocalStorage();
      selectedVehicles.clear();
      updateUI();
      showToast('VeÔøΩÔøΩÔøΩÔøΩculos exclu√≠dos!');
    }

    // Driver Actions
    function editSelectedDriver() {
      if (selectedDrivers.size === 1) {
        const id = Array.from(selectedDrivers)[0];
        currentEditingRecord = allData.find(item => item.__backendId === id);
        if (currentEditingRecord) {
          showCadastroForm('driver');
        }
      }
    }

    async function deleteSelectedDrivers() {
      if (selectedDrivers.size === 0) return;
      
      for (const id of selectedDrivers) {
        const index = allData.findIndex(item => item.__backendId === id);
        if (index !== -1) {
          allData.splice(index, 1);
        }
      }
      
      saveToLocalStorage();
      selectedDrivers.clear();
      updateUI();
      showToast('Motoristas exclu√≠dos!');
    }

    // Supplier Actions
    function editSelectedSupplier() {
      if (selectedSuppliers.size === 1) {
        const id = Array.from(selectedSuppliers)[0];
        currentEditingRecord = allData.find(item => item.__backendId === id);
        if (currentEditingRecord) {
          showCadastroForm('supplier');
        }
      }
    }

    async function deleteSelectedSuppliers() {
      if (selectedSuppliers.size === 0) return;
      
      for (const id of selectedSuppliers) {
        const index = allData.findIndex(item => item.__backendId === id);
        if (index !== -1) {
          allData.splice(index, 1);
        }
      }
      
      saveToLocalStorage();
      selectedSuppliers.clear();
      updateUI();
      showToast('Fornecedores exclu√≠dos!');
    }

    // Update Selects
    function updateSelects() {
      const vehicles = allData.filter(item => item.type === 'vehicle');
      const drivers = allData.filter(item => item.type === 'driver');
      const suppliers = allData.filter(item => item.type === 'supplier');
      const orders = allData.filter(item => item.type === 'order');

      // Update vehicle selects
      const vehicleSelects = document.querySelectorAll('[id^="dynamic-"][id$="-veiculo_id"]');
      vehicleSelects.forEach(select => {
        const currentValue = select.value;
        select.innerHTML = '<option value="">Selecione um ve√≠culo</option>' + 
          vehicles.map(v => `<option value="${v.id}" ${v.id === currentValue ? 'selected' : ''}>${v.placa} - ${v.modelo}</option>`).join('');
      });

      // Update driver selects
      const driverSelects = document.querySelectorAll('[id^="dynamic-"][id$="-motorista_id"]');
      driverSelects.forEach(select => {
        const currentValue = select.value;
        select.innerHTML = '<option value="">Selecione um motorista</option>' + 
          drivers.map(d => `<option value="${d.id}" ${d.id === currentValue ? 'selected' : ''}>${d.nome}</option>`).join('');
      });

      // Update supplier selects
      const supplierSelects = document.querySelectorAll('[id^="dynamic-"][id$="-fornecedor_id"]');
      supplierSelects.forEach(select => {
        const currentValue = select.value;
        const isFueling = select.id.includes('fueling');
        let filteredSuppliers = suppliers;
        if (isFueling) {
          filteredSuppliers = suppliers.filter(s => s.categoria === 'posto');
        }
        select.innerHTML = '<option value="">Selecione ' + (isFueling ? 'um posto' : 'um fornecedor') + '</option>' + 
          filteredSuppliers.map(s => `<option value="${s.id}" ${s.id === currentValue ? 'selected' : ''}>${s.razao_social}</option>`).join('');
      });

      // Update order selects
      const orderSelects = document.querySelectorAll('[id^="dynamic-"][id$="-ordem_id"]');
      orderSelects.forEach(select => {
        const currentValue = select.value;
        const openOrders = orders.filter(o => o.status === 'aberta' || o.status === 'andamento');
        select.innerHTML = '<option value="">N√£o alocar em OS</option>' + 
          openOrders.map(o => `<option value="${o.id}" ${o.id === currentValue ? 'selected' : ''}>OS ${getOrderNumber(o)} - ${o.descricao.substring(0, 30)}...</option>`).join('');
      });
    }

    // UI Update Functions
    function updateUI() {
      updateDashboard();
      updateOrdersList();
      updateContasList();
      updateLancamentosList();
      updateVehiclesList();
      updateDriversList();
      updateSuppliersList();
    }

    function updateDashboard() {
      const vehicles = allData.filter(item => item.type === 'vehicle');
      const drivers = allData.filter(item => item.type === 'driver');
      const suppliers = allData.filter(item => item.type === 'supplier');
      const openOrders = allData.filter(item => item.type === 'order' && (item.status === 'aberta' || item.status === 'andamento'));
      const pendingContas = allData.filter(item => item.type === 'conta' && !item.pago);
      
      document.getElementById('dashboard-veiculos').textContent = vehicles.length;
      document.getElementById('dashboard-motoristas').textContent = drivers.length;
      document.getElementById('dashboard-fornecedores').textContent = suppliers.length;
      document.getElementById('dashboard-ordens').textContent = openOrders.length;
      document.getElementById('dashboard-contas').textContent = pendingContas.length;

      const contas = allData.filter(item => item.type === 'conta');
      const hoje = new Date().toISOString().split('T')[0];
      const totalPagar = contas.filter(c => !c.pago).reduce((sum, c) => sum + c.valor, 0);
      const totalVencidas = contas.filter(c => !c.pago && c.data_vencimento < hoje).reduce((sum, c) => sum + c.valor, 0);
      const totalPago = contas.filter(c => c.pago).reduce((sum, c) => sum + c.valor, 0);

      document.getElementById('dashboard-total-pagar').textContent = formatCurrency(totalPagar);
      document.getElementById('dashboard-vencidas').textContent = formatCurrency(totalVencidas);
      document.getElementById('dashboard-pago').textContent = formatCurrency(totalPago);

      // Recent Orders
      const recentOrders = allData.filter(item => item.type === 'order')
        .sort((a, b) => new Date(b.created_at) - new Date(a.created_at))
        .slice(0, 5);

      const ordersHtml = recentOrders.length > 0 ? recentOrders.map(order => {
        const veiculo = allData.find(v => v.type === 'vehicle' && v.id === order.veiculo_id);
        return `
          <div class="summary-card p-4 flex items-center justify-between">
            <div>
              <div class="font-bold text-gray-900">OS ${getOrderNumber(order)}</div>
              <div class="text-sm text-gray-600">${veiculo ? veiculo.placa : '-'} - ${formatDate(order.data_abertura)}</div>
            </div>
            <span class="status-${order.status}">${order.status.toUpperCase()}</span>
          </div>
        `;
      }).join('') : '<div class="text-center py-8 text-gray-500 text-sm">Nenhuma ordem registrada</div>';

      document.getElementById('dashboard-recent-orders').innerHTML = ordersHtml;

      // Recent Lancamentos
      const recentLancamentos = allData.filter(item => item.type === 'lancamento')
        .sort((a, b) => new Date(b.created_at) - new Date(a.created_at))
        .slice(0, 5);

      const lancamentosHtml = recentLancamentos.length > 0 ? recentLancamentos.map(lanc => {
        const veiculo = allData.find(v => v.type === 'vehicle' && v.id === lanc.veiculo_id);
        return `
          <div class="summary-card p-4 flex items-center justify-between">
            <div>
              <div class="flex items-center gap-2">
                <span class="text-xl">${lanc.tipo_lancamento === 'abastecimento' ? '‚õΩ' : 'üí∏'}</span>
                <div>
                  <div class="font-bold text-gray-900">${lanc.descricao}</div>
                  <div class="text-sm text-gray-600">${veiculo ? veiculo.placa : '-'}</div>
                </div>
              </div>
            </div>
            <div class="font-bold gradient-text">${formatCurrency(lanc.valor)}</div>
          </div>
        `;
      }).join('') : '<div class="text-center py-8 text-gray-500 text-sm">Nenhum lan√ßamento registrado</div>';

      document.getElementById('dashboard-recent-lancamentos').innerHTML = lancamentosHtml;
    }

    function updateOrdersList() {
      const orders = getFilteredOrders();
      const container = document.getElementById('orders-list');
      
      if (orders.length === 0) {
        container.innerHTML = '<div class="text-center py-16 text-gray-500">Nenhuma ordem de servi√ßo encontrada.</div>';
        document.getElementById('orders-selected-count').textContent = '0 selecionadas';
        document.getElementById('btn-delete-selected').disabled = true;
        document.getElementById('btn-edit-selected').disabled = true;
        return;
      }

      container.innerHTML = orders.map(order => {
        const veiculo = allData.find(v => v.type === 'vehicle' && v.id === order.veiculo_id);
        const motorista = allData.find(m => m.type === 'driver' && m.id === order.motorista_id);
        const isSelected = selectedOrders.has(order.__backendId);
        
        return `
          <div class="card-modern p-6 flex items-center gap-5 ${isSelected ? 'ring-2 ring-blue-500' : ''}">
            <input type="checkbox" class="modern-checkbox" ${isSelected ? 'checked' : ''} 
              onchange="toggleOrderSelection('${order.__backendId}')">
            <div class="flex-1">
              <div class="flex items-center gap-3 mb-3">
                <span class="badge-numero-os">OS ${getOrderNumber(order)}</span>
                <span class="status-${order.status}">${order.status.toUpperCase()}</span>
              </div>
              <div class="text-sm text-gray-700 mb-2"><strong>Ve√≠culo:</strong> ${veiculo ? `${veiculo.placa} - ${veiculo.modelo}` : '-'}</div>
              <div class="text-sm text-gray-700 mb-2"><strong>Motorista:</strong> ${motorista ? motorista.nome : '-'}</div>
              <div class="text-sm text-gray-700 mb-2"><strong>Descri√ß√£o:</strong> ${order.descricao}</div>
              <div class="text-xs text-gray-500">Abertura: ${formatDate(order.data_abertura)} ${order.data_fechamento ? '‚Ä¢ Fechamento: ' + formatDate(order.data_fechamento) : ''}</div>
            </div>
            <div class="flex gap-2">
              <button onclick="editOrderDirect('${order.__backendId}')" class="w-10 h-10 flex items-center justify-center rounded-xl text-blue-600 hover:bg-blue-50 transition-all" title="Editar">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                  <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
              </button>
              <button onclick="printOrderDirect('${order.__backendId}')" class="w-10 h-10 flex items-center justify-center rounded-xl text-purple-600 hover:bg-purple-50 transition-all" title="Imprimir">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="6 9 6 2 18 2 18 9"></polyline>
                  <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
                  <rect x="6" y="14" width="12" height="8"></rect>
                </svg>
              </button>
              ${order.status !== 'fechada' ? `
                <button onclick="closeOrderDirect('${order.__backendId}')" class="w-10 h-10 flex items-center justify-center rounded-xl text-green-600 hover:bg-green-50 transition-all" title="Fechar OS">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="20 6 9 17 4 12"></polyline>
                  </svg>
                </button>
              ` : `
                <button onclick="reopenOrderDirect('${order.__backendId}')" class="w-10 h-10 flex items-center justify-center rounded-xl text-orange-600 hover:bg-orange-50 transition-all" title="Reabrir OS">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/>
                  </svg>
                </button>
              `}
            </div>
          </div>
        `;
      }).join('');

      document.getElementById('orders-selected-count').textContent = `${selectedOrders.size} selecionada${selectedOrders.size !== 1 ? 's' : ''}`;
      document.getElementById('btn-delete-selected').disabled = selectedOrders.size === 0;
      document.getElementById('btn-edit-selected').disabled = selectedOrders.size !== 1;
      document.getElementById('btn-print-selected').disabled = selectedOrders.size !== 1;
      
      // Update select-all checkbox
      const selectAllCheckbox = document.getElementById('select-all-orders');
      if (selectAllCheckbox) {
        const filteredOrders = getFilteredOrders();
        selectAllCheckbox.checked = filteredOrders.length > 0 && selectedOrders.size === filteredOrders.length;
      }
    }

    function updateContasList() {
      const contas = getFilteredContas();
      const container = document.getElementById('contas-list');
      const hoje = new Date().toISOString().split('T')[0];
      
      if (contas.length === 0) {
        container.innerHTML = '<div class="text-center py-16 text-gray-500">Nenhuma conta encontrada.</div>';
        document.getElementById('contas-selected-count').textContent = '0 selecionadas';
        document.getElementById('contas-selected-total').textContent = 'R$ 0,00';
        document.getElementById('btn-delete-conta').disabled = true;
        document.getElementById('btn-edit-conta').disabled = true;
        document.getElementById('btn-pay-selected').disabled = true;
        document.getElementById('btn-agrupar-conta').disabled = true;
        document.getElementById('btn-renegociar').disabled = true;
        return;
      }

      container.innerHTML = contas.map(conta => {
        const fornecedor = allData.find(f => f.type === 'supplier' && f.id === conta.fornecedor_id);
        const isSelected = selectedContas.has(conta.__backendId);
        const isVencida = !conta.pago && conta.data_vencimento < hoje;
        
        return `
          <div class="card-modern p-6 flex items-center gap-5 ${isSelected ? 'ring-2 ring-blue-500' : ''}">
            <input type="checkbox" class="modern-checkbox" ${isSelected ? 'checked' : ''} 
              onchange="toggleContaSelection('${conta.__backendId}')">
            <div class="flex-1">
              <div class="flex items-center gap-3 mb-3">
                ${conta.pago ? 
                  '<span class="px-3 py-1 rounded-full text-xs font-bold bg-green-100 text-green-700">‚úì PAGO</span>' : 
                  isVencida ?
                    '<span class="px-3 py-1 rounded-full text-xs font-bold bg-red-100 text-red-700">‚ö† VENCIDA</span>' :
                    '<span class="px-3 py-1 rounded-full text-xs font-bold bg-yellow-100 text-yellow-700">‚è≥ PENDENTE</span>'
                }
                ${conta.agrupada ? '<span class="px-3 py-1 rounded-full text-xs font-bold bg-purple-100 text-purple-700">ÔøΩÔøΩÔøΩÔøΩ AGRUPADA</span>' : ''}
                ${conta.renegociada ? '<span class="px-3 py-1 rounded-full text-xs font-bold bg-blue-100 text-blue-700">üîÑ RENEGOCIADA</span>' : ''}
              </div>
              <div class="text-lg font-bold text-gray-900 mb-2">${conta.descricao}</div>
              <div class="text-sm text-gray-700 mb-1"><strong>Fornecedor:</strong> ${fornecedor ? fornecedor.razao_social : '-'}</div>
              <div class="text-sm text-gray-700 mb-1"><strong>Vencimento:</strong> ${formatDate(conta.data_vencimento)}</div>
              ${conta.nota_fiscal ? `<div class="text-sm text-gray-700"><strong>NF:</strong> ${conta.nota_fiscal}</div>` : ''}
              ${conta.pago ? `<div class="text-xs text-green-600 mt-2">Pago em: ${formatDate(conta.data_pagamento)}</div>` : ''}
            </div>
            <div class="text-2xl font-bold gradient-text">${formatCurrency(conta.valor)}</div>
          </div>
        `;
      }).join('');

      const selectedTotal = Array.from(selectedContas).reduce((sum, id) => {
        const conta = allData.find(c => c.__backendId === id);
        return sum + (conta ? conta.valor : 0);
      }, 0);

      document.getElementById('contas-selected-count').textContent = `${selectedContas.size} selecionada${selectedContas.size !== 1 ? 's' : ''}`;
      document.getElementById('contas-selected-total').textContent = formatCurrency(selectedTotal);
      document.getElementById('btn-delete-conta').disabled = selectedContas.size === 0;
      document.getElementById('btn-edit-conta').disabled = selectedContas.size !== 1;
      document.getElementById('btn-pay-selected').disabled = selectedContas.size === 0;
      document.getElementById('btn-agrupar-conta').disabled = selectedContas.size < 2;
      document.getElementById('btn-renegociar').disabled = selectedContas.size !== 1;
    }

    function updateLancamentosList() {
      const lancamentos = allData.filter(item => item.type === 'lancamento')
        .sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
      const container = document.getElementById('all-lancamentos-list');
      
      if (lancamentos.length === 0) {
        container.innerHTML = '<div class="text-center py-16 text-gray-500">Nenhum lan√ßamento registrado.</div>';
        return;
      }

      container.innerHTML = lancamentos.map(lanc => {
        const veiculo = allData.find(v => v.type === 'vehicle' && v.id === lanc.veiculo_id);
        const fornecedor = allData.find(f => f.type === 'supplier' && f.id === lanc.fornecedor_id);
        const ordem = lanc.ordem_id ? allData.find(o => o.type === 'order' && o.id === lanc.ordem_id) : null;
        
        return `
          <div class="card-modern p-6">
            <div class="flex items-start gap-4">
              <div class="text-4xl">${lanc.tipo_lancamento === 'abastecimento' ? '‚õΩ' : 'üí∏'}</div>
              <div class="flex-1">
                <div class="flex items-center gap-3 mb-2">
                  <h4 class="text-lg font-bold text-gray-900">${lanc.descricao}</h4>
                  <span class="px-3 py-1 rounded-full text-xs font-bold ${lanc.tipo_lancamento === 'abastecimento' ? 'bg-blue-100 text-blue-700' : 'bg-orange-100 text-orange-700'}">${lanc.tipo_lancamento === 'abastecimento' ? 'ABASTECIMENTO' : 'DESPESA'}</span>
                </div>
                <div class="grid grid-cols-2 gap-x-6 gap-y-2 text-sm text-gray-700">
                  <div><strong>Ve√≠culo:</strong> ${veiculo ? `${veiculo.placa} - ${veiculo.modelo}` : '-'}</div>
                  <div><strong>Fornecedor:</strong> ${fornecedor ? fornecedor.razao_social : '-'}</div>
                  ${lanc.litros ? `<div><strong>Litros:</strong> ${lanc.litros} L</div>` : ''}
                  <div><strong>Vencimento:</strong> ${formatDate(lanc.data_vencimento)}</div>
                  ${lanc.nota_fiscal ? `<div><strong>NF:</strong> ${lanc.nota_fiscal}</div>` : ''}
                  ${ordem ? `<div><strong>Ordem:</strong> OS ${getOrderNumber(ordem)}</div>` : ''}
                </div>
              </div>
              <div class="text-2xl font-bold gradient-text">${formatCurrency(lanc.valor)}</div>
            </div>
          </div>
        `;
      }).join('');
    }

    function updateVehiclesList() {
      const vehicles = allData.filter(item => item.type === 'vehicle');
      const container = document.getElementById('vehicles-list');
      
      if (vehicles.length === 0) {
        container.innerHTML = '<div class="text-center py-16 text-gray-500">Nenhum ve√≠culo cadastrado. Clique no botÔøΩÔøΩo + para come√ßar.</div>';
        document.getElementById('vehicles-selected-count').textContent = '0 selecionados';
        document.getElementById('btn-delete-vehicles').disabled = true;
        document.getElementById('btn-edit-vehicle').disabled = true;
        document.getElementById('select-all-vehicles').checked = false;
        return;
      }

      container.innerHTML = vehicles.map(vehicle => {
        const isSelected = selectedVehicles.has(vehicle.__backendId);
        
        return `
          <div class="card-modern p-6 flex items-center gap-5 ${isSelected ? 'ring-2 ring-blue-500' : ''}">
            <input type="checkbox" class="modern-checkbox" ${isSelected ? 'checked' : ''} 
              onchange="toggleVehicleSelection('${vehicle.__backendId}')">
            <div class="icon-circle">üöó</div>
            <div class="flex-1">
              <div class="text-xl font-bold text-gray-900 mb-2">${vehicle.placa}</div>
              <div class="text-sm text-gray-700">${vehicle.modelo} ‚Ä¢ ${vehicle.ano} ‚Ä¢ ${vehicle.cor}</div>
              ${vehicle.chassi ? `<div class="text-xs text-gray-500 mt-1">Chassi: ${vehicle.chassi}</div>` : ''}
            </div>
          </div>
        `;
      }).join('');

      document.getElementById('vehicles-selected-count').textContent = `${selectedVehicles.size} selecionado${selectedVehicles.size !== 1 ? 's' : ''}`;
      document.getElementById('btn-delete-vehicles').disabled = selectedVehicles.size === 0;
      document.getElementById('btn-edit-vehicle').disabled = selectedVehicles.size !== 1;
      
      // Update select-all checkbox
      const selectAllCheckbox = document.getElementById('select-all-vehicles');
      if (selectAllCheckbox) {
        selectAllCheckbox.checked = vehicles.length > 0 && selectedVehicles.size === vehicles.length;
      }
    }

    function updateDriversList() {
      const drivers = allData.filter(item => item.type === 'driver');
      const container = document.getElementById('drivers-list');
      
      if (drivers.length === 0) {
        container.innerHTML = '<div class="text-center py-16 text-gray-500">Nenhum motorista cadastrado. Clique no bot√£o + para come√ßar.</div>';
        document.getElementById('drivers-selected-count').textContent = '0 selecionados';
        document.getElementById('btn-delete-drivers').disabled = true;
        document.getElementById('btn-edit-driver').disabled = true;
        document.getElementById('select-all-drivers').checked = false;
        return;
      }

      container.innerHTML = drivers.map(driver => {
        const isSelected = selectedDrivers.has(driver.__backendId);
        
        return `
          <div class="card-modern p-6 flex items-center gap-5 ${isSelected ? 'ring-2 ring-blue-500' : ''}">
            <input type="checkbox" class="modern-checkbox" ${isSelected ? 'checked' : ''} 
              onchange="toggleDriverSelection('${driver.__backendId}')">
            <div class="icon-circle">üë§</div>
            <div class="flex-1">
              <div class="text-xl font-bold text-gray-900 mb-2">${driver.nome}</div>
              <div class="text-sm text-gray-700">CNH: ${driver.cnh} ‚Ä¢ Categoria: ${driver.categoria_cnh}</div>
              <div class="text-sm text-gray-700">CPF: ${driver.cpf} ‚Ä¢ Tel: ${driver.telefone}</div>
            </div>
          </div>
        `;
      }).join('');

      document.getElementById('drivers-selected-count').textContent = `${selectedDrivers.size} selecionado${selectedDrivers.size !== 1 ? 's' : ''}`;
      document.getElementById('btn-delete-drivers').disabled = selectedDrivers.size === 0;
      document.getElementById('btn-edit-driver').disabled = selectedDrivers.size !== 1;
      
      // Update select-all checkbox
      const selectAllCheckbox = document.getElementById('select-all-drivers');
      if (selectAllCheckbox) {
        selectAllCheckbox.checked = drivers.length > 0 && selectedDrivers.size === drivers.length;
      }
    }

    function updateSuppliersList() {
      const suppliers = allData.filter(item => item.type === 'supplier');
      const container = document.getElementById('fornecedores-list');
      
      if (suppliers.length === 0) {
        container.innerHTML = '<div class="text-center py-16 text-gray-500">Nenhum fornecedor cadastrado. Clique no bot√£o + para come√ßar.</div>';
        document.getElementById('suppliers-selected-count').textContent = '0 selecionados';
        document.getElementById('btn-delete-suppliers').disabled = true;
        document.getElementById('btn-edit-supplier').disabled = true;
        document.getElementById('select-all-suppliers').checked = false;
        return;
      }

      container.innerHTML = suppliers.map(supplier => {
        const isSelected = selectedSuppliers.has(supplier.__backendId);
        const categoriaEmoji = {
          posto: '‚õΩ',
          oficina: 'üîß',
          borracharia: 'üõû',
          concessionaria: 'ÔøΩÔøΩ',
          autoeletrica: '‚ö°',
          funilaria: 'üé®',
          lavagem: 'üßº',
          pecas: '‚öôÔ∏è',
          seguros: 'üõ°Ô∏è',
          outros: 'üè¢'
        };
        
        return `
          <div class="card-modern p-6 flex items-center gap-5 ${isSelected ? 'ring-2 ring-blue-500' : ''}">
            <input type="checkbox" class="modern-checkbox" ${isSelected ? 'checked' : ''} 
              onchange="toggleSupplierSelection('${supplier.__backendId}')">
            <div class="icon-circle">${categoriaEmoji[supplier.categoria] || 'üè¢'}</div>
            <div class="flex-1">
              <div class="text-xl font-bold text-gray-900 mb-2">${supplier.razao_social}</div>
              <div class="text-sm text-gray-700">CNPJ: ${supplier.cnpj} ‚Ä¢ ${supplier.categoria}</div>
              ${supplier.telefone ? `<div class="text-sm text-gray-700">Tel: ${supplier.telefone}</div>` : ''}
            </div>
          </div>
        `;
      }).join('');

      document.getElementById('suppliers-selected-count').textContent = `${selectedSuppliers.size} selecionado${selectedSuppliers.size !== 1 ? 's' : ''}`;
      document.getElementById('btn-delete-suppliers').disabled = selectedSuppliers.size === 0;
      document.getElementById('btn-edit-supplier').disabled = selectedSuppliers.size !== 1;
      
      // Update select-all checkbox
      const selectAllCheckbox = document.getElementById('select-all-suppliers');
      if (selectAllCheckbox) {
        selectAllCheckbox.checked = suppliers.length > 0 && selectedSuppliers.size === suppliers.length;
      }
    }

    // Toggle Selection Functions
    function toggleOrderSelection(id) {
      if (selectedOrders.has(id)) {
        selectedOrders.delete(id);
      } else {
        selectedOrders.add(id);
      }
      updateUI();
    }

    function toggleContaSelection(id) {
      if (selectedContas.has(id)) {
        selectedContas.delete(id);
      } else {
        selectedContas.add(id);
      }
      updateUI();
    }

    function toggleVehicleSelection(id) {
      if (selectedVehicles.has(id)) {
        selectedVehicles.delete(id);
      } else {
        selectedVehicles.add(id);
      }
      updateUI();
    }

    function toggleDriverSelection(id) {
      if (selectedDrivers.has(id)) {
        selectedDrivers.delete(id);
      } else {
        selectedDrivers.add(id);
      }
      updateUI();
    }

    function toggleSupplierSelection(id) {
      if (selectedSuppliers.has(id)) {
        selectedSuppliers.delete(id);
      } else {
        selectedSuppliers.add(id);
      }
      updateUI();
    }

    function toggleSelectAllVehicles() {
      const vehicles = allData.filter(item => item.type === 'vehicle');
      const checkbox = document.getElementById('select-all-vehicles');
      
      if (checkbox.checked) {
        vehicles.forEach(v => selectedVehicles.add(v.__backendId));
      } else {
        selectedVehicles.clear();
      }
      updateUI();
    }

    function toggleSelectAllDrivers() {
      const drivers = allData.filter(item => item.type === 'driver');
      const checkbox = document.getElementById('select-all-drivers');
      
      if (checkbox.checked) {
        drivers.forEach(d => selectedDrivers.add(d.__backendId));
      } else {
        selectedDrivers.clear();
      }
      updateUI();
    }

    function toggleSelectAllSuppliers() {
      const suppliers = allData.filter(item => item.type === 'supplier');
      const checkbox = document.getElementById('select-all-suppliers');
      
      if (checkbox.checked) {
        suppliers.forEach(s => selectedSuppliers.add(s.__backendId));
      } else {
        selectedSuppliers.clear();
      }
      updateUI();
    }

    function toggleSelectAllOrders() {
      const orders = getFilteredOrders();
      const checkbox = document.getElementById('select-all-orders');
      
      if (checkbox.checked) {
        orders.forEach(o => selectedOrders.add(o.__backendId));
      } else {
        selectedOrders.clear();
      }
      updateUI();
    }

    // Initialize
    loadFromLocalStorage();
    
    // Load dark mode preference
    const savedDarkMode = localStorage.getItem('wefrotas_dark_mode');
    if (savedDarkMode === 'true') {
      document.body.classList.add('dark-mode');
      const btn = document.getElementById('dark-mode-btn');
      btn.innerHTML = '<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>';
    }
    
    updateUI();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b88255b279ea42d',t:'MTc2NzUwMjU1MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
