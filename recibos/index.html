<!doctype html>
<html lang="pt-BR">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gerador de Recibos</title>
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 40px;
      background-color: #f7f7f7;
      width: 100%;
    }

    html, body {
      width: 100%;
      height: 100%;
    }

    .recibo {
      border: 2px solid #ddd;
      padding: 30px 30px 15px 30px;
      width: 650px;
      min-height: 500px;
      margin: auto;
      margin-bottom: 40px;
      background-color: #fff;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      page-break-after: always;
    }

    .topo {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 30px;
      margin-top: -20px;
      position: relative;
    }

    .titulo {
      font-size: 28px;
      font-weight: bold;
    }

    .valor-topo {
      font-size: 14px;
      text-align: right;
      position: absolute;
      right: 0;
    }

    .valor-topo label {
      font-weight: bold;
    }

    .valor-topo input {
      border: 2px solid #007BFF;
      border-radius: 8px;
      padding: 4px 6px;
      background-color: #eef6ff;
      font-weight: bold;
      font-size: 14px;
      width: 120px;
      outline: none;
    }

    .linha {
      margin: 6px 0;
      font-size: 16px;
    }

    input {
      border: none;
      border-bottom: 1px solid #ccc;
      width: 100%;
      font-size: 16px;
      outline: none;
      padding: 2px 4px;
      background-color: transparent;
    }

    textarea {
      border: none;
      border-bottom: 1px solid #ccc;
      width: 100%;
      font-size: 16px;
      outline: none;
      padding: 2px 4px;
      background-color: transparent;
      resize: none;
      overflow: hidden;
      line-height: 1.4em;
      min-height: 1.4em;
      font-family: inherit;
    }

    .assinatura {
      margin-top: 30px;
      text-align: center;
    }

    .assinatura-linha {
      border-bottom: 1px solid #000;
      width: 300px;
      margin: 0 auto;
      height: 30px;
    }

    .assinatura-nome {
      margin-top: 5px;
      font-size: 14px;
      font-weight: bold;
      min-height: 20px;
      max-height: 20px;
      overflow: hidden;
    }

    .linha-horizontal {
      display: flex;
      gap: 20px;
      align-items: center;
    }

    .linha-horizontal .campo-pequeno {
      flex: 1;
    }

    .botoes {
      text-align: center;
      margin-top: 40px;
      display: flex;
      justify-content: center;
      gap: 20px;
    }

    .botoes button {
      border: none;
      padding: 12px 24px;
      border-radius: 30px;
      font-size: 16px;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      transition: background 0.3s ease;
    }

    .botoes button:hover {
      opacity: 0.9;
    }

    .botoes .imprimir {
      background: linear-gradient(to right, #007BFF, #0056b3);
      color: #fff;
    }

    .botoes .limpar {
      background: linear-gradient(to right, #dc3545, #a71d2a);
      color: #fff;
    }

    .botoes .importar {
      background: linear-gradient(to right, #10b981, #059669);
      color: #fff;
    }

    @page {
      size: A4 portrait;
      margin: 0;
    }

    @media print {
      .botoes {
        display: none !important;
      }

      body {
        margin: 0 !important;
        padding: 0 !important;
        background: white !important;
      }

      .recibo {
        width: 180mm !important;
        min-height: auto !important;
        max-height: none !important;
        margin: 10mm auto !important;
        page-break-after: always;
        border: none !important;
        box-shadow: none !important;
      }

      * {
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <header class="sr-only">
   <h1>Gerador de Recibos</h1>
  </header>
  <main><!-- Recibo original visível, editável manualmente -->
   <section class="recibo" id="recibo">
    <div class="topo">
     <div class="titulo" id="titulo-recibo">
      RECIBO
     </div>
     <div class="valor-topo"><label for="valor">VALOR</label><br><input type="text" id="valor" aria-label="Valor do recibo">
     </div>
    </div>
    <div class="linha"><label for="recebedor">Recebi (emos) de</label> <input type="text" id="recebedor" aria-label="Nome de quem pagou">
    </div>
    <div class="linha"><label for="campoQuantia">a quantia de</label> <textarea id="campoQuantia" readonly aria-label="Valor por extenso"></textarea>
    </div>
    <div class="linha"><label for="referencia">Referente a</label> <input type="text" id="referencia" aria-label="Referência do pagamento">
    </div>
    <div class="linha"><input type="text" id="descricao" aria-label="Descrição adicional">
    </div>
    <div class="linha"><label for="emitente">Emitente:</label> <input type="text" id="emitente" aria-label="Nome do emitente">
    </div>
    <div class="linha-horizontal">
     <div class="campo-pequeno"><label for="cpfcnpj">CPF/CNPJ:</label> <input type="text" id="cpfcnpj" aria-label="CPF ou CNPJ do emitente">
     </div>
     <div class="campo-pequeno"><label for="data">Data:</label> <input type="text" id="data" placeholder="dd/mm/aaaa" aria-label="Data do recibo">
     </div>
    </div>
    <div class="linha">
     e para clareza firmo (amos) o presente.
    </div>
    <div class="assinatura">
     <div class="assinatura-linha"></div>
     <div class="assinatura-nome" id="assinaturaNome"></div>
     <div class="assinatura-nome" id="assinaturaCpf"></div>
    </div>
   </section><!-- MODELO oculto para gerar novos recibos -->
   <section class="recibo" id="modelo-recibo" style="display: none" aria-hidden="true">
    <div class="topo">
     <div class="titulo titulo-modelo">
      RECIBO
     </div>
     <div class="valor-topo"><label>VALOR</label><br><input type="text" class="valor">
     </div>
    </div>
    <div class="linha">
     Recebi (emos) de <input type="text" class="recebedor">
    </div>
    <div class="linha">
     a quantia de <textarea class="campoQuantia" readonly></textarea>
    </div>
    <div class="linha">
     Referente a <input type="text" class="referencia">
    </div>
    <div class="linha">
     <input type="text" class="descricao">
    </div>
    <div class="linha">
     Emitente: <input type="text" class="emitente">
    </div>
    <div class="linha-horizontal">
     <div class="campo-pequeno">
      CPF/CNPJ: <input type="text" class="cpfcnpj">
     </div>
     <div class="campo-pequeno">
      Data: <input type="text" class="data" placeholder="dd/mm/aaaa">
     </div>
    </div>
    <div class="linha">
     e para clareza firmo (amos) o presente.
    </div>
    <div class="assinatura">
     <div class="assinatura-linha"></div>
     <div class="assinatura-nome assinaturaNome"></div>
     <div class="assinatura-nome assinaturaCpf"></div>
    </div>
   </section><!-- Contêiner para os recibos importados -->
   <div id="recibos-gerados"></div>
  </main>
  <footer class="botoes"><button class="imprimir" onclick="imprimirPagina()">Imprimir Recibos</button> <button class="limpar" onclick="limparCampos()">Limpar Tudo</button> <button class="importar" onclick="document.getElementById('excelFile').click()">Importar Dados</button> <input type="file" id="excelFile" accept=".xlsx, .xls" style="display: none" onchange="importarExcel(event)">
  </footer>
  <script>
    // Função de impressão segura
    function imprimirPagina() {
      setTimeout(() => {
        window.focus();
        window.print();
      }, 200);
    }

    // Função para converter número para extenso
    function numeroParaExtenso(valor) {
      if (!valor || isNaN(valor) || valor === 0) return '';
      
      const unidades = ['', 'um', 'dois', 'três', 'quatro', 'cinco', 'seis', 'sete', 'oito', 'nove'];
      const dez = ['dez', 'onze', 'doze', 'treze', 'quatorze', 'quinze', 'dezesseis', 'dezessete', 'dezoito', 'dezenove'];
      const dezenas = ['', '', 'vinte', 'trinta', 'quarenta', 'cinquenta', 'sessenta', 'setenta', 'oitenta', 'noventa'];
      const centenas = ['', 'cento', 'duzentos', 'trezentos', 'quatrocentos', 'quinhentos', 'seiscentos', 'setecentos', 'oitocentos', 'novecentos'];
      
      function converterGrupo(n) {
        if (n === 0) return '';
        if (n === 100) return 'cem';
        
        let resultado = '';
        const c = Math.floor(n / 100);
        const d = Math.floor((n % 100) / 10);
        const u = n % 10;
        
        if (c > 0) resultado += centenas[c];
        if (d === 1) {
          if (resultado) resultado += ' e ';
          resultado += dez[u];
          return resultado;
        }
        if (d > 0) {
          if (resultado) resultado += ' e ';
          resultado += dezenas[d];
        }
        if (u > 0) {
          if (resultado) resultado += ' e ';
          resultado += unidades[u];
        }
        return resultado;
      }
      
      const partes = valor.toFixed(2).split('.');
      const reais = parseInt(partes[0]);
      const centavos = parseInt(partes[1]);
      
      let extenso = '';
      
      if (reais === 0) {
        extenso = 'zero reais';
      } else if (reais === 1) {
        extenso = 'um real';
      } else if (reais < 1000) {
        extenso = converterGrupo(reais) + ' reais';
      } else if (reais < 1000000) {
        const milhares = Math.floor(reais / 1000);
        const resto = reais % 1000;
        
        if (milhares === 1) {
          extenso = 'mil';
        } else {
          extenso = converterGrupo(milhares) + ' mil';
        }
        
        if (resto > 0) {
          extenso += ' e ' + converterGrupo(resto);
        }
        extenso += ' reais';
      } else {
        const milhoes = Math.floor(reais / 1000000);
        const resto = reais % 1000000;
        
        if (milhoes === 1) {
          extenso = 'um milhão';
        } else {
          extenso = converterGrupo(milhoes) + ' milhões';
        }
        
        if (resto > 0) {
          if (resto < 1000) {
            extenso += ' e ';
          } else {
            extenso += ', ';
          }
          
          const milhares = Math.floor(resto / 1000);
          const centenas = resto % 1000;
          
          if (milhares > 0) {
            if (milhares === 1) {
              extenso += 'mil';
            } else {
              extenso += converterGrupo(milhares) + ' mil';
            }
            if (centenas > 0) {
              extenso += ' e ' + converterGrupo(centenas);
            }
          } else {
            extenso += converterGrupo(centenas);
          }
        }
        extenso += ' reais';
      }
      
      if (centavos > 0) {
        extenso += ' e ' + converterGrupo(centavos);
        extenso += centavos === 1 ? ' centavo' : ' centavos';
      }
      
      return extenso.charAt(0).toUpperCase() + extenso.slice(1);
    }

    // Formatar moeda
    function formatarMoeda(input) {
      let valor = input.value.replace(/\D/g, '');
      
      if (valor === '') {
        input.value = '';
        const recibo = input.closest('.recibo');
        const campoQuantia = recibo.querySelector('.campoQuantia') || recibo.querySelector('#campoQuantia');
        if (campoQuantia) {
          campoQuantia.value = '';
        }
        return;
      }
      
      const numero = parseInt(valor);
      const reais = numero / 100;
      
      input.value = reais.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      
      const recibo = input.closest('.recibo');
      const campoQuantia = recibo.querySelector('.campoQuantia') || recibo.querySelector('#campoQuantia');
      if (campoQuantia && reais > 0) {
        const extenso = numeroParaExtenso(reais);
        campoQuantia.value = extenso.toUpperCase();
      }
    }

    // Formatar CPF/CNPJ
    function formatarCpfCnpj(input) {
      let valor = input.value.replace(/\D/g, '');
      valor = valor.substring(0, 14);
      
      if (valor.length <= 11) {
        valor = valor.replace(/(\d{3})(\d)/, '$1.$2');
        valor = valor.replace(/(\d{3})(\d)/, '$1.$2');
        valor = valor.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
      } else {
        valor = valor.replace(/^(\d{2})(\d)/, '$1.$2');
        valor = valor.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
        valor = valor.replace(/\.(\d{3})(\d)/, '.$1/$2');
        valor = valor.replace(/(\d{4})(\d)/, '$1-$2');
      }
      
      input.value = valor;
    }

    // Atualizar assinatura do recibo principal
    function atualizarAssinatura() {
      const emitente = document.getElementById('emitente').value;
      const cpfcnpj = document.getElementById('cpfcnpj').value;
      document.getElementById('assinaturaNome').textContent = emitente;
      document.getElementById('assinaturaCpf').textContent = cpfcnpj;
    }

    // Atualizar assinatura de recibos gerados
    function atualizarAssinaturaDireto(input) {
      const recibo = input.closest('.recibo');
      const emitente = recibo.querySelector('.emitente').value;
      const cpfcnpj = recibo.querySelector('.cpfcnpj').value;
      recibo.querySelector('.assinaturaNome').textContent = emitente;
      recibo.querySelector('.assinaturaCpf').textContent = cpfcnpj;
    }

    // Limpar campos
    function limparCampos() {
      document.getElementById('valor').value = '';
      document.getElementById('campoQuantia').value = '';
      document.getElementById('recebedor').value = '';
      document.getElementById('referencia').value = '';
      document.getElementById('descricao').value = '';
      document.getElementById('emitente').value = '';
      document.getElementById('cpfcnpj').value = '';
      document.getElementById('data').value = '';
      document.getElementById('assinaturaNome').textContent = '';
      document.getElementById('assinaturaCpf').textContent = '';
      
      document.getElementById('recibos-gerados').innerHTML = '';
    }

    // Importar Excel
    function importarExcel(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
        const jsonData = XLSX.utils.sheet_to_json(firstSheet);

        const container = document.getElementById('recibos-gerados');
        container.innerHTML = '';

        jsonData.forEach((row, index) => {
          const modelo = document.getElementById('modelo-recibo');
          const novoRecibo = modelo.cloneNode(true);
          novoRecibo.id = 'recibo-' + index;
          novoRecibo.style.display = 'block';

          const tituloConfig = window.elementSdk && window.elementSdk.config ? window.elementSdk.config.titulo_recibo : 'RECIBO';
          novoRecibo.querySelector('.titulo-modelo').textContent = tituloConfig || 'RECIBO';

          if (row.Valor) {
            const valorInput = novoRecibo.querySelector('.valor');
            valorInput.value = row.Valor;
            formatarMoeda(valorInput);
          }
          if (row.Recebedor) novoRecibo.querySelector('.recebedor').value = row.Recebedor;
          if (row.Referencia) novoRecibo.querySelector('.referencia').value = row.Referencia;
          if (row.Descricao) novoRecibo.querySelector('.descricao').value = row.Descricao;
          if (row.Emitente) {
            novoRecibo.querySelector('.emitente').value = row.Emitente;
            novoRecibo.querySelector('.assinaturaNome').textContent = row.Emitente;
          }
          if (row.CPFCNPJ) {
            const cpfInput = novoRecibo.querySelector('.cpfcnpj');
            cpfInput.value = row.CPFCNPJ;
            formatarCpfCnpj(cpfInput);
            novoRecibo.querySelector('.assinaturaCpf').textContent = cpfInput.value;
          }
          if (row.Data) novoRecibo.querySelector('.data').value = row.Data;

          // Adicionar eventos
          novoRecibo.querySelector('.valor').oninput = function() { formatarMoeda(this); };
          novoRecibo.querySelector('.cpfcnpj').oninput = function() { 
            formatarCpfCnpj(this); 
            atualizarAssinaturaDireto(this);
          };
          novoRecibo.querySelector('.emitente').oninput = function() { 
            atualizarAssinaturaDireto(this);
          };

          container.appendChild(novoRecibo);
        });
      };
      reader.readAsArrayBuffer(file);
    }

    // Eventos do recibo principal
    document.getElementById('valor').oninput = function() { formatarMoeda(this); };
    document.getElementById('cpfcnpj').oninput = function() { 
      formatarCpfCnpj(this); 
      atualizarAssinatura();
    };
    document.getElementById('emitente').oninput = function() { 
      atualizarAssinatura();
    };

    // Element SDK
    (function initElementSdk() {
      if (!window.elementSdk) return;

      const defaultConfig = {
        background_color: "#f5f5f5",
        surface_color: "#ffffff",
        text_color: "#000000",
        primary_action_color: "#6366f1",
        secondary_action_color: "#10b981",
        font_family: "Arial",
        font_size: 16,
        titulo_recibo: "RECIBO"
      };

      function applyConfig(config) {
        const cfg = Object.assign({}, defaultConfig, config || {});
        const baseFontStack = "Arial, sans-serif";
        const fontFamily = cfg.font_family + ", " + baseFontStack;

        document.body.style.background = cfg.background_color;
        document.body.style.fontFamily = fontFamily;

        const recibos = document.querySelectorAll('.recibo');
        recibos.forEach(r => {
          r.style.backgroundColor = cfg.surface_color;
          r.style.fontFamily = fontFamily;
        });

        const titulos = document.querySelectorAll('.titulo, .titulo-modelo');
        titulos.forEach(t => {
          t.textContent = cfg.titulo_recibo;
          t.style.color = cfg.primary_action_color;
          t.style.fontFamily = fontFamily;
        });

        const baseSize = Number(cfg.font_size) || 16;
        document.querySelectorAll('.linha, .campo-pequeno').forEach(el => {
          el.style.fontSize = baseSize + 'px';
          el.style.fontFamily = fontFamily;
        });

        document.querySelectorAll('.linha input, .linha textarea, .campo-pequeno input').forEach(el => {
          el.style.fontSize = baseSize + 'px';
          el.style.fontFamily = fontFamily;
          el.style.color = cfg.text_color;
        });

        const buttons = document.querySelectorAll('.botoes button');
        buttons.forEach((btn, index) => {
          btn.style.fontFamily = fontFamily;
          if (btn.classList.contains('imprimir')) btn.style.backgroundColor = cfg.primary_action_color;
          if (btn.classList.contains('importar')) btn.style.backgroundColor = cfg.secondary_action_color;
        });
      }

      window.elementSdk.init({
        defaultConfig,
        onConfigChange: async (config) => {
          applyConfig(config);
        },
        mapToCapabilities: (config) => {
          const cfg = Object.assign({}, defaultConfig, config || {});
          return {
            recolorables: [
              {
                get: () => cfg.background_color,
                set: (value) => window.elementSdk.setConfig({ background_color: value })
              },
              {
                get: () => cfg.surface_color,
                set: (value) => window.elementSdk.setConfig({ surface_color: value })
              },
              {
                get: () => cfg.text_color,
                set: (value) => window.elementSdk.setConfig({ text_color: value })
              },
              {
                get: () => cfg.primary_action_color,
                set: (value) => window.elementSdk.setConfig({ primary_action_color: value })
              },
              {
                get: () => cfg.secondary_action_color,
                set: (value) => window.elementSdk.setConfig({ secondary_action_color: value })
              }
            ],
            borderables: [],
            fontEditable: {
              get: () => cfg.font_family,
              set: (value) => window.elementSdk.setConfig({ font_family: value })
            },
            fontSizeable: {
              get: () => cfg.font_size,
              set: (value) => window.elementSdk.setConfig({ font_size: value })
            }
          };
        },
        mapToEditPanelValues: (config) => {
          const cfg = Object.assign({}, defaultConfig, config || {});
          return new Map([
            ["titulo_recibo", cfg.titulo_recibo]
          ]);
        }
      });

      applyConfig(window.elementSdk.config || defaultConfig);
    })();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a76fc86a563f1a7',t:'MTc2NDYzODI2NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
