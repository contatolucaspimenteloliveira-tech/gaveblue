<!doctype html>
<html lang="pt-BR" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GaveBlue Premium - Cadastro de Assinatura</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    .form-wrapper {
      height: 100%;
      width: 100%;
      overflow-y: auto;
      transition: background-color 0.3s ease;
    }
    .step-slide-in {
      animation: slideInRight 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    .step-slide-out {
      animation: slideOutLeft 0.3s cubic-bezier(0.55, 0.085, 0.68, 0.53);
    }
    @keyframes slideInRight {
      from {
        opacity: 0;
        transform: translateX(40px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }
    @keyframes slideOutLeft {
      from {
        opacity: 1;
        transform: translateX(0);
      }
      to {
        opacity: 0;
        transform: translateX(-40px);
      }
    }
    .progress-bar {
      transition: width 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    .theme-toggle {
      transition: all 0.3s ease;
    }
    .oneui-input:focus {
      transform: translateY(-2px);
    }
    .oneui-button:hover {
      transform: scale(1.02);
    }
    .oneui-button:active {
      transform: scale(0.98);
    }
    select option {
      background-color: #1a2942;
      color: #ffffff;
      padding: 10px;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full">
  <div id="app" class="form-wrapper"></div>
  <script>
    const defaultConfig = {
      background_color: "#0a1628",
      surface_color: "#1a2942",
      text_color: "#ffffff",
      primary_action_color: "#3b82f6",
      secondary_action_color: "#94a3b8",
      font_family: "One UI Sans",
      font_size: 16,
      form_title: "GaveBlue Premium",
      submit_button_text: "Confirmar Cadastro"
    };

    let config = { ...defaultConfig };
    let currentStep = 0;
    let formData = {};
    let stepStatus = {};

    const steps = [
      {
        title: "Informações Pessoais",
        subtitle: "",
        fields: [
          { id: "tipo_pessoa", label: "Tipo de Pessoa", type: "select", options: ["Pessoa Física", "Pessoa Jurídica"], required: true },
          { id: "nome_completo", label: "Nome Completo", type: "text", placeholder: "Digite seu nome completo", required: true },
          { id: "documento", label: "CPF/CNPJ", type: "text", placeholder: "Digite seu documento", required: true }
        ]
      },
      {
        title: "Contato",
        subtitle: "",
        fields: [
          { id: "email", label: "E-mail", type: "email", placeholder: "seu@email.com", required: true },
          { id: "telefone", label: "Telefone", type: "tel", placeholder: "(11) 99999-9999", required: true },
          { id: "melhor_horario_contato", label: "Melhor Horário para Contato", type: "select", options: ["Manhã (8h às 12h)", "Tarde (12h às 18h)", "Noite (18h às 22h)", "Qualquer horário"], required: true }
        ]
      },
      {
        title: "Sobre seu Negócio",
        subtitle: "",
        fields: [
          { id: "tipo_negocio", label: "Tipo de Negócio", type: "select", options: ["Gestão de Frotas", "Transportadora", "Logística", "E-commerce", "Varejo", "Serviços", "Indústria", "Outros"], required: true },
          { id: "tamanho_empresa", label: "Tamanho da Empresa", type: "select", options: ["Autônomo/MEI", "Pequena (até 10 funcionários)", "Média (11-50 funcionários)", "Grande (51-200 funcionários)", "Corporativo (mais de 200)"], required: true }
        ]
      },
      {
        title: "Plano e Pagamento",
        subtitle: "",
        isPlanSelection: true,
        fields: [
          { id: "melhor_data_pagamento", label: "Melhor Data de Vencimento", type: "select", options: ["Dia 5", "Dia 10", "Dia 15", "Dia 20", "Dia 25", "Dia 30", "Último dia útil"], required: true }
        ]
      },
      {
        title: "Acesso ao Sistema",
        subtitle: "",
        canSkip: true,
        fields: [
          { id: "nome_usuario", label: "Nome de Usuário", type: "text", placeholder: "escolha_um_usuario", required: false },
          { id: "senha", label: "Senha", type: "password", placeholder: "Mínimo 6 caracteres", required: false, minlength: 6 },
          { id: "confirmar_senha", label: "Confirmar Senha", type: "password", placeholder: "Digite a senha novamente", required: false, minlength: 6 }
        ]
      },
      {
        title: "Revisão Final",
        subtitle: "",
        isReview: true
      },
      {
        title: "Analisando Cadastro",
        subtitle: "",
        isLoading: true
      },
      {
        title: "Cadastro em Análise",
        subtitle: "",
        isConfirmation: true
      }
    ];

    function renderForm() {
      const app = document.getElementById('app');
      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';
      const baseSize = config.font_size || defaultConfig.font_size;
      const step = steps[currentStep];

      app.style.backgroundColor = config.background_color || defaultConfig.background_color;
      app.style.fontFamily = `${customFont}, ${baseFontStack}`;
      app.style.color = config.text_color || defaultConfig.text_color;

      app.innerHTML = `
        <div class="min-h-full flex flex-col py-3 px-3">
          
          <!-- Header -->
          <div class="max-w-2xl w-full mx-auto mb-1" style="position: sticky; top: 0; background-color: ${config.background_color}; z-index: 10; padding-top: 8px; padding-bottom: 8px;">
            
            <!-- Título Principal -->
            <h1 style="color: ${config.text_color}; font-size: ${baseSize * 1.5}px; font-weight: 700; text-align: center; margin-bottom: 8px; font-family: ${customFont}, ${baseFontStack};">
              ${config.form_title || defaultConfig.form_title}
            </h1>
            
            <!-- Indicador de Etapas -->
            <div style="display: flex; align-items: flex-start; justify-content: space-between; gap: 4px; margin-top: 8px;">
              ${steps.map((s, idx) => {
                let iconContent = '';
                let bgColor = '';
                let iconColor = '';
                let animation = '';
                let cssClass = '';
                let showLabel = idx === currentStep;
                
                if (stepStatus[idx] === 'success') {
                  iconContent = '✓';
                  bgColor = '#10b981';
                  iconColor = 'white';
                  if (idx === currentStep - 1) {
                    cssClass = 'success-icon';
                  }
                } else if (stepStatus[idx] === 'error') {
                  iconContent = '✕';
                  bgColor = '#ef4444';
                  iconColor = 'white';
                  if (idx === currentStep) {
                    cssClass = 'error-icon';
                  }
                } else if (stepStatus[idx] === 'warning') {
                  iconContent = '↻';
                  bgColor = '#fbbf24';
                  iconColor = 'white';
                } else if (idx === currentStep) {
                  iconContent = '↻';
                  bgColor = '#fbbf24';
                  iconColor = 'white';
                  animation = 'spin 1.5s linear infinite';
                } else if (idx < currentStep) {
                  iconContent = '✓';
                  bgColor = config.primary_action_color;
                  iconColor = 'white';
                } else {
                  iconContent = '';
                  bgColor = 'rgba(255, 255, 255, 0.1)';
                  iconColor = config.secondary_action_color;
                }
                
                return `
                <div style="flex: 1; display: flex; flex-direction: column; align-items: center; gap: 4px;">
                  <div style="width: 100%; height: 2px; background-color: ${idx < currentStep ? config.primary_action_color : 'rgba(255, 255, 255, 0.1)'}; border-radius: 2px; transition: all 0.3s;"></div>
                  <div class="${cssClass}" style="width: 36px; height: 36px; border-radius: 18px; background: ${bgColor}; display: flex; align-items: center; justify-content: center; font-size: ${baseSize * 1}px; font-weight: 700; color: ${iconColor}; transition: all 0.3s; box-shadow: ${idx === currentStep ? `0 3px 10px ${bgColor}55` : 'none'}; animation: ${animation};">
                    ${iconContent}
                  </div>
                  <div style="height: 28px; display: flex; align-items: center; justify-content: center;">
                    ${showLabel ? `
                    <p style="color: ${idx === currentStep ? config.text_color : config.secondary_action_color}; font-size: ${baseSize * 0.6}px; font-weight: ${idx === currentStep ? '700' : '500'}; text-align: center; margin: 0; opacity: ${idx === currentStep ? '1' : '0.7'}; transition: all 0.3s; line-height: 1.2;">
                      ${s.title}
                    </p>
                    ` : ''}
                  </div>
                </div>
              `;
              }).join('')}
            </div>
            <style>
              @keyframes spin {
                to { transform: rotate(360deg); }
              }
              @keyframes checkmark {
                0% { transform: scale(0.8); opacity: 0.5; }
                50% { transform: scale(1.2); }
                100% { transform: scale(1); opacity: 1; }
              }
              @keyframes errorShake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-5px); }
                75% { transform: translateX(5px); }
              }
              .success-icon { animation: checkmark 0.5s ease-out; }
              .error-icon { animation: errorShake 0.4s ease-out; }
            </style>
          </div>

          <!-- Card Principal -->
          <div class="max-w-2xl w-full mx-auto flex-1" style="display: flex; align-items: flex-start; padding-top: 20px;">
            <div class="step-slide-in" style="background-color: ${config.surface_color}; padding: 16px; border-radius: 20px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3); max-height: 420px; min-height: 320px; width: 100%; overflow-y: auto;">

              ${step.isPlanSelection ? `
                <!-- Seleção de Planos -->
                <form id="step-form" style="display: flex; flex-direction: column; gap: 14px;">
                  
                  <!-- Cards de Planos -->
                  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 8px; margin-bottom: 12px;">
                    
                    <!-- Plano Mensal -->
                    <div class="plan-card" data-plan="Premium Mensal - R$ 59,90/mês" style="background-color: rgba(255, 255, 255, 0.05); padding: 12px; border-radius: 12px; border: 2px solid ${formData.plano_escolhido === 'Premium Mensal - R$ 59,90/mês' ? config.primary_action_color : 'rgba(255, 255, 255, 0.1)'}; cursor: pointer; transition: all 0.2s; position: relative;">
                      ${formData.plano_escolhido === 'Premium Mensal - R$ 59,90/mês' ? `<div style="position: absolute; top: 6px; right: 6px; width: 18px; height: 18px; border-radius: 9px; background: ${config.primary_action_color}; display: flex; align-items: center; justify-content: center; color: white; font-size: 11px; font-weight: 700;">✓</div>` : ''}
                      <div style="position: absolute; top: -6px; right: 6px; background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 2px 6px; border-radius: 6px; font-size: ${config.font_size * 0.55}px; font-weight: 700;">60% OFF</div>
                      <h4 style="color: ${config.text_color}; font-size: ${config.font_size * 0.85}px; font-weight: 700; margin-bottom: 5px;">Mensal</h4>
                      <p style="color: ${config.primary_action_color}; font-size: ${config.font_size * 1.1}px; font-weight: 700; margin-bottom: 3px;">R$ 59,90</p>
                      <p style="color: ${config.secondary_action_color}; font-size: ${config.font_size * 0.7}px;">por mês</p>
                      <p style="color: ${config.secondary_action_color}; font-size: ${config.font_size * 0.6}px; text-decoration: line-through; margin-top: 2px;">De R$ 149,00</p>
                      <p style="color: #10b981; font-size: ${config.font_size * 0.62}px; margin-top: 3px; font-weight: 600; line-height: 1.2;">60% OFF nos 3 primeiros meses</p>
                    </div>

                    <!-- Plano Anual - MAIS VANTAJOSO -->
                    <div class="plan-card" data-plan="Premium Anual - R$ 299,00/ano" style="background: linear-gradient(135deg, ${config.primary_action_color}22, ${config.primary_action_color}11); padding: 12px; border-radius: 12px; border: 2px solid ${formData.plano_escolhido === 'Premium Anual - R$ 299,00/ano' ? config.primary_action_color : config.primary_action_color + '66'}; cursor: pointer; transition: all 0.2s; position: relative; box-shadow: 0 4px 12px ${config.primary_action_color}22;">
                      ${formData.plano_escolhido === 'Premium Anual - R$ 299,00/ano' ? `<div style="position: absolute; top: 6px; right: 6px; width: 18px; height: 18px; border-radius: 9px; background: ${config.primary_action_color}; display: flex; align-items: center; justify-content: center; color: white; font-size: 11px; font-weight: 700;">✓</div>` : ''}
                      <div style="position: absolute; top: -6px; right: 6px; background: linear-gradient(135deg, #ef4444, #dc2626); color: white; padding: 2px 6px; border-radius: 6px; font-size: ${config.font_size * 0.55}px; font-weight: 700;">88% OFF</div>
                      <div style="position: absolute; top: 6px; left: 6px; background: ${config.primary_action_color}; color: white; padding: 2px 5px; border-radius: 5px; font-size: ${config.font_size * 0.55}px; font-weight: 700;">MELHOR</div>
                      <h4 style="color: ${config.text_color}; font-size: ${config.font_size * 0.85}px; font-weight: 700; margin-bottom: 5px; margin-top: 10px;">Anual</h4>
                      <p style="color: ${config.primary_action_color}; font-size: ${config.font_size * 1.1}px; font-weight: 700; margin-bottom: 3px;">R$ 299,00</p>
                      <p style="color: ${config.secondary_action_color}; font-size: ${config.font_size * 0.7}px;">por ano</p>
                      <p style="color: ${config.secondary_action_color}; font-size: ${config.font_size * 0.6}px; text-decoration: line-through; margin-top: 2px;">De R$ 2.499,00</p>
                      <p style="color: #ef4444; font-size: ${config.font_size * 0.62}px; margin-top: 3px; font-weight: 600; line-height: 1.2;">Economia de R$ 420 no ano!</p>
                    </div>

                  </div>

                  <!-- Data de Vencimento -->
                  <div>
                    <label for="melhor_data_pagamento" style="display: block; color: ${config.text_color}; font-size: ${config.font_size * 0.85}px; font-weight: 600; margin-bottom: 6px;">
                      Melhor Data de Vencimento <span style="color: #ff4444;">*</span>
                    </label>
                    <select 
                      id="melhor_data_pagamento" 
                      name="melhor_data_pagamento" 
                      required
                      class="oneui-input" 
                      style="width: 100%; padding: 12px 16px; border-radius: 12px; background-color: rgba(255, 255, 255, 0.08); border: 2px solid rgba(255, 255, 255, 0.1); color: ${config.text_color}; font-size: ${config.font_size * 0.95}px; cursor: pointer; transition: all 0.2s; outline: none;">
                      <option value="" style="background-color: #1a2942; color: #ffffff;">Selecione...</option>
                      ${step.fields[0].options.map(opt => `<option value="${opt}" ${formData.melhor_data_pagamento === opt ? 'selected' : ''} style="background-color: #1a2942; color: #ffffff;">${opt}</option>`).join('')}
                    </select>
                  </div>

                  <!-- Mensagem de Erro -->
                  <div id="error-message" class="hidden" style="background-color: #ff444422; padding: 12px; border-radius: 12px; border-left: 4px solid #ff4444;">
                    <p style="color: #ff6666; font-size: ${config.font_size * 0.85}px; font-weight: 600;">
                      <span>X</span> <span></span>
                    </p>
                  </div>

                  <!-- Botões de Navegação -->
                  <div style="display: flex; gap: 10px; margin-top: 8px;">
                    <button type="button" id="prev-btn" class="oneui-button" style="background-color: ${config.secondary_action_color}22; color: ${config.text_color}; padding: 12px 18px; border-radius: 12px; border: none; cursor: pointer; font-size: ${config.font_size * 0.9}px; font-weight: 600; transition: all 0.2s; flex: 1;">
                      Voltar
                    </button>
                    <button type="submit" id="next-btn" class="oneui-button" style="background: linear-gradient(135deg, ${config.primary_action_color}, ${config.primary_action_color}cc); color: white; padding: 12px 18px; border-radius: 12px; border: none; cursor: pointer; font-size: ${config.font_size * 0.9}px; font-weight: 700; transition: all 0.2s; flex: 2; box-shadow: 0 4px 16px ${config.primary_action_color}44;">
                      Continuar
                    </button>
                  </div>
                </form>
              ` : step.isLoading ? `
                <!-- Tela de Carregamento -->
                <div style="display: flex; align-items: center; justify-content: center; height: 100%; padding: 40px;">
                  <div style="text-align: center;">
                    <div style="width: 80px; height: 80px; display: flex; align-items: center; justify-content: center; margin: 0 auto 24px;">
                      <span style="font-size: 64px; animation: spin 1.5s linear infinite; display: inline-block;">↻</span>
                    </div>
                    <h3 style="color: ${config.text_color}; font-size: ${baseSize * 1.2}px; font-weight: 700; margin-bottom: 10px;">
                      Validando seus dados...
                    </h3>
                    <p style="color: ${config.secondary_action_color}; font-size: ${baseSize * 0.9}px; line-height: 1.6;">
                      Aguarde enquanto verificamos suas informações
                    </p>
                  </div>
                </div>
              ` : step.isConfirmation ? `
                <!-- Tela de Confirmação Final -->
                <div style="text-align: center; padding: 30px 20px;">
                  <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #10b981, #059669); border-radius: 40px; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; box-shadow: 0 8px 32px rgba(16, 185, 129, 0.4); animation: pulse 2s infinite;">
                    <span style="font-size: 44px;">✓</span>
                  </div>
                  <style>
                    @keyframes pulse {
                      0%, 100% { transform: scale(1); }
                      50% { transform: scale(1.05); }
                    }
                  </style>
                  
                  <h3 style="color: #10b981; font-size: ${baseSize * 1.4}px; font-weight: 700; margin-bottom: 10px;">
                    SEUS DADOS FORAM RECEBIDOS
                  </h3>
                  
                  <p style="color: ${config.text_color}; font-size: ${baseSize * 0.95}px; margin-bottom: 20px; line-height: 1.7; padding: 0 10px;">
                    Agora seu cadastro segue em análise. Nosso prazo para retorno é de <strong style="color: ${config.primary_action_color};">7 dias úteis</strong>.
                  </p>
                  
                  <div style="background: linear-gradient(135deg, ${config.primary_action_color}15, ${config.primary_action_color}08); padding: 18px; border-radius: 16px; border-left: 4px solid ${config.primary_action_color}; margin-bottom: 18px;">
                    <p style="color: ${config.text_color}; font-size: ${baseSize * 0.95}px; line-height: 1.7; margin-bottom: 12px;">
                      <strong>Quer agilizar seu processo?</strong>
                    </p>
                    <p style="color: ${config.secondary_action_color}; font-size: ${baseSize * 0.9}px; line-height: 1.7; margin-bottom: 14px;">
                      Caso queira agilizar seu processo e integrar o sistema com mais fluidez, faça o pagamento referente ao plano escolhido e <strong style="color: ${config.text_color};">seu acesso fica disponível em até 24h</strong>!
                    </p>
                    <div style="background-color: rgba(255, 255, 255, 0.08); padding: 14px; border-radius: 12px;">
                      <p style="color: ${config.text_color}; font-size: ${baseSize * 0.85}px; font-weight: 600; margin-bottom: 6px;">
                        Chave PIX para pagamento:
                      </p>
                      <p style="color: ${config.primary_action_color}; font-size: ${baseSize * 1.05}px; font-weight: 700;">
                        financeiro@gaveblue.com
                      </p>
                    </div>
                  </div>
                  
                  <div style="background-color: rgba(255, 255, 255, 0.05); padding: 16px; border-radius: 16px; margin-bottom: 14px;">
                    <p style="color: ${config.text_color}; font-size: ${baseSize * 0.9}px; margin-bottom: 8px; line-height: 1.6;">
                      <strong>Confirmação enviada para:</strong>
                    </p>
                    <p style="color: ${config.primary_action_color}; font-size: ${baseSize * 0.95}px; font-weight: 600;">
                      ${formData.email}
                    </p>
                  </div>
                  
                  <p style="color: ${config.secondary_action_color}; font-size: ${baseSize * 0.8}px; margin-top: 18px;">
                    Obrigado por escolher a GaveBlue!
                  </p>
                  
                  <!-- Botões de Ação Final -->
                  <div style="display: flex; gap: 10px; margin-top: 24px;">
                    <button type="button" id="btn-voltar-site" class="oneui-button" style="background-color: ${config.secondary_action_color}22; color: ${config.text_color}; padding: 12px 18px; border-radius: 12px; border: none; cursor: pointer; font-size: ${baseSize * 0.9}px; font-weight: 600; transition: all 0.2s; flex: 1;">
                      Voltar ao Site
                    </button>
                    <button type="button" id="btn-novo-cadastro" class="oneui-button" style="background: linear-gradient(135deg, ${config.primary_action_color}, ${config.primary_action_color}cc); color: white; padding: 12px 18px; border-radius: 12px; border: none; cursor: pointer; font-size: ${baseSize * 0.9}px; font-weight: 700; transition: all 0.2s; flex: 1; box-shadow: 0 4px 16px ${config.primary_action_color}44;">
                      Novo Cadastro
                    </button>
                  </div>
                </div>
              ` : step.isReview ? `
                <!-- Tela de Revisão -->
                <form id="step-form">
                  <div style="display: flex; flex-direction: column; gap: 10px;">
                    
                    <!-- Informações Pessoais -->
                    <div style="background-color: rgba(255, 255, 255, 0.05); padding: 12px; border-radius: 14px;">
                      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <h3 style="color: ${config.text_color}; font-size: ${baseSize * 0.9}px; font-weight: 600;">
                          Informações Pessoais
                        </h3>
                        <button type="button" class="edit-step-btn oneui-button" data-step="0" style="background-color: ${config.secondary_action_color}22; color: ${config.text_color}; padding: 5px 10px; border-radius: 8px; border: none; cursor: pointer; font-size: ${baseSize * 0.75}px; font-weight: 600; transition: all 0.2s;">
                          Editar
                        </button>
                      </div>
                      <div style="display: flex; flex-direction: column; gap: 4px; font-size: ${baseSize * 0.8}px; color: ${config.secondary_action_color};">
                        <p><strong style="color: ${config.text_color};">Tipo:</strong> ${formData.tipo_pessoa || '-'}</p>
                        <p><strong style="color: ${config.text_color};">Nome:</strong> ${formData.nome_completo || '-'}</p>
                        <p><strong style="color: ${config.text_color};">Documento:</strong> ${formData.documento || '-'}</p>
                      </div>
                    </div>

                    <!-- Contato -->
                    <div style="background-color: rgba(255, 255, 255, 0.05); padding: 12px; border-radius: 14px;">
                      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <h3 style="color: ${config.text_color}; font-size: ${baseSize * 0.9}px; font-weight: 600;">
                          Contato
                        </h3>
                        <button type="button" class="edit-step-btn oneui-button" data-step="1" style="background-color: ${config.secondary_action_color}22; color: ${config.text_color}; padding: 5px 10px; border-radius: 8px; border: none; cursor: pointer; font-size: ${baseSize * 0.75}px; font-weight: 600; transition: all 0.2s;">
                          Editar
                        </button>
                      </div>
                      <div style="display: flex; flex-direction: column; gap: 4px; font-size: ${baseSize * 0.8}px; color: ${config.secondary_action_color};">
                        <p><strong style="color: ${config.text_color};">E-mail:</strong> ${formData.email || '-'}</p>
                        <p><strong style="color: ${config.text_color};">Telefone:</strong> ${formData.telefone || '-'}</p>
                        <p><strong style="color: ${config.text_color};">Horário:</strong> ${formData.melhor_horario_contato || '-'}</p>
                      </div>
                    </div>

                    <!-- Negócio -->
                    <div style="background-color: rgba(255, 255, 255, 0.05); padding: 12px; border-radius: 14px;">
                      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <h3 style="color: ${config.text_color}; font-size: ${baseSize * 0.9}px; font-weight: 600;">
                          Seu Negócio
                        </h3>
                        <button type="button" class="edit-step-btn oneui-button" data-step="2" style="background-color: ${config.secondary_action_color}22; color: ${config.text_color}; padding: 5px 10px; border-radius: 8px; border: none; cursor: pointer; font-size: ${baseSize * 0.75}px; font-weight: 600; transition: all 0.2s;">
                          Editar
                        </button>
                      </div>
                      <div style="display: flex; flex-direction: column; gap: 4px; font-size: ${baseSize * 0.8}px; color: ${config.secondary_action_color};">
                        <p><strong style="color: ${config.text_color};">Tipo:</strong> ${formData.tipo_negocio || '-'}</p>
                        <p><strong style="color: ${config.text_color};">Tamanho:</strong> ${formData.tamanho_empresa || '-'}</p>
                      </div>
                    </div>

                    <!-- Plano -->
                    <div style="background-color: rgba(255, 255, 255, 0.05); padding: 12px; border-radius: 14px;">
                      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <h3 style="color: ${config.text_color}; font-size: ${baseSize * 0.9}px; font-weight: 600;">
                          Plano e Pagamento
                        </h3>
                        <button type="button" class="edit-step-btn oneui-button" data-step="3" style="background-color: ${config.secondary_action_color}22; color: ${config.text_color}; padding: 5px 10px; border-radius: 8px; border: none; cursor: pointer; font-size: ${baseSize * 0.75}px; font-weight: 600; transition: all 0.2s;">
                          Editar
                        </button>
                      </div>
                      <div style="display: flex; flex-direction: column; gap: 4px; font-size: ${baseSize * 0.8}px; color: ${config.secondary_action_color};">
                        <p><strong style="color: ${config.text_color};">Plano:</strong> ${formData.plano_escolhido || '-'}</p>
                        <p><strong style="color: ${config.text_color};">Vencimento:</strong> ${formData.melhor_data_pagamento || '-'}</p>
                      </div>
                    </div>

                    <!-- Acesso -->
                    ${formData.nome_usuario || formData.senha ? `
                    <div style="background-color: rgba(255, 255, 255, 0.05); padding: 12px; border-radius: 14px;">
                      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <h3 style="color: ${config.text_color}; font-size: ${baseSize * 0.9}px; font-weight: 600;">
                          Acesso ao Sistema
                        </h3>
                        <button type="button" class="edit-step-btn oneui-button" data-step="4" style="background-color: ${config.secondary_action_color}22; color: ${config.text_color}; padding: 5px 10px; border-radius: 8px; border: none; cursor: pointer; font-size: ${baseSize * 0.75}px; font-weight: 600; transition: all 0.2s;">
                          Editar
                        </button>
                      </div>
                      <div style="display: flex; flex-direction: column; gap: 4px; font-size: ${baseSize * 0.8}px; color: ${config.secondary_action_color};">
                        <p><strong style="color: ${config.text_color};">Usuário:</strong> ${formData.nome_usuario || '-'}</p>
                        <p><strong style="color: ${config.text_color};">Senha:</strong> ${'●'.repeat(formData.senha?.length || 0)}</p>
                      </div>
                    </div>
                    ` : `
                    <div style="background-color: rgba(255, 255, 255, 0.05); padding: 12px; border-radius: 14px; border-left: 4px solid ${config.secondary_action_color};">
                      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                        <h3 style="color: ${config.text_color}; font-size: ${baseSize * 0.9}px; font-weight: 600;">
                          Acesso ao Sistema
                        </h3>
                        <button type="button" class="edit-step-btn oneui-button" data-step="4" style="background-color: ${config.secondary_action_color}22; color: ${config.text_color}; padding: 5px 10px; border-radius: 8px; border: none; cursor: pointer; font-size: ${baseSize * 0.75}px; font-weight: 600; transition: all 0.2s;">
                          Adicionar
                        </button>
                      </div>
                      <p style="color: ${config.secondary_action_color}; font-size: ${baseSize * 0.8}px;">
                        Etapa pulada - Credenciais serão enviadas por e-mail
                      </p>
                    </div>
                    `}

                    <!-- Info PIX -->
                    <div style="background: linear-gradient(135deg, ${config.primary_action_color}15, ${config.primary_action_color}08); padding: 12px; border-radius: 14px; border-left: 4px solid ${config.primary_action_color};">
                      <p style="color: ${config.text_color}; font-size: ${baseSize * 0.85}px; font-weight: 600; margin-bottom: 4px;">
                        Informações de Pagamento
                      </p>
                      <p style="color: ${config.secondary_action_color}; font-size: ${baseSize * 0.8}px; margin-bottom: 4px;">
                        Após confirmar, envie o pagamento via PIX:
                      </p>
                      <p style="color: ${config.primary_action_color}; font-size: ${baseSize * 0.9}px; font-weight: 600;">
                        financeiro@gaveblue.com
                      </p>
                    </div>

                  </div>

                  <!-- Mensagem de Erro -->
                  <div id="error-message" class="hidden" style="background-color: #ff444422; padding: 12px; border-radius: 12px; border-left: 4px solid #ff4444; margin-top: 14px;">
                    <p style="color: #ff6666; font-size: ${baseSize * 0.85}px; font-weight: 600;">
                      <span>X</span> <span></span>
                    </p>
                  </div>

                  <!-- Botões -->
                  <div style="display: flex; gap: 10px; margin-top: 16px;">
                    <button type="button" id="prev-btn" class="oneui-button" style="background-color: ${config.secondary_action_color}22; color: ${config.text_color}; padding: 12px 18px; border-radius: 12px; border: none; cursor: pointer; font-size: ${baseSize * 0.9}px; font-weight: 600; transition: all 0.2s; flex: 1;">
                      Voltar
                    </button>
                    <button type="submit" id="next-btn" class="oneui-button" style="background: linear-gradient(135deg, ${config.primary_action_color}, ${config.primary_action_color}cc); color: white; padding: 12px 18px; border-radius: 12px; border: none; cursor: pointer; font-size: ${baseSize * 0.9}px; font-weight: 700; transition: all 0.2s; flex: 2; box-shadow: 0 4px 16px ${config.primary_action_color}44;">
                      ${config.submit_button_text || defaultConfig.submit_button_text}
                    </button>
                  </div>
                </form>
              ` : `
                <!-- Formulário de Etapa -->
                <form id="step-form" style="display: flex; flex-direction: column; gap: 12px;">
                  ${step.fields.map(field => `
                    <div>
                      <label for="${field.id}" style="display: block; color: ${config.text_color}; font-size: ${baseSize * 0.85}px; font-weight: 600; margin-bottom: 6px;">
                        ${field.label} ${field.required ? '<span style="color: #ff4444;">*</span>' : ''}
                      </label>
                      ${field.type === 'select' ? `
                        <select 
                          id="${field.id}" 
                          name="${field.id}" 
                          ${field.required ? 'required' : ''}
                          class="oneui-input" 
                          style="width: 100%; padding: 12px 16px; border-radius: 12px; background-color: rgba(255, 255, 255, 0.08); border: 2px solid rgba(255, 255, 255, 0.1); color: ${config.text_color}; font-size: ${baseSize * 0.95}px; cursor: pointer; transition: all 0.2s; outline: none;">
                          <option value="" style="background-color: #1a2942; color: #ffffff;">Selecione...</option>
                          ${field.options.map(opt => `<option value="${opt}" ${formData[field.id] === opt ? 'selected' : ''} style="background-color: #1a2942; color: #ffffff;">${opt}</option>`).join('')}
                        </select>
                      ` : `
                        <input 
                          type="${field.type}" 
                          id="${field.id}" 
                          name="${field.id}" 
                          ${field.required ? 'required' : ''}
                          ${field.minlength ? `minlength="${field.minlength}"` : ''}
                          placeholder="${field.placeholder || ''}"
                          value="${formData[field.id] || ''}"
                          class="oneui-input" 
                          style="width: 100%; padding: 12px 16px; border-radius: 12px; background-color: rgba(255, 255, 255, 0.08); border: 2px solid rgba(255, 255, 255, 0.1); color: ${config.text_color}; font-size: ${baseSize * 0.95}px; transition: all 0.2s; outline: none;">
                      `}
                    </div>
                  `).join('')}

                  <!-- Mensagem de Erro -->
                  <div id="error-message" class="hidden" style="background-color: #ff444422; padding: 12px; border-radius: 12px; border-left: 4px solid #ff4444;">
                    <p style="color: #ff6666; font-size: ${baseSize * 0.85}px; font-weight: 600;">
                      <span>X</span> <span></span>
                    </p>
                  </div>

                  <!-- Botões de Navegação -->
                  <div style="display: flex; gap: 10px; margin-top: 8px;">
                    ${currentStep > 0 ? `
                      <button type="button" id="prev-btn" class="oneui-button" style="background-color: ${config.secondary_action_color}22; color: ${config.text_color}; padding: 12px 18px; border-radius: 12px; border: none; cursor: pointer; font-size: ${baseSize * 0.9}px; font-weight: 600; transition: all 0.2s; flex: 1;">
                        Voltar
                      </button>
                    ` : ''}
                    ${step.canSkip ? `
                      <button type="button" id="skip-btn" class="oneui-button" style="background-color: transparent; border: 2px solid ${config.secondary_action_color}44; color: ${config.secondary_action_color}; padding: 12px 18px; border-radius: 12px; cursor: pointer; font-size: ${baseSize * 0.9}px; font-weight: 600; transition: all 0.2s; flex: 1;">
                        Pular
                      </button>
                    ` : ''}
                    <button type="submit" id="next-btn" class="oneui-button" style="background: linear-gradient(135deg, ${config.primary_action_color}, ${config.primary_action_color}cc); color: white; padding: 12px 18px; border-radius: 12px; border: none; cursor: pointer; font-size: ${baseSize * 0.9}px; font-weight: 700; transition: all 0.2s; flex: 2; box-shadow: 0 4px 16px ${config.primary_action_color}44;">
                      Continuar
                    </button>
                  </div>
                </form>
              `}

            </div>
          </div>

        </div>


      `;

      setupHandlers();
    }

    function setupHandlers() {
      const form = document.getElementById('step-form');
      const prevBtn = document.getElementById('prev-btn');
      const skipBtn = document.getElementById('skip-btn');
      const errorMsg = document.getElementById('error-message');
      const editButtons = document.querySelectorAll('.edit-step-btn');

      if (prevBtn) {
        prevBtn.addEventListener('click', () => {
          currentStep--;
          renderForm();
        });
      }

      if (skipBtn) {
        skipBtn.addEventListener('click', () => {
          const currentFields = steps[currentStep].fields;
          if (currentFields) {
            currentFields.forEach(field => {
              delete formData[field.id];
            });
          }
          
          stepStatus[currentStep] = 'success';
          currentStep++;
          renderForm();
        });
      }

      editButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          currentStep = parseInt(btn.getAttribute('data-step'));
          renderForm();
        });
      });

      // Botões da tela final
      const btnVoltarSite = document.getElementById('btn-voltar-site');
      const btnNovoCadastro = document.getElementById('btn-novo-cadastro');
      
      if (btnVoltarSite) {
        btnVoltarSite.addEventListener('click', () => {
          window.open('https://gaveblue.com', '_blank', 'noopener,noreferrer');
        });
      }
      
      if (btnNovoCadastro) {
        btnNovoCadastro.addEventListener('click', () => {
          currentStep = 0;
          formData = {};
          stepStatus = {};
          renderForm();
        });
      }

      const inputs = document.querySelectorAll('.oneui-input');
      inputs.forEach(input => {
        input.addEventListener('focus', (e) => {
          e.target.style.borderColor = config.primary_action_color;
        });
        input.addEventListener('blur', (e) => {
          e.target.style.borderColor = 'rgba(255, 255, 255, 0.1)';
        });
      });

      // Interatividade dos cards de plano
      const planCards = document.querySelectorAll('.plan-card');
      planCards.forEach(card => {
        card.addEventListener('click', () => {
          const planName = card.getAttribute('data-plan');
          formData.plano_escolhido = planName;
          
          // Atualiza visualmente todos os cards
          planCards.forEach(c => {
            const cPlan = c.getAttribute('data-plan');
            if (cPlan === planName) {
              c.style.borderColor = config.primary_action_color;
              c.style.transform = 'scale(1.02)';
            } else {
              c.style.borderColor = cPlan.includes('Anual') ? config.primary_action_color + '66' : 'rgba(255, 255, 255, 0.1)';
              c.style.transform = 'scale(1)';
            }
          });
          
          // Re-renderiza para mostrar checkmark
          renderForm();
        });

        card.addEventListener('mouseenter', () => {
          card.style.transform = 'scale(1.02)';
          card.style.boxShadow = `0 6px 20px ${config.primary_action_color}33`;
        });

        card.addEventListener('mouseleave', () => {
          if (card.getAttribute('data-plan') !== formData.plano_escolhido) {
            card.style.transform = 'scale(1)';
            card.style.boxShadow = card.getAttribute('data-plan').includes('Anual') ? `0 4px 12px ${config.primary_action_color}22` : 'none';
          }
        });
      });

      if (form) {
        form.addEventListener('submit', async (e) => {
          e.preventDefault();
          if (errorMsg) errorMsg.classList.add('hidden');

          if (steps[currentStep].isReview) {
            await submitForm();
            return;
          }

          const formElements = new FormData(form);
          let hasEmptyFields = false;
          const currentStepFields = steps[currentStep].fields || [];
          
          // Verifica se é a etapa de seleção de plano
          if (steps[currentStep].isPlanSelection) {
            if (!formData.plano_escolhido) {
              hasEmptyFields = true;
            }
          }
          
          for (let field of currentStepFields) {
            const value = formElements.get(field.id);
            if (field.required && (!value || value.trim() === '')) {
              hasEmptyFields = true;
              break;
            }
            if (value && value.trim() !== '') {
              formData[field.id] = value;
            }
          }

          if (hasEmptyFields) {
            stepStatus[currentStep] = 'error';
            renderForm();
            
            setTimeout(() => {
              const errorMsg = document.getElementById('error-message');
              if (errorMsg) {
                const errorText = steps[currentStep].isPlanSelection && !formData.plano_escolhido 
                  ? 'Por favor, selecione um plano!'
                  : 'Por favor, preencha todos os campos obrigatórios!';
                errorMsg.querySelector('p span:last-child').textContent = errorText;
                errorMsg.classList.remove('hidden');
              }
            }, 10);
            return;
          }

          if (currentStep === 4) {
            const senha = formData.senha;
            const confirmarSenha = formData.confirmar_senha;
            
            if ((senha || confirmarSenha) && senha !== confirmarSenha) {
              stepStatus[currentStep] = 'error';
              renderForm();
              
              setTimeout(() => {
                const errorMsg = document.getElementById('error-message');
                if (errorMsg) {
                  errorMsg.querySelector('p span:last-child').textContent = 'As senhas não coincidem!';
                  errorMsg.classList.remove('hidden');
                }
              }, 10);
              return;
            }
          }

          // Avança direto para próxima etapa
          stepStatus[currentStep] = 'success';
          currentStep++;
          renderForm();
        });
      }
    }

    async function submitForm() {
      const nextBtn = document.getElementById('next-btn');

      if (nextBtn) {
        nextBtn.disabled = true;
        nextBtn.textContent = 'Enviando...';
        nextBtn.style.opacity = '0.6';
      }

      try {
        // Salva os dados no Firebase Firestore
        if (window.firebaseDb && window.firebaseAddDoc && window.firebaseCollection && window.firebaseTimestamp) {
          const cadastroData = {
            ...formData,
            dataEnvio: window.firebaseTimestamp(),
            status: 'aguardando_analise'
          };

          await window.firebaseAddDoc(
            window.firebaseCollection(window.firebaseDb, 'assinaturas'),
            cadastroData
          );

          console.log('✅ Dados salvos no Firebase com sucesso!');
        }

        // Sucesso - vai para tela de carregamento
        stepStatus[currentStep] = 'success';
        currentStep++;
        renderForm();
        
        // Aguarda 3 segundos e vai para tela de confirmação final
        setTimeout(() => {
          stepStatus[currentStep] = 'success';
          currentStep++;
          stepStatus[currentStep] = 'warning';
          renderForm();
        }, 3000);

      } catch (error) {
        console.error('Erro ao salvar dados:', error);
        const errorMsg = document.getElementById('error-message');
        if (errorMsg) {
          errorMsg.querySelector('p span:last-child').textContent = 'Erro ao enviar. Tente novamente.';
          errorMsg.classList.remove('hidden');
        }
        if (nextBtn) {
          nextBtn.disabled = false;
          nextBtn.textContent = config.submit_button_text || defaultConfig.submit_button_text;
          nextBtn.style.opacity = '1';
        }
      }
    }

    async function onConfigChange(newConfig) {
      Object.assign(config, newConfig);
      renderForm();
    }

    function mapToCapabilities(cfg) {
      return {
        recolorables: [
          {
            get: () => cfg.background_color || defaultConfig.background_color,
            set: (value) => {
              cfg.background_color = value;
              if (window.elementSdk) {
                window.elementSdk.setConfig({ background_color: value });
              }
            }
          },
          {
            get: () => cfg.surface_color || defaultConfig.surface_color,
            set: (value) => {
              cfg.surface_color = value;
              if (window.elementSdk) {
                window.elementSdk.setConfig({ surface_color: value });
              }
            }
          },
          {
            get: () => cfg.text_color || defaultConfig.text_color,
            set: (value) => {
              cfg.text_color = value;
              if (window.elementSdk) {
                window.elementSdk.setConfig({ text_color: value });
              }
            }
          },
          {
            get: () => cfg.primary_action_color || defaultConfig.primary_action_color,
            set: (value) => {
              cfg.primary_action_color = value;
              if (window.elementSdk) {
                window.elementSdk.setConfig({ primary_action_color: value });
              }
            }
          },
          {
            get: () => cfg.secondary_action_color || defaultConfig.secondary_action_color,
            set: (value) => {
              cfg.secondary_action_color = value;
              if (window.elementSdk) {
                window.elementSdk.setConfig({ secondary_action_color: value });
              }
            }
          }
        ],
        borderables: [],
        fontEditable: {
          get: () => cfg.font_family || defaultConfig.font_family,
          set: (value) => {
            cfg.font_family = value;
            if (window.elementSdk) {
              window.elementSdk.setConfig({ font_family: value });
            }
          }
        },
        fontSizeable: {
          get: () => cfg.font_size || defaultConfig.font_size,
          set: (value) => {
            cfg.font_size = value;
            if (window.elementSdk) {
              window.elementSdk.setConfig({ font_size: value });
            }
          }
        }
      };
    }

    function mapToEditPanelValues(cfg) {
      return new Map([
        ["form_title", cfg.form_title || defaultConfig.form_title],
        ["submit_button_text", cfg.submit_button_text || defaultConfig.submit_button_text]
      ]);
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities,
        mapToEditPanelValues
      });
    }

    renderForm();
  </script><!-- Firebase SDK -->
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDZ3yH2UXOo6_i12WgCDgMJM49xw5Src_M",
      authDomain: "gave-blue.firebaseapp.com",
      projectId: "gave-blue",
      storageBucket: "gave-blue.firebasestorage.app",
      messagingSenderId: "525961083996",
      appId: "1:525961083996:web:45e2bcc8101963c61cba99",
      measurementId: "G-BWVVVPMM79S"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const db = getFirestore(app);

    // Disponibiliza o Firestore globalmente para uso na função submitForm
    window.firebaseDb = db;
    window.firebaseAddDoc = addDoc;
    window.firebaseCollection = collection;
    window.firebaseTimestamp = serverTimestamp;

    console.log("✅ Firebase inicializado com sucesso!");
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b876da3544f00f1',t:'MTc2NzQ5NTAyNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
